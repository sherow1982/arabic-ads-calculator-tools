<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ - Ù…Ø®ØªØµØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ</title>
    <meta name="description" content="Ù…Ø®ØªØµØ± Ø±ÙˆØ§Ø¨Ø· Ø¹Ø±Ø¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ - Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø·ÙˆÙŠÙ„Ø© - ÙŠØ¯Ø¹Ù… Ø£ÙŠ Ø±Ø§Ø¨Ø·">
    
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #db2777 100%);
            margin: 0; padding: 0; display: flex;
            justify-content: center; align-items: center;
            min-height: 100vh; color: white; text-align: center;
        }
        
        .container {
            max-width: 600px; padding: 2.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px; backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; border-top: 4px solid white;
            width: 60px; height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        h1 {
            font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .status {
            font-size: 1.3rem; margin: 1.5rem 0; opacity: 0.95; line-height: 1.5;
        }
        
        .url-display {
            background: rgba(255, 255, 255, 0.15); padding: 1.5rem;
            border-radius: 15px; margin: 2rem 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .url-label { font-size: 1rem; opacity: 0.8; margin-bottom: 0.5rem; }
        .url-value { font-size: 1.1rem; font-weight: 600; word-break: break-all; color: #fbbf24; }
        
        .manual-button {
            display: inline-block; background: rgba(255, 255, 255, 0.9); color: #4f46e5;
            padding: 1.2rem 2.5rem; border-radius: 30px; text-decoration: none;
            margin-top: 2rem; font-weight: 700; font-size: 1.2rem;
            transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .manual-button:hover {
            background: white; color: #4f46e5; text-decoration: none;
            transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }
        
        .footer-info {
            margin-top: 3rem; font-size: 0.9rem; opacity: 0.75; line-height: 1.6;
        }
        
        .error-state { color: #fbbf24; font-weight: 600; }
        .success-state { color: #4ade80; font-weight: 600; }
        .loading-dots { display: inline-block; animation: loadingDots 1.5s infinite; }
        
        @keyframes loadingDots {
            0%, 20% { color: rgba(255,255,255,0.4); }
            40% { color: rgba(255,255,255,0.8); }
            60% { color: rgba(255,255,255,1); }
            80%, 100% { color: rgba(255,255,255,0.4); }
        }
        
        .search-methods {
            background: rgba(255, 255, 255, 0.1); padding: 1rem;
            border-radius: 15px; margin: 1rem 0; font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .method-item {
            margin: 0.5rem 0; padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .method-success { background: rgba(34, 197, 94, 0.2); }
        .method-failed { background: rgba(239, 68, 68, 0.2); }
        .method-searching { background: rgba(251, 191, 36, 0.2); animation: pulse 1s infinite; }
        
        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner" id="spinner"></div>
        
        <h1 id="title">ğŸš€ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡<span class="loading-dots">...</span></h1>
        
        <div class="status" id="status">
            ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ØµÙ„ÙŠ...
        </div>
        
        <div class="search-methods" id="searchMethods">
            <div class="method-item method-searching" id="method1">ğŸ“¦ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª JSON - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>
            <div class="method-item" id="method2">ğŸ“‹ GitHub Issues - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...</div>
            <div class="method-item" id="method3">ğŸ“„ Ù…Ù„ÙØ§Øª HTML - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...</div>
            <div class="method-item" id="method4">ğŸ”„ Ø£Ù†Ù…Ø§Ø· Ø´Ø§Ø¦Ø¹Ø© - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...</div>
        </div>
        
        <div class="url-display" id="urlDisplay" style="display: none;">
            <div class="url-label">ğŸ¯ Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</div>
            <div class="url-value" id="targetUrl"></div>
            <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
                <span id="methodUsed"></span>
            </div>
        </div>
        
        <a href="#" class="manual-button" id="manualButton" style="display: none;">
            ğŸ”— Ø§Ø¶ØºØ· Ù„Ù„ØªÙˆØ¬ÙŠÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
        </a>
        
        <div class="footer-info">
            Ø±Ø§Ø¨Ø· Ù‚ØµÙŠØ± Ù…Ù† ğŸ‡ªğŸ‡¬ <strong>Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</strong><br>
            Ù…Ø¬Ø§Ù†ÙŠ 100% â€¢ ÙŠØ¯Ø¹Ù… Ø£ÙŠ Ø±Ø§Ø¨Ø· â€¢ Ø¢Ù…Ù† ÙˆÙ…ÙˆØ«ÙˆÙ‚ â€¢ Ø¨Ø¯ÙˆÙ† Ø£Ø·Ø±Ø§Ù Ø«Ø§Ù„Ø«Ø©
        </div>
    </div>
    
    <script>
        // GitHub Configuration
        const GITHUB_API_BASE = 'https://api.github.com/repos/sherow1982/arabic-ads-calculator-tools';
        const BASE_URL = 'https://sherow1982.github.io/arabic-ads-calculator-tools';
        const LINK_DB_URL = `${BASE_URL}/link-db.json`;
        
        function getShortCode() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('to') || urlParams.get('url') || urlParams.get('go') || urlParams.get('redirect');
        }
        
        function updateMethodStatus(methodId, status, message) {
            const element = document.getElementById(methodId);
            if (!element) return;
            
            element.classList.remove('method-searching', 'method-success', 'method-failed');
            
            if (status === 'searching') {
                element.classList.add('method-searching');
                element.innerHTML = message;
            } else if (status === 'success') {
                element.classList.add('method-success');
                element.innerHTML = `âœ… ${message}`;
            } else {
                element.classList.add('method-failed');
                element.innerHTML = `âŒ ${message}`;
            }
        }
        
        function showError(message) {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('title').innerHTML = 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·';
            document.getElementById('status').innerHTML = `<span class="error-state">${message}</span>`;
            
            // Show home button
            const manualButton = document.getElementById('manualButton');
            manualButton.href = BASE_URL;
            manualButton.innerHTML = 'ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©';
            manualButton.style.display = 'inline-block';
        }
        
        function showSuccess(targetUrl, shortCode, source = 'unknown') {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('title').innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·!';
            document.getElementById('status').innerHTML = `<span class="success-state">Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø®Ù„Ø§Ù„ Ø«Ø§Ù†ÙŠØªÙŠÙ†...</span>`;
            
            // Show target URL
            document.getElementById('targetUrl').textContent = targetUrl;
            document.getElementById('urlDisplay').style.display = 'block';
            
            // Show which method worked
            const methodNames = {
                'json-db': 'ğŸ“¦ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª JSON',
                'github-issues': 'ğŸ“‹ GitHub Issues',
                'html-files': 'ğŸ“„ Ù…Ù„ÙØ§Øª HTML',
                'common-patterns': 'ğŸ”„ Ø£Ù†Ù…Ø§Ø· Ø´Ø§Ø¦Ø¹Ø©'
            };
            document.getElementById('methodUsed').textContent = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ø¨Ø±: ${methodNames[source] || source}`;
            
            // Show manual button
            const manualButton = document.getElementById('manualButton');
            manualButton.href = targetUrl;
            manualButton.innerHTML = 'ğŸ”— Ø§Ø¶ØºØ· Ù„Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙÙˆØ±ÙŠ';
            manualButton.style.display = 'inline-block';
        }
        
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        // Method 1: Try JSON Database (fastest and most reliable)
        async function tryJsonDatabase(shortCode) {
            try {
                updateMethodStatus('method1', 'searching', 'ğŸ“¦ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª JSON - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...');
                
                console.log(`Fetching JSON database...`);
                const response = await fetch(`${LINK_DB_URL}?t=${Date.now()}`, { 
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('JSON database loaded:', data);
                    
                    if (data.links && data.links[shortCode]) {
                        const linkData = data.links[shortCode];
                        const targetUrl = linkData.url;
                        
                        if (isValidUrl(targetUrl)) {
                            updateMethodStatus('method1', 'success', 'ğŸ“¦ Ø¹ÙØ«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                            console.log(`âœ… Found in JSON DB: ${shortCode} -> ${targetUrl}`);
                            return targetUrl;
                        }
                    }
                }
                
                updateMethodStatus('method1', 'failed', 'ğŸ“¦ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                
            } catch (error) {
                console.log(`JSON DB error: ${error.message}`);
                updateMethodStatus('method1', 'failed', `ğŸ“¦ Ø®Ø·Ø£: ${error.message}`);
            }
            
            return null;
        }
        
        // Method 2: Try GitHub Issues API
        async function tryGitHubIssues(shortCode) {
            try {
                updateMethodStatus('method2', 'searching', 'ğŸ“‹ GitHub Issues - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...');
                
                // Try numeric issue first
                const issueNumber = parseInt(shortCode);
                if (!isNaN(issueNumber) && issueNumber > 0) {
                    const issueResponse = await fetch(`${GITHUB_API_BASE}/issues/${issueNumber}`);
                    if (issueResponse.ok) {
                        const issue = await issueResponse.json();
                        if (issue.title && isValidUrl(issue.title)) {
                            updateMethodStatus('method2', 'success', `ğŸ“‹ Ø¹ÙØ«Ø± ÙÙŠ Issue #${issueNumber}`);
                            console.log(`âœ… Found in GitHub Issues: ${issue.title}`);
                            return issue.title;
                        }
                    }
                }
                
                updateMethodStatus('method2', 'failed', 'ğŸ“‹ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± ÙÙŠ GitHub Issues');
                
            } catch (error) {
                console.log(`GitHub Issues error: ${error.message}`);
                updateMethodStatus('method2', 'failed', `ğŸ“‹ Ø®Ø·Ø£: ${error.message}`);
            }
            
            return null;
        }
        
        // Method 3: Try individual HTML files  
        async function tryIndividualFiles(shortCode) {
            try {
                updateMethodStatus('method3', 'searching', 'ğŸ“„ Ù…Ù„ÙØ§Øª HTML - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...');
                
                const fileResponse = await fetch(`${BASE_URL}/${shortCode}.html`);
                if (fileResponse.ok) {
                    const htmlContent = await fileResponse.text();
                    
                    // Extract URL from meta refresh tag
                    const metaRefreshMatch = htmlContent.match(/content="\\d+;url=(.+?)"/);
                    if (metaRefreshMatch) {
                        const extractedUrl = metaRefreshMatch[1];
                        if (isValidUrl(extractedUrl)) {
                            updateMethodStatus('method3', 'success', `ğŸ“„ Ø¹ÙØ«Ø± ÙÙŠ Ù…Ù„Ù ${shortCode}.html`);
                            console.log(`âœ… Found in HTML file: ${extractedUrl}`);
                            return extractedUrl;
                        }
                    }
                }
                
                updateMethodStatus('method3', 'failed', 'ğŸ“„ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± ÙÙŠ Ù…Ù„ÙØ§Øª HTML');
                
            } catch (error) {
                console.log(`HTML files error: ${error.message}`);
                updateMethodStatus('method3', 'failed', `ğŸ“„ Ø®Ø·Ø£: ${error.message}`);
            }
            
            return null;
        }
        
        // Method 4: Try common patterns
        async function tryCommonPatterns(shortCode) {
            try {
                updateMethodStatus('method4', 'searching', 'ğŸ”„ Ø£Ù†Ù…Ø§Ø· Ø´Ø§Ø¦Ø¹Ø© - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...');
                
                // Try some intelligent guessing based on common short URL patterns
                const commonPatterns = [
                    `https://example.com/page/${shortCode}`,
                    `https://arabsad.com/go/${shortCode}`,
                    `https://bit.ly/${shortCode}`,
                    `https://tinyurl.com/${shortCode}`,
                    `https://youtu.be/${shortCode}`, // For YouTube links
                    `https://fb.me/${shortCode}`, // For Facebook links
                    `https://wa.me/${shortCode}` // For WhatsApp links
                ];
                
                for (let pattern of commonPatterns) {
                    try {
                        // Quick HEAD request to check if URL exists
                        const testResponse = await fetch(pattern, { 
                            method: 'HEAD',
                            mode: 'no-cors' // Avoid CORS issues
                        });
                        
                        // Since we're using no-cors, we can't check status
                        // But if the fetch doesn't throw, the URL might be valid
                        console.log(`Testing pattern: ${pattern}`);
                        
                    } catch (e) {
                        // Pattern doesn't work, continue
                    }
                }
                
                updateMethodStatus('method4', 'failed', 'ğŸ”„ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± ÙÙŠ Ø£Ù†Ù…Ø§Ø· Ø´Ø§Ø¦Ø¹Ø©');
                
            } catch (error) {
                console.log(`Common patterns error: ${error.message}`);
                updateMethodStatus('method4', 'failed', `ğŸ”„ Ø®Ø·Ø£: ${error.message}`);
            }
            
            return null;
        }
        
        async function performRedirect() {
            const shortCode = getShortCode();
            
            console.log('Current URL:', window.location.href);
            console.log('Short code:', shortCode);
            
            if (!shortCode) {
                showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø² Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†. <br><br>ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù…: <code>?to=Ø±Ù…Ø²Ø§Ù„Ø±Ø§Ø¨Ø·</code><br><br>Ù…Ø«Ø§Ù„: <code>s.html?to=test</code>');
                document.getElementById('searchMethods').style.display = 'none';
                return;
            }
            
            let targetUrl = null;
            let source = '';
            
            // Method 1: Try JSON Database (fastest)
            targetUrl = await tryJsonDatabase(shortCode);
            if (targetUrl) {
                source = 'json-db';
            }
            
            // Method 2: Try GitHub Issues
            if (!targetUrl) {
                targetUrl = await tryGitHubIssues(shortCode);
                if (targetUrl) {
                    source = 'github-issues';
                }
            }
            
            // Method 3: Try individual HTML files
            if (!targetUrl) {
                targetUrl = await tryIndividualFiles(shortCode);
                if (targetUrl) {
                    source = 'html-files';
                }
            }
            
            // Method 4: Try common patterns
            if (!targetUrl) {
                targetUrl = await tryCommonPatterns(shortCode);
                if (targetUrl) {
                    source = 'common-patterns';
                }
            }
            
            if (!targetUrl) {
                showError(`Ø±Ù…Ø² Ø§Ù„Ø±Ø§Ø¨Ø· "${shortCode}" ØºÙŠØ± Ù…ÙØ¹Ø±Ù‘Ù Ø­Ø§Ù„ÙŠØ§Ù‹.<br><br>ğŸ’¡ Ù„Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯:<br>1. Ø§Ø³ØªØ®Ø¯Ù… <a href="tools/url-shortener.html" style="color: #fbbf24;">Ø£Ø¯Ø§Ø© Ù…Ø®ØªØµØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</a><br>2. Ø£Ùˆ Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù…Ø² "${shortCode}" Ø¹Ø¨Ø± <a href="https://wa.me/201110760081" style="color: #fbbf24;">WhatsApp</a>`);
                return;
            }
            
            showSuccess(targetUrl, shortCode, source);
            
            // Analytics tracking
            if (typeof gtag !== 'undefined') {
                gtag('event', 'short_url_redirect', {
                    'short_code': shortCode,
                    'target_url': targetUrl,
                    'source_method': source,
                    'user_agent': navigator.userAgent,
                    'timestamp': new Date().toISOString()
                });
            }
            
            // Perform redirect
            setTimeout(() => {
                console.log(`Redirecting to: ${targetUrl}`);
                window.location.href = targetUrl;
            }, 2000);
        }
        
        // Start the process when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting redirect process...');
            performRedirect();
        });
        
        // Handle cases where DOM is already loaded
        if (document.readyState === 'loading') {
            // Wait for DOMContentLoaded
        } else {
            console.log('DOM already loaded, starting redirect process immediately...');
            performRedirect();
        }
        
        // Emergency fallback after 15 seconds
        setTimeout(() => {
            console.log('Emergency fallback triggered');
            window.location.href = BASE_URL;
        }, 15000);
        
        // Handle click anywhere to trigger manual redirect if available
        document.addEventListener('click', function() {
            const manualButton = document.getElementById('manualButton');
            if (manualButton && manualButton.style.display !== 'none' && manualButton.href !== '#') {
                window.location.href = manualButton.href;
            }
        });
    </script>
</body>
</html>