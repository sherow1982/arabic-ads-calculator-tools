<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ù‚ØµÙŠØ± Ø¬Ø¯ÙŠØ¯ - Ù…Ø®ØªØµØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ</title>
    
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            margin: 0; padding: 2rem; min-height: 100vh; color: white;
        }
        
        .container {
            max-width: 600px; margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px; padding: 2rem;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-control {
            width: 100%; padding: 0.75rem; border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px; background: rgba(255, 255, 255, 0.9);
            color: #333; font-size: 1rem;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.9); color: #059669;
            border: none; padding: 0.75rem 1.5rem; border-radius: 25px;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            margin: 0.5rem;
        }
        
        .btn:hover {
            background: white; transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        
        .result-box {
            background: rgba(255, 255, 255, 0.1); padding: 1.5rem;
            border-radius: 15px; margin-top: 2rem; display: none;
        }
        
        .current-links {
            background: rgba(255, 255, 255, 0.05); padding: 1rem;
            border-radius: 10px; margin-top: 1rem; font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; margin-bottom: 2rem;">
            ğŸ”— Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ù‚ØµÙŠØ± Ø¬Ø¯ÙŠØ¯
        </h1>
        
        <form onsubmit="addNewLink(event)">
            <div class="form-group">
                <label class="form-label">ğŸ” Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù‚ØµÙŠØ±:</label>
                <input type="text" id="shortCode" class="form-control" 
                       placeholder="Ù…Ø«Ø§Ù„: summer-sale, fb-ad, blog1" required>
                <small style="opacity: 0.8; font-size: 0.8rem;">
                    Ø±Ù‚Ù… Ø£Ùˆ Ù†Øµ Ù‚ØµÙŠØ± (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ Ø±Ù…ÙˆØ² Ø®Ø§ØµØ©)
                </small>
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ¯ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</label>
                <input type="url" id="targetUrl" class="form-control" 
                       placeholder="https://example.com/your-destination" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ“ Ø¹Ù†ÙˆØ§Ù† ÙˆØµÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="text" id="title" class="form-control" 
                       placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø±Ø§Ø¨Ø·">
            </div>
            
            <div style="text-align: center;">
                <button type="submit" class="btn btn-success">
                    â• Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯
                </button>
                <button type="button" onclick="clearForm()" class="btn">
                    Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                </button>
            </div>
        </form>
        
        <div class="result-box" id="resultBox">
            <h3 style="color: #4ade80;">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!</h3>
            <div id="resultContent"></div>
            <button class="btn" onclick="testLink()" id="testBtn">
                ğŸš€ Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¢Ù†
            </button>
        </div>
        
        <div class="current-links">
            <h4>ğŸ“ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h4>
            <div id="currentLinks">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <a href="tools/url-shortener.html" class="btn">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù…Ø®ØªØµØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            </a>
            <a href="s.html?to=demo" class="btn" target="_blank">
                ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
        </div>
    </div>
    
    <script>
        let currentDatabase = {};
        
        // Load current links on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentLinks();
        });
        
        async function loadCurrentLinks() {
            try {
                const response = await fetch('link-db.json?t=' + Date.now());
                if (response.ok) {
                    currentDatabase = await response.json();
                    displayCurrentLinks();
                }
            } catch (error) {
                document.getElementById('currentLinks').innerHTML = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©';
            }
        }
        
        function displayCurrentLinks() {
            const container = document.getElementById('currentLinks');
            const links = currentDatabase.links || {};
            
            if (Object.keys(links).length === 0) {
                container.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø­Ø§Ù„ÙŠØ©';
                return;
            }
            
            let html = '<table style="width: 100%; font-size: 0.85rem;">';
            html += '<tr style="border-bottom: 1px solid rgba(255,255,255,0.2); padding: 0.5rem 0;">';
            html += '<th>Ø§Ù„Ø±Ù…Ø²</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø±Ø§Ø¨Ø·</th></tr>';
            
            Object.entries(links).forEach(([code, data]) => {
                const shortUrl = `s.html?to=${code}`;
                html += `<tr style="border-bottom: 1px solid rgba(255,255,255,0.1); padding: 0.3rem 0;">`;
                html += `<td style="padding: 0.3rem;"><code>${code}</code></td>`;
                html += `<td style="padding: 0.3rem;">${data.title || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>`;
                html += `<td style="padding: 0.3rem;"><a href="${shortUrl}" target="_blank" style="color: #fbbf24;">${shortUrl}</a></td>`;
                html += '</tr>';
            });
            
            html += '</table>';
            container.innerHTML = html;
        }
        
        function addNewLink(event) {
            event.preventDefault();
            
            const shortCode = document.getElementById('shortCode').value.trim();
            const targetUrl = document.getElementById('targetUrl').value.trim();
            const title = document.getElementById('title').value.trim() || 'Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯';
            
            if (!shortCode || !targetUrl) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            // Validate URL
            try {
                new URL(targetUrl);
            } catch (e) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­');
                return;
            }
            
            // Check if code already exists
            if (currentDatabase.links && currentDatabase.links[shortCode]) {
                if (!confirm(`Ø§Ù„Ø±Ù…Ø² "${shortCode}" Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ØŸ`)) {
                    return;
                }
            }
            
            // Simulate adding to database (in real implementation, this would update the JSON file)
            const newLinkData = {
                url: targetUrl,
                title: title,
                created: new Date().toISOString(),
                clicks: 0,
                status: 'active',
                category: 'user-added'
            };
            
            // Update local database
            if (!currentDatabase.links) currentDatabase.links = {};
            currentDatabase.links[shortCode] = newLinkData;
            currentDatabase.meta.total_links = Object.keys(currentDatabase.links).length;
            currentDatabase.meta.last_updated = new Date().toISOString();
            
            // Generate JSON for manual update
            const updatedJson = JSON.stringify(currentDatabase, null, 2);
            
            // Show result
            const shortUrl = `s.html?to=${shortCode}`;
            const fullShortUrl = `https://sherow1982.github.io/arabic-ads-calculator-tools/${shortUrl}`;
            
            document.getElementById('resultContent').innerHTML = `
                <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                    <strong>Ø§Ù„Ø±Ù…Ø²:</strong> ${shortCode}<br>
                    <strong>Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚ØµÙŠØ±:</strong> <br>
                    <a href="${shortUrl}" target="_blank" style="color: #fbbf24; word-break: break-all;">${fullShortUrl}</a><br>
                    <strong>Ø§Ù„ÙˆØ¬Ù‡Ø©:</strong> <br>
                    <a href="${targetUrl}" target="_blank" style="color: #93c5fd; word-break: break-all;">${targetUrl}</a>
                </div>
                
                <div style="background: rgba(251, 191, 36, 0.2); padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                    <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</strong><br>
                    Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¹Ù…Ù„ ÙØ¹Ù„ÙŠØ§Ù‹ØŒ ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù <code>link-db.json</code> ÙŠØ¯ÙˆÙŠØ§Ù‹.<br>
                    <small>Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ JSON Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ§Ø³ØªØ¨Ø¯Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù.</small>
                </div>
                
                <textarea style="width: 100%; height: 200px; font-family: monospace; font-size: 0.8rem; 
                                background: #1f2937; color: #f8fafc; border-radius: 8px; padding: 1rem;"
                          readonly onclick="this.select()">${updatedJson}</textarea>
            `;
            
            document.getElementById('testBtn').onclick = () => window.open(shortUrl, '_blank');
            document.getElementById('resultBox').style.display = 'block';
            document.getElementById('resultBox').scrollIntoView({ behavior: 'smooth' });
            
            // Refresh current links display
            displayCurrentLinks();
            
            // Clear form
            document.getElementById('shortCode').value = '';
            document.getElementById('targetUrl').value = '';
            document.getElementById('title').value = '';
        }
        
        function clearForm() {
            document.getElementById('shortCode').value = '';
            document.getElementById('targetUrl').value = '';
            document.getElementById('title').value = '';
            document.getElementById('resultBox').style.display = 'none';
        }
        
        function testLink() {
            const shortCode = document.getElementById('shortCode').value.trim();
            if (shortCode) {
                window.open(`s.html?to=${shortCode}`, '_blank');
            }
        }
    </script>
</body>
</html>