<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>๐ ูุฎุชุตุฑ ุงูุฑูุงุจุท ุงูุนุงููู - ุฃูุถุงุน: ุชูุตูุฑ โข ุชุฌููู โข ููุงููุง</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .mode-tabs{display:flex;gap:.5rem;flex-wrap:wrap;margin:10px 0}
    .mode-tabs .btn{border-radius:999px}
    .pill{background:#0ea5e9;color:#fff;border-radius:999px;padding:.4rem .8rem;font-weight:600}
    textarea{direction:ltr;font-family:monospace}
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h1 class="h5 m-0">๐ ูุฎุชุตุฑ ุงูุฑูุงุจุท ุงูุนุงููู</h1>
      <span class="pill">ุฃูุถุงุน: ุชูุตูุฑ โข ุชุฌููู โข ููุงููุง</span>
    </div>

    <div class="mode-tabs mb-2">
      <button id="tabShort" class="btn btn-primary btn-sm"><i class="fa-solid fa-scissors me-1"></i>ุชูุตูุฑ ุงูุฑูุงุจุท</button>
      <button id="tabPretty" class="btn btn-outline-primary btn-sm"><i class="fa-solid fa-wand-magic-sparkles me-1"></i>ุชุฌููู ุงูุฑูุงุจุท</button>
      <button id="tabBoth" class="btn btn-outline-primary btn-sm"><i class="fa-solid fa-star me-1"></i>ุงูุชูุตูุฑ + ุงูุชุฌููู</button>
      <button id="btnCleanUrls" class="btn btn-outline-warning btn-sm ms-auto"><i class="fas fa-broom me-1"></i>ุชูุธูู ุงูุฑูุงุจุท (ูุง ูุบููุฑ ุงูุฏูููู)</button>
      <button id="backlinkBtn" class="btn btn-danger btn-sm"><i class="fas fa-bolt me-1"></i>ุจุงู ูููู DA ุนุงูู (ุจุฏูู ุชุณุฌูู ุฏุฎูู)</button>
    </div>

    <div class="alert alert-info py-2" id="info">ุงูุตู ุญุชู 1000 ุฑุงุจุท - ุงููุถุน ุงูุญุงูู: ุชูุตูุฑ</div>

    <label class="form-label fw-bold">ุงูุฑูุงุจุท (ูู ุฑุงุจุท ูู ุณุทุฑ):</label>
    <textarea id="urlInput" class="form-control" rows="8" placeholder="https://example.com/./product.html?name=ููุชุฌ-ุนุฑุจู"></textarea>

    <div class="d-flex gap-2 my-3">
      <button id="action" class="btn btn-primary"><i class="fa-solid fa-play me-1"></i>ุชูููุฐ</button>
      <button id="copyShort" class="btn btn-success d-none"><i class="fa-solid fa-copy me-1"></i>ูุณุฎ ุงููุตูุฑุฉ</button>
      <button id="copyPretty" class="btn btn-info text-white d-none"><i class="fa-solid fa-copy me-1"></i>ูุณุฎ ุงูุฌูููุฉ</button>
      <button id="downloadXlsx" class="btn btn-warning d-none"><i class="fa-solid fa-download me-1"></i>XLSX</button>
    </div>

    <div id="results" class="card p-3 d-none">
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>ุงูุฃุตูู</th>
              <th>ุงููุตูุฑ</th>
              <th>ุงูุฌููู</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    // ุชุญููู ููุธู ุงูุฑูุงุจุท ูุนุฏู ุชุบููุฑ ุงูุฏูููู
    (function(){
      const s=document.createElement('script');
      s.src='https://sherow1982.github.io/arabic-ads-calculator-tools/tools/modules/url-cleaner.js';
      s.defer=true;document.head.appendChild(s);
    })();

    // ููุงูุน ุจุงู ูููู ุจุฏูู ุชุณุฌูู ุฏุฎูู (ููุฌูุฏุฉ ูู ุงููุณุฎุฉ ุงูุณุงุจูุฉ)
    const NO_LOGIN_SITES = [
      { name:'Digg', url:'https://digg.com/submit', da:94 },
      { name:'AllTop', url:'https://alltop.com/submit', da:85 },
      { name:'Mix', url:'https://mix.com/add', da:92 },
      { name:'Pocket', url:'https://getpocket.com/save', da:89 },
      { name:'Instapaper', url:'https://www.instapaper.com/save', da:85 },
      { name:'SEO Review Tools', url:'https://www.seoreviewtools.com/seo-checker/', da:79 },
      { name:'All-in-one Tools Backlink', url:'https://allinonetools.net/backlink-maker/', da:70 },
      { name:'PrePostSEO Backlinks', url:'https://www.prepostseo.com/backlinks-maker', da:80 },
      { name:'SearchEngineReports Backlinks', url:'https://searchenginereports.net/backlink-maker', da:76 },
      { name:'Turbo SEO Backlinks', url:'https://www.turboseotools.com/backlink-maker', da:72 }
    ];

    // ูุธุงุฆู ุฃุณุงุณูุฉ
    const BASE = 'https://sherow1982.github.io/arabic-ads-calculator-tools';
    const SHORT_BASE = BASE + '/s.html?to=';

    let mode = 'short'; // short | pretty | both

    const info = document.getElementById('info');
    const tabShort = document.getElementById('tabShort');
    const tabPretty= document.getElementById('tabPretty');
    const tabBoth  = document.getElementById('tabBoth');
    const actionBtn= document.getElementById('action');
    const copyShort= document.getElementById('copyShort');
    const copyPretty=document.getElementById('copyPretty');
    const downloadXlsx=document.getElementById('downloadXlsx');

    function setMode(m){
      mode=m;
      tabShort.className = 'btn btn-' + (m==='short'?'':'outline-') + 'primary btn-sm';
      tabPretty.className= 'btn btn-' + (m==='pretty'?'':'outline-') + 'primary btn-sm';
      tabBoth.className  = 'btn btn-' + (m==='both'?'':'outline-') + 'primary btn-sm';
      info.textContent = m==='short'? 'ุงูุตู ุญุชู 1000 ุฑุงุจุท - ุงููุถุน ุงูุญุงูู: ุชูุตูุฑ'
        : m==='pretty'? 'ุงููุถุน ุงูุญุงูู: ุชุฌููู - ุณููุดุฆ ุณูุงุฌ ุนุฑุจู/ุฅูุฌููุฒู ูุธูู'
        : 'ุงููุถุน ุงูุญุงูู: ุงูุชูุตูุฑ + ุงูุชุฌููู ูุนุงู';
    }

    tabShort.onclick = ()=> setMode('short');
    tabPretty.onclick= ()=> setMode('pretty');
    tabBoth.onclick  = ()=> setMode('both');

    function normalizeUrl(url){
      url=url.trim();
      if(!/^https?:\/\//.test(url)) url='https://'+url;
      try{
        const u = new URL(url);
        const path = u.pathname.replace(/\/\.\//g,'/').replace(/\/+/, '/');
        return `${u.protocol}//${u.host}${path}${u.search}${u.hash}`;
      }catch{ return url; }
    }

    function slugify(input){
      if(!input) return '';
      let s=input.trim();
      try{ s=decodeURIComponent(s); }catch(_){ }
      try{
        const u=new URL(s);
        const qp=new URLSearchParams(u.search);
        const name = qp.get('name')||qp.get('title')||qp.get('q')||'';
        if(name) s=name;
      }catch(_){ }
      s=s.replace(/[\u0000-\u001F\u007F]/g,'')
        .replace(/\s+/g,'-')
        .replace(/[^\u0600-\u06FFa-zA-Z0-9\-]+/g,'-')
        .replace(/-+/g,'-')
        .replace(/^-|-$/g,'')
        .toLowerCase();
      return s.substring(0,80);
    }

    function genShort(i){ return SHORT_BASE + 'k' + i; }

    function process(){
      const lines = document.getElementById('urlInput').value.split('\n').filter(l=>l.trim());
      const tbody = document.getElementById('tbody');
      tbody.innerHTML='';
      const outShort=[]; const outPretty=[];

      lines.forEach((line, idx)=>{
        const original = normalizeUrl(line);
        const shortUrl = genShort(idx+1);
        const slug = slugify(original);
        const pretty = BASE + '/' + slug; // ุดูู ุฌููู ููุท ููุนุฑุถ

        const showShort = (mode==='short' || mode==='both');
        const showPretty= (mode==='pretty'|| mode==='both');

        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td style="font-family:monospace" dir="ltr">${original}</td>
          <td>${ showShort? `<a href="${shortUrl}" target="_blank">${shortUrl}</a>` : '-' }</td>
          <td>${ showPretty? `<span dir="ltr">${pretty}</span> <small class="text-muted">/${slug}</small>` : '-' }</td>
        `;
        tbody.appendChild(tr);
        if(showShort) outShort.push(shortUrl);
        if(showPretty) outPretty.push(pretty);
      });

      document.getElementById('results').classList.remove('d-none');
      copyShort.classList.toggle('d-none', !(mode==='short'||mode==='both'));
      copyPretty.classList.toggle('d-none', !(mode==='pretty'||mode==='both'));
      downloadXlsx.classList.remove('d-none');

      copyShort.onclick = ()=> navigator.clipboard.writeText(outShort.join('\n'));
      copyPretty.onclick= ()=> navigator.clipboard.writeText(outPretty.join('\n'));

      // ุชุตุฏูุฑ XLSX
      downloadXlsx.onclick = ()=>{
        const rows = Array.from(tbody.children).map(tr=>{
          const tds = tr.querySelectorAll('td');
          return {
            '#': tds[0].textContent.trim(),
            'ุงูุฃุตูู': tds[1].textContent.trim(),
            'ุงููุตูุฑ': tds[2].textContent.replace(/\s+/g,' ').trim(),
            'ุงูุฌููู': tds[3].textContent.replace(/\s+/g,' ').trim(),
          };
        });
        const ws = XLSX.utils.json_to_sheet(rows);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ุงููุชุงุฆุฌ');
        XLSX.writeFile(wb, 'smart-urls.xlsx');
      };
    }

    document.getElementById('action').onclick = process;

    // ุจุงู ูููู ุจุฏูู ุชุณุฌูู ุฏุฎูู (ูุชุญ ุชุจููุจุงุช)
    document.getElementById('backlinkBtn').onclick = ()=>{
      const first = document.getElementById('urlInput').value.split('\n').map(s=>s.trim()).filter(Boolean)[0];
      if(!first){ alert('ุถุน ุฑูุงุจุท ุฃููุงู'); return; }
      NO_LOGIN_SITES.forEach(s=>{
        let u=s.url;
        if(s.name==='Digg') u+=`?url=${encodeURIComponent(first)}`;
        if(s.name==='Mix'||s.name==='Pocket'||s.name==='Instapaper') u+=`?url=${encodeURIComponent(first)}`;
        window.open(u,'_blank');
      });
    };

    // ุชูุนูู ุงููุถุน ุงูุงูุชุฑุงุถู
    setMode('short');
  </script>
</body>
</html>
