<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ููุฑุดููุฏ ุงูุฅุนูุงูุงุช ุงูุฐูู - ุงููุณุฎุฉ ุงููุญุณููุฉ</title>
  <link rel="icon" href="/favicon.svg">
  <link rel="stylesheet" href="/global-styles.css" />
  <style>
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;margin:12px 0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .grid{display:grid;gap:16px}
    @media(min-width:960px){.grid{grid-template-columns:repeat(3,1fr)}}
    .muted{color:#666;font-size:.92rem}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi div{background:#f6f7f9;border:1px solid #e7e9ee;border-radius:10px;padding:10px 12px}
    .pill{display:inline-block;background:#eef6ff;color:#1453b3;border:1px solid #cfe3ff;padding:4px 10px;border-radius:999px;margin:2px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .warn{color:#b80}
    .pos{color:#0a5}
    .neg{color:#b10}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row .col{flex:1 1 260px}
    .small{font-size:.85rem}
  </style>
</head>
<body>
  <div class="container" id="app">
    <h1>๐ฏ ููุฑุดููุฏ ุงูุฅุนูุงูุงุช ุงูุฐูู (ูุณุฎุฉ ูุญุณููุฉ)</h1>
    <p class="muted">ุฃุฏุฎู ุงูุฏููุฉ ูุงููุฌุงูุ ูุญุฏูุฏ <b>ูุฏู ุงูุญููุฉ</b> ู<b>ูุฏุฉ ุงูุชุดุบูู</b> ู<b>ุงูููุฒุงููุฉ</b> ูููููุฏ ุฎุทุฉ ุฏูููุฉ: ูููุงุช ููุชุงุญูุฉ ุนุฑุจูุฉุ ูุฒูุฌ ูููุงุชุ ุชูุฒูุน ููุฒุงููุฉุ ูุชููุนุงุช ุชูุตูููุฉ.</p>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>ุงูุฏููุฉ</label>
          <input id="country" list="countries" placeholder="ูุซุงู: ูุตุฑุ ุงูุณุนูุฏูุฉ" />
          <datalist id="countries"></datalist>
        </div>
        <div class="col">
          <label>ูุฌุงู ุงูุนูู</label>
          <input id="sector" list="sectors" placeholder="ูุซุงู: ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉุ ูุทุงุนูุ ุนูุงุฑุงุช" />
          <datalist id="sectors"></datalist>
        </div>
        <div class="col">
          <label>ุงูุนููุฉ</label>
          <input id="currency" disabled />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>ูุฏู ุงูุญููุฉ</label>
          <select id="goal">
            <option value="awareness">ูุนู</option>
            <option value="traffic">ุฒูุงุฑุงุช</option>
            <option value="leads">ุนููุงุก ูุญุชูููู</option>
            <option value="sales" selected>ูุจูุนุงุช</option>
          </select>
        </div>
        <div class="col">
          <label>ุงููุฏุฉ (ุฃูุงู)</label>
          <input id="days" type="number" min="7" step="1" value="30" />
        </div>
        <div class="col">
          <label>ุงูููุฒุงููุฉ ุงูุฅุฌูุงููุฉ</label>
          <input id="budget" type="number" min="200" step="50" placeholder="ุฃุฏุฎู ููุฒุงููุฉ ุงูุญููุฉ" />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>ุฃููููุฉ ุงูููุตุฉ (ุงุฎุชูุงุฑู)</label>
          <select id="priority">
            <option value="auto" selected>ุชููุงุฆู</option>
            <option value="google">Google</option>
            <option value="meta">Facebook/Instagram</option>
            <option value="tiktok">TikTok</option>
            <option value="snapchat">Snapchat</option>
            <option value="linkedin">LinkedIn</option>
            <option value="youtube">YouTube</option>
          </select>
        </div>
        <div class="col">
          <label>ููุณููุฉ (ุงุฎุชูุงุฑู)</label>
          <select id="season">
            <option value="none" selected>ุจุฏูู</option>
            <option value="Ramadan">ุฑูุถุงู</option>
            <option value="Eid">ุงูุนูุฏ</option>
            <option value="Back_to_school">ุงูุนูุฏุฉ ูููุฏุงุฑุณ</option>
            <option value="Black_Friday">ุงูุฌูุนุฉ ุงูุณูุฏุงุก</option>
            <option value="Summer">ุงูุตูู</option>
            <option value="Winter">ุงูุดุชุงุก</option>
          </select>
        </div>
      </div>
      <button id="run">ุชูููุฏ ุงูุฎุทุฉ</button>
      <p class="small warn">ุชูุจูู: ูู ุงูุฃุฑูุงู ุชูุฏูุฑูุฉ ุชุนููููุฉ ุญุชู ุฑุจุท ุงูุฃุฏุงุฉ ุจูุงุฌูุงุช ุจูุงูุงุช ุฑุณููุฉ.</p>
    </div>

    <div id="out" style="display:none">
      <div class="card">
        <h2>โ ุชุฑุชูุจ ุงูููุตุงุช ููุฒูุฌ ุงููููุงุช</h2>
        <div id="mix" class="chips"></div>
        <p class="muted small" id="mixNote"></p>
      </div>

      <div class="card">
        <h2>๐ฐ ุชูุฒูุน ุงูููุฒุงููุฉ ุงูููุชุฑุญ</h2>
        <div id="allocation" class="kpi"></div>
        <p class="muted small">ุชู ุงุณุชุฎุฏุงู ุชุฑุฌูุญ ูุนุชูุฏ ุนูู ุงููุฏู (ูุนู/ุฒูุงุฑุงุช/ุนููุงุก/ูุจูุนุงุช) ูุน ูุฑุงุนุงุฉ CPM/CPC ุงููุชุงุญ ููุฏููุฉ.</p>
      </div>

      <div class="card">
        <h2>๐ ุงูุชููุนุงุช ุงูููุตูุฉ</h2>
        <div id="forecasts" class="kpi"></div>
        <p class="muted small">ุงูุตูุบ: ุงูุธููุฑ = ุงูููุฒุงููุฉ/CPM ร 1000. ุงูููุฑุงุช = ุงูุธููุฑ ร CTR. ุงูุชุญูููุงุช = ุงูููุฑุงุช ร CVR. ุงููุจูุนุงุช = ุงูุชุญูููุงุช ร ูุนุฏู ุงูุดุฑุงุก.</p>
      </div>

      <div class="card">
        <h2>๐ ุงููููุงุช ุงูููุชุงุญูุฉ ุงูุนุฑุจูุฉ</h2>
        <div id="keywords" class="chips"></div>
      </div>

      <div class="card">
        <h2>๐งช Playbook ุงูุชูููุฐ</h2>
        <ol id="playbook"></ol>
      </div>
    </div>
  </div>

  <script>
    const GOAL_WEIGHTS = {
      awareness: { display: 0.5, video: 0.3, social: 0.2 },
      traffic:   { search: 0.45, social: 0.35, video: 0.2 },
      leads:     { search: 0.5, social: 0.35, linkedin: 0.15 },
      sales:     { search: 0.45, social: 0.4, video: 0.15 }
    };

    function normalizeWeights(m){
      const s = Object.values(m).reduce((a,b)=>a+b,0)||1; const out={};
      for(const k in m){ out[k]=m[k]/s; } return out;
    }

    function platformFamily(p){
      const t = p.toLowerCase();
      if(t.includes('google')) return 'search';
      if(t.includes('linkedin')) return 'linkedin';
      if(t.includes('youtube')) return 'video';
      if(t.includes('tiktok')||t.includes('snapchat')) return 'video';
      return 'social';
    }

    function adjustByPriority(weights, priority){
      if(priority==='auto') return weights;
      const boost = 0.2;
      const out = {...weights};
      if(priority==='google') out.search = (out.search||0)+boost;
      if(priority==='linkedin') out.linkedin = (out.linkedin||0)+boost;
      if(priority==='youtube') out.video = (out.video||0)+boost;
      if(priority==='tiktok' || priority==='snapchat' || priority==='meta') out.social = (out.social||0)+boost;
      return normalizeWeights(out);
    }

    function seasonalMultiplier(sector, season){
      if(!season || season==='none') return 1.0;
      const m = (sector.seasonal_multipliers||{})[season] || 1.0;
      return m;
    }

    function estimateCTR(sector){
      // ุชูุฏูุฑ CTR ููุตู ูุนุฏู ุงูุชุญููู ุงููุทุงุนู ูุญุฏ ุฃุฏูู 0.8%
      return Math.max(0.008, (sector.avg_conversion_rate||0.02)/2);
    }

    function estimateCVR(sector){
      return sector.avg_conversion_rate || 0.02;
    }

    function computeChannelMix(country, sector, goal, priority){
      let weights = normalizeWeights(GOAL_WEIGHTS[goal]||GOAL_WEIGHTS.sales);
      weights = adjustByPriority(weights, priority);

      const recommended = country.recommended_platforms||[];
      // ุงุฎุชุฑ ุฃูุถู 3 ููุตุงุช ูู ุงูููุตู ุจูุง ุจูุงุกู ุนูู CPM ุงูุฃูู ูููููุงุช ุงูุงุฌุชูุงุนูุฉ/ุงูููุฏูู ููุฌูุฏ Google/LinkedIn ููุจุญุซ/ุงูุจู ุชู ุจู
      const cpm = country.avg_cpm||{};
      const sorted = [...recommended].sort((a,b)=> (cpm[a]||99)-(cpm[b]||99));
      const top = sorted.slice(0,3);

      // ูุฒูุน ูุฒู ุงููููุงุช ุนูู ุงูููุตุงุช ุงูุฃูุฑุจ
      const mix = [];
      for(const p of top){ mix.push({platform:p, family:platformFamily(p), cpm:cpm[p]||2}); }
      return {weights, mix};
    }

    function allocateBudget(total, weights, mix){
      // ุญููู ุฃูุฒุงู ุงููููุงุช ุฅูู ุฃูุฒุงู ููุตุงุช ุญุณุจ ูุฑุจ ุงูุนุงุฆูุฉ
      let famWeight = {};
      for(const {platform,family} of mix){ famWeight[family] = (famWeight[family]||0) + 1; }
      for(const k in famWeight){ famWeight[k] = famWeight[k]/mix.length; }

      const alloc = [];
      for(const {platform,family} of mix){
        const w = (weights[family]||0) * (famWeight[family]||0);
        const amount = total * (w||0.001); // ุญุฏ ุฃุฏูู ุตุบูุฑ ูููุน ุงูุตูุฑ
        alloc.push({platform, amount});
      }
      // ุฅุนุงุฏุฉ ููุงุฒูุฉ ุญุชู ูุณุงูู ุงููุฌููุน ุงูููุฒุงููุฉ ุชูุงููุง
      const sum = alloc.reduce((a,b)=>a+b.amount,0)||1;
      return alloc.map(x=> ({platform:x.platform, amount: total * (x.amount/sum)}));
    }

    function forecastForPlatform(amount, platform, country, sector, season){
      const cpm = (country.avg_cpm||{})[platform] || 2.0;
      const mult = seasonalMultiplier(sector, season);
      const ctr = estimateCTR(sector) * mult;
      const cvr = estimateCVR(sector) * (mult>1? Math.min(mult,1.4):Math.max(mult,0.7));
      const purchaseRate = 0.7;
      const impressions = (amount / cpm) * 1000;
      const clicks = impressions * ctr;
      const conversions = clicks * cvr;
      const sales = conversions * purchaseRate;
      return {cpm, ctr, cvr, impressions, clicks, conversions, sales};
    }

    function format(n){ return new Intl.NumberFormat('ar-EG').format(Math.round(n||0)); }

    async function load(){
      const res = await fetch('/data/ads-country-benchmarks.json');
      return res.json();
    }

    (async function init(){
      const data = await load();
      const countries = data.countries||{}; const sectors = data.business_sectors||{};
      const cList = document.getElementById('countries');
      Object.keys(countries).forEach(k=>{ const o=document.createElement('option'); o.value=countries[k].name||k; cList.appendChild(o); });
      const sList = document.getElementById('sectors');
      Object.keys(sectors).forEach(k=>{ const o=document.createElement('option'); o.value=sectors[k].name||k; sList.appendChild(o); });

      const run = document.getElementById('run');
      run.addEventListener('click', ()=>{
        const cVal = document.getElementById('country').value.trim();
        const sVal = document.getElementById('sector').value.trim();
        const goal = document.getElementById('goal').value;
        const days = parseInt(document.getElementById('days').value||'30',10);
        const totalBudget = parseFloat(document.getElementById('budget').value||'0');
        const priority = document.getElementById('priority').value;
        const season = document.getElementById('season').value;

        const country = Object.values(countries).find(c=> c.name===cVal) || null;
        const sector = Object.values(sectors).find(s=> s.name===sVal) || null;
        if(!country || !sector){ alert('ุงุฎุชุฑ ุฏููุฉ ููุฌุงู ูู ุงูููุงุฆู ุงูููุชุฑุญุฉ'); return; }

        document.getElementById('currency').value = country.currency||'';

        // ุชูุฏูุฑ ููุฒุงููุฉ ุงูุชุฑุงุถูุฉ ุฅุฐุง ูู ุชูุฏุฎู ูููุฉ
        const r = country.budget_ranges||{small:{min:2000,max:8000}};
        const monthly = totalBudget>0? totalBudget : Math.round((r.small.min + r.small.max)/2);
        const campaignBudget = Math.max(200, Math.round((monthly/30)*days));

        const {weights, mix} = computeChannelMix(country, sector, goal, priority);
        const allocation = allocateBudget(campaignBudget, weights, mix);

        // ุนุฑุถ ุงููุฒูุฌ
        const mixEl = document.getElementById('mix'); mixEl.innerHTML='';
        mix.forEach((m,i)=>{ const span=document.createElement('span'); span.className='pill'; span.textContent = `${i+1} - ${m.platform}`; mixEl.appendChild(span); });
        document.getElementById('mixNote').textContent = `ุชู ุงุฎุชูุงุฑ ุงูููุตุงุช ุจุชุฑุฌูุญ ุงููุฏู (${goal}) ูCPM ูู ${country.name}.`;

        // ุนุฑุถ ุงูุชูุฒูุน
        const allocEl = document.getElementById('allocation'); allocEl.innerHTML='';
        allocation.forEach(a=>{ const d=document.createElement('div'); d.innerHTML = `<b>${a.platform}</b><br>${format(a.amount)} ${country.currency}`; allocEl.appendChild(d); });

        // ุงูุชููุนุงุช
        const fEl = document.getElementById('forecasts'); fEl.innerHTML='';
        let totals = {impressions:0, clicks:0, conversions:0, sales:0};
        allocation.forEach(a=>{
          const f = forecastForPlatform(a.amount, a.platform, country, sector, season);
          totals.impressions += f.impressions; totals.clicks += f.clicks; totals.conversions += f.conversions; totals.sales += f.sales;
          const div = document.createElement('div');
          div.innerHTML = `<b>${a.platform}</b><br>CPM $${f.cpm.toFixed(2)} | CTR ${(f.ctr*100).toFixed(1)}% | CVR ${(f.cvr*100).toFixed(1)}%<br>ุงูุธููุฑ ${format(f.impressions)} | ุงูููุฑุงุช ${format(f.clicks)} | ุงูุชุญูููุงุช ${format(f.conversions)} | ุงููุจูุนุงุช ${format(f.sales)}`;
          fEl.appendChild(div);
        });
        const totalDiv = document.createElement('div');
        totalDiv.innerHTML = `<b>ุงูุฅุฌูุงูู (${format(campaignBudget)} ${country.currency})</b><br>ุงูุธููุฑ ${format(totals.impressions)} | ุงูููุฑุงุช ${format(totals.clicks)} | ุงูุชุญูููุงุช ${format(totals.conversions)} | ุงููุจูุนุงุช ${format(totals.sales)}`;
        fEl.appendChild(totalDiv);

        // ูููุงุช ููุชุงุญูุฉ
        const kwEl = document.getElementById('keywords'); kwEl.innerHTML='';
        (sectors[sVal]?.keywords || sector.keywords || []).slice(0,24).forEach(k=>{ const span=document.createElement('span'); span.className='pill'; span.textContent=k; kwEl.appendChild(span); });

        // Playbook
        const play = document.getElementById('playbook'); play.innerHTML='';
        const steps = [
          'ูุณูู ุงูููุฒุงููุฉ ููู ุงูุชูุฒูุน ุงูููุชุฑุญุ ูุน ุงุฎุชุจุงุฑ 2โ3 ุฅุจุฏุงุนุงุช ููู ุดุฑูุญุฉ.',
          'ุงุจูู ุฌูุงููุฑ: ุงูุชูุงู/ูุดุงุจู/ุฅุนุงุฏุฉ ุงุณุชูุฏุงู. ุงุจุฏุฃ ุจุชูุงุชุฑ 1.5โ2/ุฃุณุจูุน.',
          'ุฑุงูุจ CPM/CTR/CVR ูููููุง. ุฃููู ุงูุฃุณูุฃ 20โ30% ูุญููู ุงูููุฒุงููุฉ ููุฃูุถู.',
          'ุงุฎุชุจุฑ ุตูุญุฉ ุงููุจูุท/ุงูุฑุณุงุฆู ูุฑูุน CVR ุจูุณุจุฉ 20โ30%.',
          'ุซุจูุช ูุฒูุฌ ุงููููุงุช ุงูุฑุงุจุญ ููุณูุน ุงูููุฒุงููุฉ ุชุฏุฑูุฌููุง (10โ20% ุฃุณุจูุนููุง).'
        ];
        steps.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; play.appendChild(li); });

        document.getElementById('out').style.display='block';
      });
    })();
  </script>
</body>
</html>
