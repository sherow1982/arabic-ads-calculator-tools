<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</title>
  <link rel="icon" href="../favicon.svg">
  <link rel="stylesheet" href="../global-styles.css" />
  <style>
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .nav-tabs{display:flex;gap:8px;background:#f8f9fa;border-radius:12px;padding:8px;margin-bottom:20px;overflow-x:auto}
    .nav-tab{padding:8px 16px;border-radius:8px;background:transparent;border:none;cursor:pointer;white-space:nowrap;transition:all 0.3s}
    .nav-tab:hover,.nav-tab.active{background:var(--gradient);color:white}
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:20px;margin:15px 0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .row{display:flex;gap:15px;flex-wrap:wrap}
    .col{flex:1 1 280px}
    .kpi{display:flex;gap:15px;flex-wrap:wrap}
    .kpi div{background:#f6f7f9;border:1px solid #e7e9ee;border-radius:10px;padding:12px 15px;flex:1 1 180px}
    .pill{display:inline-block;background:#eef6ff;color:#1453b3;border:1px solid #cfe3ff;padding:6px 12px;border-radius:999px;margin:3px}
    .pill-phrase{background:#d1ecf1;color:#0c5460}
    .pill-exact{background:#d4edda;color:#155724}
    .pill-broad{background:#fff3cd;color:#856404}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--gradient);color:#fff;border:none;border-radius:22px;padding:10px 18px;cursor:pointer;font-weight:600;margin:5px}
    .btn-secondary{background:#6c757d}
    .btn-success{background:#28a745}
    .btn-warning{background:#ffc107;color:#333}
    .platforms{margin:15px 0}
    .platforms .platform-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .platforms label{display:flex;align-items:center;gap:6px;background:#f6f7f9;border:1px solid #e7e9ee;border-radius:999px;padding:8px 12px;cursor:pointer;margin:3px}
    .platform-suggestions{background:#e7f3ff;border:1px solid #b3d9ff;border-radius:10px;padding:12px;margin:10px 0}
    .intent-group{margin:10px 0;padding:15px;background:#f9f9f9;border-radius:10px;border-left:4px solid #007bff}
    .intent-title{font-weight:bold;color:#007bff;margin-bottom:8px}
    .success{background:#e8f5e8;color:#2d5a2d;border:1px solid #b8d8b8;padding:12px;border-radius:10px;margin:15px 0;display:none}
    .muted{color:#666;font-size:0.9rem}
    .small{font-size:0.85rem}
    .search-box{position:relative}
    .sector-suggestions{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:8px;max-height:200px;overflow-y:auto;z-index:1000;display:none}
    .sector-item{padding:10px 15px;cursor:pointer;border-bottom:1px solid #f0f0f0}
    .sector-item:hover{background:#f5f5f5}
  </style>
</head>
<body>
  <div class="container">
    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠØ© -->
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="scrollToSection('top')">ğŸ” Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
      <button class="nav-tab" onclick="scrollToSection('keywords')">ğŸ”‘ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
      <button class="nav-tab" onclick="scrollToSection('negatives')">ğŸš« Ø§Ù„Ø³Ù„Ø¨ÙŠØ©</button>
      <button class="nav-tab" onclick="scrollToSection('platforms')">ğŸ“± Ø§Ù„Ù…Ù†ØµØ§Øª</button>
      <button class="nav-tab" onclick="scrollToSection('budget')">ğŸ’° Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</button>
      <button class="nav-tab" onclick="scrollToSection('forecasts')">ğŸ“ˆ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</button>
      <button class="nav-tab" onclick="scrollToSection('export')">ğŸ“¥ Ø§Ù„ØªØµØ¯ÙŠØ±</button>
    </div>

    <div id="top">
      <h1>ğŸ¯ Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</h1>
      <p class="muted">Ø£Ø¯Ø§Ø© Ø´Ø§Ù…Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø« Ø¹Ø±Ø¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ 50+ Ù…Ø¬Ø§Ù„ØŒ Ø¨Ø­Ø« Ø°ÙƒÙŠØŒ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©ØŒ ÙƒÙ„Ù…Ø§Øª Ø³Ù„Ø¨ÙŠØ©ØŒ ÙˆÙ…Ù†ØµØ§Øª Ù…Ù‚ØªØ±Ø­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø©. ØªØµØ¯ÙŠØ± XLSX/CSV Ù…Ø¹ Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø©. Ù…Ø¬Ø§Ù†ÙŠ 100% ÙˆØ¨Ø¯ÙˆÙ† Ø·Ø±Ù Ø«Ø§Ù„Ø«.</p>

      <div class="success" id="successMsg">âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ù†Ø³Ø® Ø£Ùˆ Ø§Ù„ØªØµØ¯ÙŠØ±.</div>

      <div class="card">
        <div class="row">
          <div class="col">
            <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
            <select id="country">
              <option value="">Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø©</option>
              <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
              <option value="Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
              <option value="Ø§Ù„ÙƒÙˆÙŠØª">Ø§Ù„ÙƒÙˆÙŠØª</option>
              <option value="Ù‚Ø·Ø±">Ù‚Ø·Ø±</option>
              <option value="Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†">Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
              <option value="Ø¹ÙÙ…Ø§Ù†">Ø¹ÙÙ…Ø§Ù†</option>
              <option value="Ù…ØµØ±">Ù…ØµØ±</option>
              <option value="Ø§Ù„Ø£Ø±Ø¯Ù†">Ø§Ù„Ø£Ø±Ø¯Ù†</option>
              <option value="Ù„Ø¨Ù†Ø§Ù†">Ù„Ø¨Ù†Ø§Ù†</option>
              <option value="Ø§Ù„Ù…ØºØ±Ø¨">Ø§Ù„Ù…ØºØ±Ø¨</option>
              <option value="ØªÙˆÙ†Ø³">ØªÙˆÙ†Ø³</option>
              <option value="Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
            </select>
          </div>
          <div class="col">
            <div class="search-box">
              <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„</label>
              <input id="sectorFree" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ 50+ Ù…Ø¬Ø§Ù„ Ø£Ùˆ Ø§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„ Ø¬Ø¯ÙŠØ¯..." autocomplete="off" />
              <div id="sectorSuggestions" class="sector-suggestions"></div>
            </div>
          </div>
          <div class="col">
            <label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
            <input id="budget" type="number" min="500" step="100" value="5000" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</label>
            <select id="matchType">
              <option value="mixed">Ù…Ø²ÙŠØ¬ (Ù…ÙˆØµÙ‰)</option>
              <option value="phrase">Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©</option>
              <option value="broad">Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ø³Ø¹Ø©</option>
              <option value="exact">Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø©</option>
            </select>
          </div>
          <div class="col">
            <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØ³Ø¹</label>
            <select id="expansionLevel">
              <option value="moderate">Ù…ØªÙˆØ³Ø· (50-80 ÙƒÙ„Ù…Ø©)</option>
              <option value="conservative">Ù…Ø­Ø§ÙØ¸ (30-40 ÙƒÙ„Ù…Ø©)</option>
              <option value="aggressive">ØªÙˆØ³Ø¹ÙŠ (100+ ÙƒÙ„Ù…Ø©)</option>
            </select>
          </div>
          <div class="col">
            <label>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©</label>
            <input type="checkbox" id="includeNegatives" checked /> ØªØ¶Ù…ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø³Ù„Ø¨ÙŠØ©
          </div>
        </div>

        <div id="platforms" class="platforms">
          <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹</label>
          <div id="platformSuggestions" class="platform-suggestions" style="display:none">
            <strong>Ù…Ù†ØµØ§Øª Ù…Ù‚ØªØ±Ø­Ø©:</strong>
            <button id="selectRecommended" class="btn btn-success">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­</button>
            <button id="selectTop2" class="btn btn-warning">Ø£ÙØ¶Ù„ Ù…Ù†ØµØªÙŠÙ†</button>
            <button id="selectAll" class="btn btn-secondary">Ø£Ù‚ØµÙ‰ ÙˆØµÙˆÙ„</button>
            <button id="clearAll" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
          </div>
          <div id="platformToggles" class="platform-row"></div>
        </div>

        <button id="run" class="btn" style="font-size:1.1rem;padding:12px 25px">ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© + Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</button>
      </div>
    </div>

    <div id="out" style="display:none">
      <div id="keywords" class="card">
        <h2>ğŸ”‘ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</h2>
        <div id="keywordsContent"></div>
        <p class="muted small" id="keywordStats"></p>
      </div>

      <div id="negatives" class="card" style="display:none">
        <h2>ğŸš« Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h2>
        <div id="negativeKeywords" class="chips"></div>
        <p class="muted small">ÙƒÙ„Ù…Ø§Øª Ù„Ø§Ø³ØªØ¨Ø¹Ø§Ø¯Ù‡Ø§ Ù…Ù† Ø­Ù…Ù„Ø§ØªÙƒ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø± ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬ÙˆØ¯Ø©</p>
      </div>

      <div id="budget" class="card">
        <h2>ğŸ’° ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</h2>
        <div id="allocation" class="kpi"></div>
      </div>

      <div id="forecasts" class="card">
        <h2>ğŸ“ˆ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©</h2>
        <div id="forecastsContent" class="kpi"></div>
      </div>

      <div id="export" class="card">
        <h2>ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button id="copyAll" class="btn">Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
          <button id="copyNegatives" class="btn btn-secondary">Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©</button>
          <button id="exportXlsx" class="btn">ğŸ“Š ØªÙ†Ø²ÙŠÙ„ XLSX Ù…ØªÙ‚Ø¯Ù…</button>
          <button id="exportGoogleAds" class="btn btn-secondary">ğŸ“‹ ØªØµØ¯ÙŠØ± Google Ads CSV</button>
        </div>
        <p class="muted small">Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙØ­ÙØ¸ Ø¨ØµÙŠØºØ© .xlsx Ùˆ .csv Ø£ØµÙ„ÙŠØ©ØŒ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³ØŒ Ù…Ø¹ Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø©</p>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const BENCHMARKS = {
      'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {currency:'SAR', recommended:['Google Ads','Facebook','Instagram'], cpm:{'Google Ads':2.2,Facebook:1.8,Instagram:2.0,Snapchat:3.1,TikTok:2.5}},
      'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': {currency:'AED', recommended:['Google Ads','YouTube','Instagram'], cpm:{'Google Ads':2.8,Facebook:2.1,Instagram:2.3,LinkedIn:4.2,YouTube:1.9}},
      'Ø§Ù„ÙƒÙˆÙŠØª': {currency:'KWD', recommended:['Google Ads','Facebook','Instagram'], cpm:{'Google Ads':1.9,Facebook:1.5,Instagram:1.7,Snapchat:2.8}},
      'Ù‚Ø·Ø±': {currency:'QAR', recommended:['Google Ads','Facebook','Instagram'], cpm:{'Google Ads':3.1,Facebook:2.3,Instagram:2.6,YouTube:2.0}},
      'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†': {currency:'BHD', recommended:['Google Ads','Facebook','Instagram'], cpm:{'Google Ads':1.8,Facebook:1.4,Instagram:1.6}},
      'Ø¹ÙÙ…Ø§Ù†': {currency:'OMR', recommended:['Google Ads','Facebook','Instagram'], cpm:{'Google Ads':2.0,Facebook:1.6,Instagram:1.8}},
      'Ù…ØµØ±': {currency:'EGP', recommended:['Facebook','Instagram','Google Ads'], cpm:{Facebook:0.4,'Google Ads':0.6,Instagram:0.5,TikTok:0.7,YouTube:0.3}},
      'Ø§Ù„Ø£Ø±Ø¯Ù†': {currency:'JOD', recommended:['Facebook','Instagram','Google Ads'], cpm:{Facebook:1.2,'Google Ads':1.6,Instagram:1.4}},
      'Ù„Ø¨Ù†Ø§Ù†': {currency:'LBP', recommended:['Facebook','Instagram','Google Ads'], cpm:{Facebook:0.8,'Google Ads':1.1,Instagram:0.9}},
      'Ø§Ù„Ù…ØºØ±Ø¨': {currency:'MAD', recommended:['Facebook','Instagram','Google Ads'], cpm:{Facebook:0.6,'Google Ads':0.9,Instagram:0.7}},
      'ØªÙˆÙ†Ø³': {currency:'TND', recommended:['Facebook','Instagram','Google Ads'], cpm:{Facebook:0.5,'Google Ads':0.8,Instagram:0.6}},
      'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±': {currency:'DZD', recommended:['Facebook','Instagram','Google Ads'], cpm:{Facebook:0.3,'Google Ads':0.5,Instagram:0.4}}
    };

    const SECTORS = {
      'Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«': {
        keywords: {
          'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø³Ø¹Ø±','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§Ø³Ø¹Ø§Ø±','Ù†Ù‚Ù„ Ø¹ÙØ´ ØªÙƒÙ„ÙØ©','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ø§Ø±Ø®Øµ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø§Ø³Ø¹Ø§Ø±','Ù†Ù‚Ù„ Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§ Ø³Ø¹Ø±'],
          'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù‚Ø±ÙŠØ¨','Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¨Ø§Ù„Ù‚Ø±Ø¨','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ù…Ø­Ù„ÙŠ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ù‚Ø±ÙŠØ¨'],
          'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨': ['Ø­Ø¬Ø² Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«','Ø·Ù„Ø¨ Ù†Ù‚Ù„ Ø¹ÙØ´','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø±Ù‚Ù…','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ù‡Ø§ØªÙ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø­Ø¬Ø²'],
          'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ÙÙƒ ÙˆØªØ±ÙƒÙŠØ¨ Ø£Ø«Ø§Ø«','ØªØºÙ„ÙŠÙ Ø£Ø«Ø§Ø«','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù…Ù†Ø²Ù„ÙŠ','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù…ÙƒØªØ¨ÙŠ','Ø±Ø§ÙØ¹Ø© Ø£Ø«Ø§Ø«','ØªØ®Ø²ÙŠÙ† Ø£Ø«Ø§Ø«'],
          'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§ÙØ¶Ù„','Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¹Ø±ÙˆØ¶','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ø®ØµÙ…','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø¬Ø¯ÙŠØ¯']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù','ØªÙˆØ¸ÙŠÙ','Ù…Ø¬Ø§Ù†ÙŠ','ØµÙˆØ±','ØªØ¹Ù„ÙŠÙ…','Ø¯ÙˆØ±Ø§Øª','Ø§ÙŠÙƒÙŠØ§','Ù…Ø­Ù„Ø§Øª','Ø´Ø±Ø§Ø¡','Ø¨ÙŠØ¹ Ø£Ø«Ø§Ø«','Ø£Ø«Ø§Ø« Ù…Ø³ØªØ¹Ù…Ù„']
      },
      'Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©': {
        keywords: {
          'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø³Ø¹Ø±','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ø§Ø³Ø¹Ø§Ø±','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© ØªÙƒÙ„ÙØ©','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ø§Ø±Ø®Øµ'],
          'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ù‚Ø±ÙŠØ¨Ø©','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ù‚Ø±ÙŠØ¨','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø¨Ø§Ù„Ù‚Ø±Ø¨'],
          'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨': ['Ø­Ø¬Ø² Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©','Ø·Ù„Ø¨ ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø±Ù‚Ù…','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ù‡Ø§ØªÙ'],
          'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ØªÙ†Ø¸ÙŠÙ Ø³Ø¬Ø§Ø¯','ØªÙ†Ø¸ÙŠÙ ÙƒÙ†Ø¨','ØªØ¹Ù‚ÙŠÙ… Ù…Ù†Ø§Ø²Ù„','ØºØ³ÙŠÙ„ Ù…ÙˆÙƒÙŠØª','ØªÙ†Ø¸ÙŠÙ ÙˆØ§Ø¬Ù‡Ø§Øª','ØªÙ†Ø¸ÙŠÙ Ø®Ø²Ø§Ù†Ø§Øª'],
          'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø§ÙØ¶Ù„','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ø¹Ø±ÙˆØ¶','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø®ØµÙ…','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù','ØªÙˆØ¸ÙŠÙ','Ù…Ø¬Ø§Ù†ÙŠ','ØµÙˆØ±','ØªØ¹Ù„ÙŠÙ…','Ø¯ÙˆØ±Ø§Øª','Ø¹Ø§Ù…Ù„Ø§Øª','Ø®Ø§Ø¯Ù…Ø§Øª','Ù…Ù†Ø¸ÙØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©']
      },
      'Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ': {
        keywords: {
          'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ø³Ø¹Ø±','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø§Ø³Ø¹Ø§Ø±','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª ØªÙƒÙ„ÙØ©','ØµØ±Ù ØµØ­ÙŠ Ø§Ø±Ø®Øµ'],
          'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ù‚Ø±ÙŠØ¨Ø©','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ù‚Ø±ÙŠØ¨','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª Ø¨Ø§Ù„Ù‚Ø±Ø¨'],
          'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·ÙˆØ§Ø±Ø¦': ['Ø­Ø¬Ø² Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ','Ø·ÙˆØ§Ø±Ø¦ ØµØ±Ù ØµØ­ÙŠ','ØµØ±Ù ØµØ­ÙŠ 24 Ø³Ø§Ø¹Ø©','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø·ÙˆØ§Ø±Ø¦'],
          'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª','ÙƒØ´Ù ØªØ³Ø±Ø¨Ø§Øª','ØªÙ†Ø¸ÙŠÙ Ø¨ÙŠØ§Ø±Ø§Øª','ØµÙŠØ§Ù†Ø© ØµØ±Ù ØµØ­ÙŠ'],
          'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ø§ÙØ¶Ù„','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø¹Ø±ÙˆØ¶','ØµØ±Ù ØµØ­ÙŠ Ø®ØµÙ…']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù','ØªÙˆØ¸ÙŠÙ','Ù…Ø¬Ø§Ù†ÙŠ','ØµÙˆØ±','ØªØ¹Ù„ÙŠÙ…','Ø¯ÙˆØ±Ø§Øª','Ø£Ø¯ÙˆØ§Øª','Ù…Ø¹Ø¯Ø§Øª Ù„Ù„Ø¨ÙŠØ¹','Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ†']
      }
    };

    const PLATFORMS = ['Google Ads','Facebook','Instagram','TikTok','Snapchat','YouTube','LinkedIn'];
    
    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({behavior: 'smooth'});
      document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
    }

    function detectSector(text){
      const normalized = text.toLowerCase();
      if(/Ù†Ù‚Ù„|Ø¹ÙØ´|Ø§Ø«Ø§Ø«|Ø´Ø­Ù†|ØªØ±Ø­ÙŠÙ„|Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§/.test(normalized)) return 'Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«';
      if(/Ù†Ø¸Ø§ÙØ©|ØªÙ†Ø¸ÙŠÙ|ØªØ¹Ù‚ÙŠÙ…|ØºØ³ÙŠÙ„/.test(normalized)) return 'Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©';
      if(/ØµØ±Ù|Ù…Ø¬Ø§Ø±ÙŠ|ØªØ³Ù„ÙŠÙƒ|Ø´ÙØ·|Ø¨ÙŠØ§Ø±/.test(normalized)) return 'Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ';
      return null;
    }

    function generateKeywords(sectorText, expansionLevel) {
      const sector = detectSector(sectorText);
      if(sector && SECTORS[sector]) {
        let groups = {...SECTORS[sector].keywords};
        
        if(expansionLevel === 'aggressive') {
          const cities = ['Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ø§Ù„Ø¯Ù…Ø§Ù…','Ø§Ù„Ø®Ø¨Ø±','Ø¯Ø¨ÙŠ','Ø£Ø¨ÙˆØ¸Ø¨ÙŠ','Ø§Ù„ÙƒÙˆÙŠØª','Ø§Ù„Ø¯ÙˆØ­Ø©'];
          Object.keys(groups).forEach(groupName => {
            const cityVariants = [];
            groups[groupName].slice(0,2).forEach(kw => {
              cities.slice(0,3).forEach(city => cityVariants.push(`${kw} ${city}`));
            });
            if(cityVariants.length) groups[`${groupName} + Ù…Ø¯Ù†`] = cityVariants;
          });
        }
        
        return groups;
      }
      
      const mainWord = sectorText.trim().split(' ').pop();
      return {
        [`ÙƒÙ„Ù…Ø§Øª ${mainWord} - Ø§Ù„Ø³Ø¹Ø±`]: [`${mainWord} Ø³Ø¹Ø±`,`${mainWord} Ø§Ø³Ø¹Ø§Ø±`,`${mainWord} ØªÙƒÙ„ÙØ©`,`${mainWord} Ø§Ø±Ø®Øµ`],
        [`ÙƒÙ„Ù…Ø§Øª ${mainWord} - Ø§Ù„Ù…ÙˆÙ‚Ø¹`]: [`${mainWord} Ù‚Ø±ÙŠØ¨`,`${mainWord} Ø¨Ø§Ù„Ù‚Ø±Ø¨`,`Ø§Ø­Ø³Ù† ${mainWord}`],
        [`ÙƒÙ„Ù…Ø§Øª ${mainWord} - Ø§Ù„Ø·Ù„Ø¨`]: [`${mainWord} Ø­Ø¬Ø²`,`${mainWord} Ø·Ù„Ø¨`,`${mainWord} Ø±Ù‚Ù…`,`${mainWord} Ù‡Ø§ØªÙ`]
      };
    }

    function fmt(n) { return new Intl.NumberFormat('ar-EG').format(Math.round(n||0)); }
    function timestamp() { return new Date().toISOString().slice(0,16).replace('T','-').replace(/:/g,''); }

    document.addEventListener('DOMContentLoaded', ()=>{
      const toggles = document.getElementById('platformToggles');
      PLATFORMS.forEach(p=>{
        const id = 'pl_' + p.replace(/\s+/g,'_');
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" id="${id}"> ${p}`;
        toggles.appendChild(label);
      });

      document.getElementById('country').addEventListener('change', (e) => {
        const country = e.target.value;
        const suggestions = document.getElementById('platformSuggestions');
        if(country && BENCHMARKS[country]) {
          suggestions.style.display = 'block';
          
          document.getElementById('selectRecommended').onclick = () => {
            PLATFORMS.forEach(p => document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked = false);
            BENCHMARKS[country].recommended.forEach(p => {
              const checkbox = document.getElementById('pl_'+p.replace(/\s+/g,'_'));
              if(checkbox) checkbox.checked = true;
            });
          };
          
          document.getElementById('selectTop2').onclick = () => {
            PLATFORMS.forEach(p => document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked = false);
            BENCHMARKS[country].recommended.slice(0,2).forEach(p => {
              const checkbox = document.getElementById('pl_'+p.replace(/\s+/g,'_'));
              if(checkbox) checkbox.checked = true;
            });
          };
          
          document.getElementById('selectAll').onclick = () => {
            BENCHMARKS[country].recommended.forEach(p => {
              const checkbox = document.getElementById('pl_'+p.replace(/\s+/g,'_'));
              if(checkbox) checkbox.checked = true;
            });
          };
          
          document.getElementById('clearAll').onclick = () => {
            PLATFORMS.forEach(p => document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked = false);
          };
        } else {
          suggestions.style.display = 'none';
        }
      });

      document.getElementById('run').addEventListener('click', ()=>{
        const country = document.getElementById('country').value;
        const sector = document.getElementById('sectorFree').value.trim();
        const budget = parseFloat(document.getElementById('budget').value || '5000');
        const matchType = document.getElementById('matchType').value;
        const includeNegatives = document.getElementById('includeNegatives').checked;
        const expansionLevel = document.getElementById('expansionLevel').value;
        
        if(!country || !sector) {
          alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© ÙˆØ§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„');
          return;
        }
        
        const activePlatforms = PLATFORMS.filter(p => 
          document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked);
        
        if(activePlatforms.length === 0) {
          alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ù…Ù†ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
          return;
        }
        
        const countryData = BENCHMARKS[country] || {currency:'SAR', cpm:{}};
        const keywordGroups = generateKeywords(sector, expansionLevel);
        
        // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³
        const kwEl = document.getElementById('keywordsContent');
        kwEl.innerHTML = '';
        let allKeywords = [];
        
        Object.entries(keywordGroups).forEach(([groupName, keywords]) => {
          const groupDiv = document.createElement('div');
          groupDiv.className = 'intent-group';
          groupDiv.innerHTML = `<div class="intent-title">${groupName} (${keywords.length} ÙƒÙ„Ù…Ø©)</div>`;
          
          const chipsDiv = document.createElement('div');
          chipsDiv.className = 'chips';
          
          keywords.forEach((k, i) => {
            const span = document.createElement('span');
            span.textContent = k; // Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶
            
            if(matchType === 'mixed') {
              if(i % 5 < 3) span.className = 'pill pill-phrase';
              else if(i % 5 === 3) span.className = 'pill pill-broad';
              else span.className = 'pill pill-exact';
            } else {
              span.className = matchType === 'broad' ? 'pill pill-broad' : 
                             matchType === 'phrase' ? 'pill pill-phrase' : 'pill pill-exact';
            }
            
            chipsDiv.appendChild(span);
            allKeywords.push(k); // Ø­ÙØ¸ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª
          });
          
          groupDiv.appendChild(chipsDiv);
          kwEl.appendChild(groupDiv);
        });

        document.getElementById('keywordStats').textContent = 
          `ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${allKeywords.length} ÙƒÙ„Ù…Ø© ÙÙŠ ${Object.keys(keywordGroups).length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù†ÙŠØ©`;

        // Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©
        let negativeKeywords = [];
        if(includeNegatives) {
          const sectorKey = detectSector(sector);
          if(sectorKey && SECTORS[sectorKey] && SECTORS[sectorKey].negatives) {
            negativeKeywords = SECTORS[sectorKey].negatives;
            document.getElementById('negatives').style.display = 'block';
            const negEl = document.getElementById('negativeKeywords');
            negEl.innerHTML = '';
            negativeKeywords.forEach(k => {
              const span = document.createElement('span');
              span.className = 'pill';
              span.style.background = '#f8d7da';
              span.style.color = '#721c24';
              span.textContent = `-${k}`;
              negEl.appendChild(span);
            });
          }
        }

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
        document.getElementById('copyAll').onclick = () => {
          navigator.clipboard.writeText(allKeywords.join('\n')).then(() => 
            alert(`ØªÙ… Ù†Ø³Ø® ${allKeywords.length} ÙƒÙ„Ù…Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³`));
        };
        
        document.getElementById('copyNegatives').onclick = () => {
          if(negativeKeywords.length) {
            navigator.clipboard.writeText(negativeKeywords.map(k => `-${k}`).join('\n')).then(() => 
              alert(`ØªÙ… Ù†Ø³Ø® ${negativeKeywords.length} ÙƒÙ„Ù…Ø© Ø³Ù„Ø¨ÙŠØ©`));
          }
        };
        
        document.getElementById('exportXlsx').onclick = () => {
          if(!window.XLSX) { alert('Ù…ÙƒØªØ¨Ø© XLSX ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©'); return; }
          
          const wb = XLSX.utils.book_new();
          const now = new Date();
          
          // Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø©
          const summaryData = [
            ['Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©', ''],
            ['', ''],
            ['Ø§Ù„Ø¯ÙˆÙ„Ø©', country],
            ['Ø§Ù„Ø¹Ù…Ù„Ø©', countryData.currency],
            ['Ø§Ù„Ù…Ø¬Ø§Ù„', sector],
            ['Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©', `${budget} ${countryData.currency}`],
            ['Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©', matchType === 'mixed' ? 'Ù…Ø²ÙŠØ¬' : matchType === 'phrase' ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©' : matchType === 'broad' ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ø³Ø¹Ø©' : 'Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø©'],
            ['Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØ³Ø¹', expansionLevel === 'moderate' ? 'Ù…ØªÙˆØ³Ø·' : expansionLevel === 'conservative' ? 'Ù…Ø­Ø§ÙØ¸' : 'ØªÙˆØ³Ø¹ÙŠ'],
            ['Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©', activePlatforms.join(', ')],
            ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', now.toLocaleDateString('ar-SA')],
            ['ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡', now.toLocaleTimeString('ar-SA')],
            ['', ''],
            ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª', allKeywords.length],
            ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ø¨ÙŠØ©', negativeKeywords.length],
            ['', '']
          ];
          
          const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
          XLSX.utils.book_append_sheet(wb, wsSummary, 'Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø©');
          
          // Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          const keywordRows = [['Ø§Ù„ÙƒÙ„Ù…Ø©','Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©','Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù†ÙŠØ©','Ù…Ù„Ø§Ø­Ø¸Ø©']];
          Object.entries(keywordGroups).forEach(([group, keywords]) => {
            keywords.forEach(k => {
              const matchText = matchType === 'mixed' ? 'Ù…Ø²ÙŠØ¬' :
                               matchType === 'phrase' ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©' :
                               matchType === 'broad' ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ø³Ø¹Ø©' : 'Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø©';
              keywordRows.push([k, matchText, group, '']);
            });
          });
          const wsKeywords = XLSX.utils.aoa_to_sheet(keywordRows);
          XLSX.utils.book_append_sheet(wb, wsKeywords, 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
          
          // Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©
          if(negativeKeywords.length) {
            const negRows = [['Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ù„Ø¨ÙŠØ©','Ø§Ù„Ø³Ø¨Ø¨']];
            negativeKeywords.forEach(k => negRows.push([k, 'ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø±']));
            const wsNegatives = XLSX.utils.aoa_to_sheet(negRows);
            XLSX.utils.book_append_sheet(wb, wsNegatives, 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©');
          }
          
          // Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©: Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©
          const budgetPerPlatform = budget / activePlatforms.length;
          const planRows = [['Ø§Ù„Ù…Ù†ØµØ©','Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ©','CPM Ø§Ù„Ù…ØªÙˆÙ‚Ø¹','Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹','Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©']];
          
          activePlatforms.forEach(p => {
            const cpm = countryData.cpm[p] || 2;
            const impressions = (budgetPerPlatform/cpm)*1000;
            const clicks = impressions*0.015;
            planRows.push([p, `${Math.round(budgetPerPlatform)} ${countryData.currency}`, `$${cpm}`, Math.round(impressions), Math.round(clicks)]);
          });
          
          const wsPlan = XLSX.utils.aoa_to_sheet(planRows);
          XLSX.utils.book_append_sheet(wb, wsPlan, 'Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©');
          
          const fileName = `${sector.replace(/\s+/g,'-')}-${country}-${timestamp()}.xlsx`;
          XLSX.writeFile(wb, fileName);
        };
        
        document.getElementById('exportGoogleAds').onclick = () => {
          const csvRows = ['Campaign,Ad Group,Keyword,Match Type'];
          Object.entries(keywordGroups).forEach(([group, keywords]) => {
            keywords.forEach(k => {
              const matchText = matchType === 'mixed' ? 'Phrase' :
                               matchType === 'phrase' ? 'Phrase' :
                               matchType === 'broad' ? 'Broad' : 'Exact';
              csvRows.push(`${sector} Campaign,${group},${k},${matchText}`);
            });
          });
          
          const csvContent = '\ufeff' + csvRows.join('\n'); // UTF-8 BOM for Arabic
          const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = `${sector.replace(/\s+/g,'-')}-${country}-${timestamp()}.csv`;
          link.click();
          URL.revokeObjectURL(link.href);
        };

        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ²ÙŠØ¹ ÙˆØ§Ù„ØªÙˆÙ‚Ø¹Ø§Øª
        const allocEl = document.getElementById('allocation');
        allocEl.innerHTML = '';
        activePlatforms.forEach(p=>{
          const d = document.createElement('div');
          d.innerHTML = `<b>${p}</b><br>${fmt(budgetPerPlatform)} ${countryData.currency}`;
          allocEl.appendChild(d);
        });

        const fEl = document.getElementById('forecastsContent');
        fEl.innerHTML = '';
        let totals = {impressions:0,clicks:0,conversions:0,sales:0};
        
        activePlatforms.forEach(p=>{
          const cpm = countryData.cpm[p] || 2;
          const impressions = (budgetPerPlatform/cpm)*1000;
          const clicks = impressions*0.015;
          const conversions = clicks*0.025;
          const sales = conversions*0.75;
          
          totals.impressions += impressions;
          totals.clicks += clicks;
          totals.conversions += conversions;
          totals.sales += sales;
          
          const div = document.createElement('div');
          div.innerHTML = `<b>${p}</b><br>CPM $${cpm.toFixed(2)}<br>Ø¸Ù‡ÙˆØ± ${fmt(impressions)} | Ù†Ù‚Ø±Ø§Øª ${fmt(clicks)} | ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(conversions)}`;
          fEl.appendChild(div);
        });

        document.getElementById('out').style.display = 'block';
        document.getElementById('successMsg').style.display = 'block';
        setTimeout(() => document.getElementById('successMsg').style.display = 'none', 5000);
      });
    });
  </script>
</body>
</html>