<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ - ÙŠØ¯ÙˆÙŠ ÙˆÙ…ØªÙ‚Ø¯Ù…</title>
  <link rel="icon" href="../favicon.svg">
  <link rel="stylesheet" href="../global-styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root{--primary:#6366F1;--primary-light:#C7D2FE;--primary-dark:#4338CA;--success:#10B981;--warning:#F59E0B;--danger:#EF4444;--neutral:#64748B;--bg-light:#F8FAFC;--border:#E5E7EB}
    body{font-family:'Cairo',sans-serif;margin:0;padding:0;background:#FAFBFC}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:25px;margin:20px 0;box-shadow:0 4px 16px rgba(99,102,241,.08)}
    .ai-card{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;text-align:center;border:none}
    .manual-input{width:100%;padding:15px;border:2px solid var(--border);border-radius:12px;font-family:inherit;font-size:1rem;font-weight:500;transition:all 0.2s}
    .manual-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(99,102,241,0.1)}
    .manual-select{width:100%;padding:15px;border:2px solid var(--border);border-radius:12px;font-family:inherit;font-size:1rem;font-weight:500}
    .manual-label{font-weight:700;margin-bottom:8px;display:block;color:#1F2937;font-size:0.95rem}
    .manual-form{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:25px 0}
    .platform-buttons{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:15px 0}
    .platform-btn{padding:12px 20px;border:2px solid var(--border);background:#FAFAFA;color:#374151;border-radius:25px;cursor:pointer;font-weight:600;font-size:0.9rem;transition:all 0.3s}
    .platform-btn.active{background:var(--primary);color:white;border-color:var(--primary);transform:translateY(-2px);box-shadow:0 4px 15px rgba(99,102,241,0.3)}
    .platform-btn:hover:not(.active){background:#F3F4F6;border-color:#D1D5DB;transform:translateY(-1px)}
    .btn-ai{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:#fff;border:none;border-radius:30px;padding:16px 35px;cursor:pointer;font-weight:800;font-size:1.2rem;transition:all 0.4s;box-shadow:0 8px 25px rgba(99,102,241,0.3)}
    .btn-ai:hover{transform:translateY(-4px) scale(1.05);box-shadow:0 12px 35px rgba(99,102,241,0.5)}
    .btn-secondary{background:var(--neutral);color:white;border:none;border-radius:20px;padding:10px 20px;font-weight:600;cursor:pointer;transition:all 0.3s;font-size:0.85rem}
    .btn-secondary:hover{background:#475569;transform:translateY(-1px)}
    .pill{display:inline-block;padding:8px 14px;border-radius:20px;margin:4px;font-size:0.85rem;font-weight:600;border:2px solid;transition:all 0.2s}
    .pill-ai{background:#DBEAFE;color:#1E40AF;border-color:#93C5FD}
    .pill-expert{background:#DCFCE7;color:#166534;border-color:#86EFAC}
    .pill-premium{background:#FEF3C7;color:#92400E;border-color:#FCD34D}
    .pill-negative{background:#FEE2E2;color:#991B1B;border-color:#FCA5A5}
    .auto-stats{background:var(--bg-light);border:1px solid var(--border);border-radius:12px;padding:15px;margin:15px 0;text-align:center;color:var(--neutral);font-weight:600}
    .download-zone{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:20px 0}
    .btn-download{background:var(--success);color:white;border:none;border-radius:25px;padding:12px 24px;font-weight:700;cursor:pointer;transition:all 0.3s}
    .btn-download:hover{background:#059669;transform:translateY(-2px)}
    .btn-copy{background:var(--neutral);color:white;border:none;border-radius:25px;padding:12px 24px;font-weight:700;cursor:pointer;transition:all 0.3s}
    .btn-copy:hover{background:#475569;transform:translateY(-2px)}
    .toggle-row{display:flex;gap:10px;align-items:center;justify-content:center;margin:15px 0;flex-wrap:wrap}
    @media(max-width:768px){.container{padding:15px}.card{padding:18px;margin:15px 0}.manual-form{grid-template-columns:1fr}.platform-buttons{justify-content:center}}
  </style>
</head>
<body>
  <nav class="unified-nav" style="display:flex;gap:15px;flex-wrap:wrap;align-items:center;justify-content:center;padding:15px 10px;background:var(--gradient);border-radius:0 0 20px 20px;margin-bottom:20px">
    <a href="../" style="color:white;text-decoration:none;padding:8px 12px;border-radius:15px;transition:all 0.3s;font-weight:600"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="../tools-directory.html" style="color:white;text-decoration:none;padding:8px 12px;border-radius:15px;transition:all 0.3s;font-weight:600"><i class="fas fa-list"></i> Ø§Ù„Ø¯Ù„ÙŠÙ„</a>
  </nav>

  <div class="container">
    <div class="card ai-card">
      <h1>ğŸ¤– Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
      <p style="font-size:1.1rem;opacity:0.95;margin:15px 0">Ø­Ø¯Ø¯ Ø§Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø¨Ù†ÙØ³ÙƒØŒ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙˆÙ„Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙÙ‚Ø·</p>
    </div>

    <div class="card">
      <div class="toggle-row">
        <button id="resetSettings" class="btn-secondary">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·</button>
        <button id="shareState" class="btn-secondary">ğŸ”— Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„Ø©</button>
      </div>
      
      <h2>ğŸ› ï¸ Ø§Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ (ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„)</h2>
      <form id="manualForm">
        <div class="manual-form">
          <div>
            <label class="manual-label">Ø§Ù„Ù…Ø¬Ø§Ù„ / Ø§Ù„Ø®Ø¯Ù…Ø©</label>
            <input id="field" class="manual-input" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙŠØ¯ÙŠØ§ Ø¨Ø§ÙŠØ±ØŒ Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§ØŒ Ù†Ù‚Ù„ Ø§Ø«Ø§Ø«..." required>
          </div>
          <div>
            <label class="manual-label">Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
            <select id="country" class="manual-select">
              <option>Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option><option>Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option><option>Ù…ØµØ±</option><option>Ø§Ù„ÙƒÙˆÙŠØª</option><option>Ù‚Ø·Ø±</option><option>Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option><option>Ø¹ÙÙ…Ø§Ù†</option><option>Ø§Ù„Ø£Ø±Ø¯Ù†</option><option>Ù„Ø¨Ù†Ø§Ù†</option><option>Ø§Ù„Ù…ØºØ±Ø¨</option><option>ØªÙˆÙ†Ø³</option><option>Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
            </select>
          </div>
          <div>
            <label class="manual-label">Ø§Ù„Ù„Ù‡Ø¬Ø©</label>
            <select id="dialect" class="manual-select">
              <option value="classical">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰</option>
              <option value="local">Ù„Ù‡Ø¬Ø© Ø§Ù„Ø¯ÙˆÙ„Ø©</option>
            </select>
          </div>
          <div>
            <label class="manual-label">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
            <input type="number" id="budget" class="manual-input" min="1" max="10000000" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ø±Ù‚Ù… (1 Ø¥Ù„Ù‰ 10 Ù…Ù„ÙŠÙˆÙ†)" required>
          </div>
          <div>
            <label class="manual-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</label>
            <select id="matchType" class="manual-select">
              <option value="mixed">Ù…Ø²ÙŠØ¬ (Ù…ÙˆØµÙ‰)</option>
              <option value="phrase">Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©</option>
              <option value="broad">Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ø³Ø¹Ø©</option>
              <option value="exact">Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø©</option>
            </select>
          </div>
          <div>
            <label class="manual-label">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØ³Ø¹</label>
            <select id="expansion" class="manual-select">
              <option value="moderate">Ù…ØªÙˆØ³Ø· (30-50 ÙƒÙ„Ù…Ø©)</option>
              <option value="conservative">Ù…Ø­Ø§ÙØ¸ (20-30 ÙƒÙ„Ù…Ø©)</option>
              <option value="aggressive">ØªÙˆØ³Ø¹ÙŠ (40-50+ ÙƒÙ„Ù…Ø©)</option>
            </select>
          </div>
        </div>
        
        <div>
          <label class="manual-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ§Øª (ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯Ø©)</label>
          <div class="platform-buttons">
            <button type="button" class="platform-btn" data-platform="Google Ads">ğŸ“ Google Ads</button>
            <button type="button" class="platform-btn" data-platform="Facebook">ğŸ“˜ Facebook</button>
            <button type="button" class="platform-btn active" data-platform="Instagram">ğŸ“¸ Instagram</button>
            <button type="button" class="platform-btn" data-platform="TikTok">ğŸµ TikTok</button>
            <button type="button" class="platform-btn" data-platform="YouTube">ğŸ“º YouTube</button>
            <button type="button" class="platform-btn" data-platform="Snapchat">ğŸ‘» Snapchat</button>
            <button type="button" class="platform-btn" data-platform="LinkedIn">ğŸ’¼ LinkedIn</button>
          </div>
          <p style="text-align:center;color:#6B7280;font-size:0.9rem;margin-top:10px">
            Ù…Ù†ØµØ§Øª Ù…Ø®ØªØ§Ø±Ø©: <span id="selectedPlatforms">Instagram</span>
          </p>
        </div>

        <div style="text-align:center;margin-top:25px">
          <button type="submit" class="btn-ai">ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø°ÙƒÙŠ Ù„Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</button>
        </div>
      </form>
    </div>

    <div id="results" style="display:none">
      <div class="card" style="background:#F0F9FF;border-color:var(--primary)">
        <h2>ğŸ¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©</h2>
        <div id="strategyContent"></div>
      </div>

      <div class="card">
        <div class="toggle-row">
          <h2>ğŸ”‘ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h2>
          <button id="groupByPlatform" class="btn-secondary">ğŸ“± ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØµØ©</button>
        </div>
        <div id="keywordsContent"></div>
        <div class="auto-stats" id="keywordStats"></div>
      </div>

      <div class="card" id="negativeSection" style="display:none">
        <h2>ğŸš« Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©</h2>
        <div id="negativesContent"></div>
      </div>

      <div class="card">
        <h2>ğŸ’° Ø§Ù„ØªÙˆØ²ÙŠØ¹ ÙˆØ§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h2>
        <div id="forecastsContent"></div>
      </div>

      <div class="card">
        <h2>ğŸ“¥ Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h2>
        <div class="download-zone">
          <button id="copyKeywords" class="btn-copy">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
          <button id="copyNegatives" class="btn-copy">ğŸš« Ù†Ø³Ø® Ø§Ù„Ø³Ù„Ø¨ÙŠØ©</button>
          <button id="exportXLSX" class="btn-download">ğŸ“Š XLSX Ù…ØªÙ‚Ø¯Ù…</button>
          <button id="exportGoogleCSV" class="btn-download">ğŸ” Google Ads CSV</button>
          <button id="exportPDF" class="btn-download">ğŸ“„ ØªÙ‚Ø±ÙŠØ± PDF</button>
          <button id="exportProfile" class="btn-download">ğŸ¯ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ JSON</button>
        </div>
      </div>
    </div>
  </div>

  <footer style="background:var(--gradient);color:white;margin-top:40px;padding:25px 15px;text-align:center;border-radius:20px 20px 0 0">
    <div style="display:flex;gap:15px;flex-wrap:wrap;justify-content:center;margin-bottom:15px">
      <a href="../about.html" style="color:white;text-decoration:none;padding:8px 12px;border-radius:10px;transition:all 0.3s">Ø¹Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Øª</a>
      <a href="../tools-directory.html" style="color:white;text-decoration:none;padding:8px 12px;border-radius:10px;transition:all 0.3s">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª</a>
      <a href="https://arabsad.com" target="_blank" rel="noopener noreferrer" style="color:white;text-decoration:none;padding:8px 12px;border-radius:10px;transition:all 0.3s">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ</a>
    </div>
    <small style="opacity:0.9">Â© 2025 Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ - Ù…ØªÙ‚Ø¯Ù… ÙˆØ´Ø§Ù…Ù„</small>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Global variables
    const BENCHMARKS = {
      'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {currency:'SAR', cpm:{'Google Ads':2.2,Facebook:1.8,Instagram:2.0,Snapchat:3.1,TikTok:2.5,YouTube:1.6,LinkedIn:4.8}},
      'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': {currency:'AED', cpm:{'Google Ads':2.8,Facebook:2.1,Instagram:2.3,LinkedIn:4.2,YouTube:1.9,TikTok:2.7,Snapchat:3.3}},
      'Ù…ØµØ±': {currency:'EGP', cpm:{Facebook:0.4,'Google Ads':0.6,Instagram:0.5,TikTok:0.7,YouTube:0.3,Snapchat:0.8,LinkedIn:1.2}},
      'Ø§Ù„ÙƒÙˆÙŠØª': {currency:'KWD', cpm:{'Google Ads':1.9,Facebook:1.5,Instagram:1.7,Snapchat:2.8,TikTok:2.1,YouTube:1.4,LinkedIn:3.8}},
      'Ù‚Ø·Ø±': {currency:'QAR', cpm:{'Google Ads':3.1,Facebook:2.3,Instagram:2.6,YouTube:2.0,TikTok:2.8,Snapchat:3.5,LinkedIn:5.1}},
      'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†': {currency:'BHD', cpm:{'Google Ads':1.8,Facebook:1.4,Instagram:1.6,TikTok:1.9,YouTube:1.2,Snapchat:2.3,LinkedIn:3.2}},
      'Ø¹ÙÙ…Ø§Ù†': {currency:'OMR', cpm:{'Google Ads':2.0,Facebook:1.6,Instagram:1.8,TikTok:2.2,YouTube:1.5,Snapchat:2.6,LinkedIn:3.6}},
      'Ø§Ù„Ø£Ø±Ø¯Ù†': {currency:'JOD', cpm:{Facebook:1.2,'Google Ads':1.6,Instagram:1.4,TikTok:1.5,YouTube:1.0,Snapchat:1.8,LinkedIn:2.4}},
      'Ù„Ø¨Ù†Ø§Ù†': {currency:'LBP', cpm:{Facebook:0.8,'Google Ads':1.1,Instagram:0.9,TikTok:1.0,YouTube:0.7,Snapchat:1.2,LinkedIn:1.8}},
      'Ø§Ù„Ù…ØºØ±Ø¨': {currency:'MAD', cpm:{Facebook:0.6,'Google Ads':0.9,Instagram:0.7,TikTok:0.8,YouTube:0.5,Snapchat:1.0,LinkedIn:1.5}},
      'ØªÙˆÙ†Ø³': {currency:'TND', cpm:{Facebook:0.5,'Google Ads':0.8,Instagram:0.6,TikTok:0.7,YouTube:0.4,Snapchat:0.9,LinkedIn:1.3}},
      'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±': {currency:'DZD', cpm:{Facebook:0.3,'Google Ads':0.5,Instagram:0.4,TikTok:0.5,YouTube:0.2,Snapchat:0.6,LinkedIn:0.9}}
    };

    const SMART_FIELDS = {
      'Ù…ÙŠØ¯ÙŠØ§ Ø¨Ø§ÙŠØ±': {
        synonyms: ['Ø§Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù…ÙˆÙ„Ø©', 'Ù…Ø¯ÙŠØ± Ø­Ù…Ù„Ø§Øª', 'Ø§Ø¯Ø³ Ø¨Ø§ÙŠØ±', 'Ù…Ø´ØªØ±ÙŠ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù…ÙˆÙ„Ø©', 'Ø´Ø±ÙƒØ© Ø§Ø¹Ù„Ø§Ù†Ø§Øª'],
        platforms: {
          'Instagram': ['Ø¥Ø¯Ø§Ø±Ø© Ø­Ù…Ù„Ø§Øª Instagram Ø§Ø­ØªØ±Ø§ÙÙŠØ©', 'ØªØµÙ…ÙŠÙ… Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Instagram Ø¬Ø°Ø§Ø¨Ø©', 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø¬Ù…Ù‡ÙˆØ± Instagram Ø¯Ù‚ÙŠÙ‚', 'Ù…Ø­ØªÙˆÙ‰ Instagram ØªÙØ§Ø¹Ù„ÙŠ', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Stories Ùˆ Reels', 'ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Instagram'],
          'Facebook': ['Ø¥Ø¯Ø§Ø±Ø© Facebook Ads Ø§Ø­ØªØ±Ø§ÙÙŠØ©', 'Ø­Ù…Ù„Ø§Øª Lead Generation', 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø¬Ù…Ù‡ÙˆØ± Facebook Ù…ØªÙ‚Ø¯Ù…', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Carousel ØªÙØ§Ø¹Ù„ÙŠØ©', 'ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Facebook'],
          'TikTok': ['Ø­Ù…Ù„Ø§Øª TikTok Ù„Ù„Ø´Ø±ÙƒØ§Øª', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙŠØ¯ÙŠÙˆ Ù‚ØµÙŠØ±Ø©', 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯', 'Ù…Ø­ØªÙˆÙ‰ TikTok ØªØ±ÙŠÙ†Ø¯ÙŠ', 'ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©'],
          'Google Ads': ['Ø®Ø¯Ù…Ø§Øª Google Ads Ù„Ø²ÙŠØ§Ø¯Ø© ROAS', 'Ø¥Ø¯Ø§Ø±Ø© Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¨Ø­Ø«', 'Ø­Ù…Ù„Ø§Øª Shopping', 'Display ÙˆYouTube', 'ØªØ­Ø³ÙŠÙ† Quality Score'],
          'YouTube': ['Ø¥Ø¹Ù„Ø§Ù†Ø§Øª YouTube In-Stream', 'Ø­Ù…Ù„Ø§Øª Discovery', 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù ÙÙŠØ¯ÙŠÙˆ Ù…ØªÙ‚Ø¯Ù…', 'Ù…Ø­ØªÙˆÙ‰ ÙŠÙˆØªÙŠÙˆØ¨ ØªØ³ÙˆÙŠÙ‚ÙŠ'],
          'LinkedIn': ['Ø­Ù…Ù„Ø§Øª LinkedIn B2B', 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ù…Ù‡Ù†ÙŠ Ù…ØªÙ‚Ø¯Ù…', 'Lead Generation Ù„Ù„Ø´Ø±ÙƒØ§Øª', 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ©'],
          'Snapchat': ['Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Snapchat Ù…Ø­Ù„ÙŠØ©', 'Geo Filters', 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø¬ØºØ±Ø§ÙÙŠ Ø³Ø±ÙŠØ¹', 'Ø­Ù…Ù„Ø§Øª Ø³Ù†Ø§Ø¨ Ù…Ø­Ù„ÙŠØ©']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù Ù…ÙŠØ¯ÙŠØ§', 'ØªØ¹Ù„ÙŠÙ… Ø§Ø¹Ù„Ø§Ù†Ø§Øª', 'Ø¯ÙˆØ±Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©', 'Ø§Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©', 'ØµÙˆØ± Ø§Ø¹Ù„Ø§Ù†Ø§Øª', 'Ø¨Ø±Ø§Ù…Ø¬ Ø§Ø¹Ù„Ø§Ù†Ø§Øª']
      },
      'Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§Ø¡': {
        synonyms: ['Ø·Ø¨ÙŠØ¨ Ù†Ø³Ø§', 'Ø¯ÙƒØªÙˆØ± ÙˆÙ„Ø§Ø¯Ø©', 'Ø·Ø¨ÙŠØ¨ Ù†Ø³Ø§Ø¡', 'Ù†Ø³Ø§Ø¡ ÙˆØªÙˆÙ„ÙŠØ¯'],
        platforms: {
          'Instagram': ['Ø¹ÙŠØ§Ø¯Ø© Ù†Ø³Ø§Ø¡ ØªØµØ§Ù…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ©', 'Ù…Ø­ØªÙˆÙ‰ ØªÙˆØ¹ÙˆÙŠ Ù„Ù„Ø­Ø§Ù…Ù„', 'ØµÙˆØ± Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø·Ø¨ÙŠØ©', 'Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø­Ù…Ù„ ÙˆØ§Ù„ÙˆÙ„Ø§Ø¯Ø©', 'Stories ØªÙˆØ¹ÙˆÙŠØ© Ø·Ø¨ÙŠØ©'],
          'Facebook': ['Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§Ø¡', 'Ø¹ÙŠØ§Ø¯Ø© Ù†Ø³Ø§Ø¡ ÙˆØªÙˆÙ„ÙŠØ¯ Ù…Ø¶Ù…ÙˆÙ†Ø©', 'Ø±Ø¹Ø§ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø­Ø§Ù…Ù„', 'Ø®Ø¯Ù…Ø§Øª Ù†Ø³Ø§Ø¦ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø©', 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ù…Ù„ ÙˆØ§Ù„ÙˆÙ„Ø§Ø¯Ø©'],
          'Google Ads': ['Ø§ÙØ¶Ù„ Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§Ø¡ Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ', 'Ø§Ø³Ø¹Ø§Ø± Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ù…Ù„', 'Ø¯ÙƒØªÙˆØ± ÙˆÙ„Ø§Ø¯Ø© Ø·ÙˆØ§Ø±Ø¦', 'Ø¹ÙŠØ§Ø¯Ø© Ù†Ø³Ø§Ø¡ Ø¨Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Ø­Ø¬Ø² Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§ ÙÙˆØ±ÙŠ'],
          'Snapchat': ['Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§Ø¡ Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ', 'Ø¹ÙŠØ§Ø¯Ø© Ù†Ø³Ø§Ø¡ 24 Ø³Ø§Ø¹Ø©', 'Ø·ÙˆØ§Ø±Ø¦ ÙˆÙ„Ø§Ø¯Ø© ÙÙˆØ±ÙŠØ©', 'Ø¯ÙƒØªÙˆØ± Ù†Ø³Ø§ Ù…Ø­Ù„ÙŠ']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù Ø·Ø¨', 'Ø¯Ø±Ø§Ø³Ø© Ø·Ø¨', 'ÙƒØªØ¨ Ø·Ø¨', 'ØµÙˆØ± Ø·Ø¨ÙŠØ©', 'Ø¬Ø§Ù…Ø¹Ø© Ø·Ø¨']
      },
      'Ù†Ù‚Ù„ Ø§Ø«Ø§Ø«': {
        synonyms: ['Ù†Ù‚Ù„ Ø¹ÙØ´', 'ØªØ±Ø­ÙŠÙ„ Ø§Ø«Ø§Ø«', 'Ø´Ø­Ù† Ø§Ø«Ø§Ø«', 'Ù†Ù‚Ù„ Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§'],
        platforms: {
          'Instagram': ['ØµÙˆØ± Ù†Ù‚Ù„ Ø§Ø«Ø§Ø« Ø§Ø­ØªØ±Ø§ÙÙŠ', 'Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ù†Ù‚Ù„ Ø§Ù„Ø¹ÙØ´', 'ØªØºÙ„ÙŠÙ Ø§Ø«Ø§Ø« ÙÙ†ÙŠ', 'Ø¹Ø±ÙˆØ¶ Ù†Ù‚Ù„ Ø¨ØµØ±ÙŠØ©', 'Ù†Ù‚Ù„ Ø§Ø«Ø§Ø« Ø¬Ø°Ø§Ø¨ Ø¨ØµØ±ÙŠØ§'],
          'Facebook': ['Ø´Ø±ÙƒØ© Ù†Ù‚Ù„ Ø§Ø«Ø§Ø« Ù…Ø¶Ù…ÙˆÙ†Ø©', 'Ø¹Ø±ÙˆØ¶ Ù†Ù‚Ù„ Ø§Ù„Ø¹ÙØ´', 'Ù†Ù‚Ù„ Ø§Ø«Ø§Ø« Ù…Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Ø®Ø¯Ù…Ø§Øª Ù†Ù‚Ù„ Ø´Ø§Ù…Ù„Ø©', 'Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¨Ø¶Ù…Ø§Ù†'],
          'Google Ads': ['Ø§Ø³Ø¹Ø§Ø± Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø§ÙØ¶Ù„ Ø´Ø±ÙƒØ© Ù†Ù‚Ù„ Ø§Ø«Ø§Ø«', 'Ù†Ù‚Ù„ Ø§Ø«Ø§Ø« ÙÙˆØ±ÙŠ', 'Ø±Ø§ÙØ¹Ø© Ù†Ù‚Ù„ Ù„Ù„Ø·ÙˆØ§Ø¨Ù‚ Ø§Ù„Ø¹Ø§Ù„ÙŠØ©', 'Ù†Ù‚Ù„ Ø¹ÙØ´ Ù…Ø¶Ù…ÙˆÙ†'],
          'Snapchat': ['Ù†Ù‚Ù„ Ø¹ÙØ´ Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ', 'Ù†Ù‚Ù„ Ø§Ø«Ø§Ø« 24 Ø³Ø§Ø¹Ø©', 'Ù†Ù‚Ù„ ÙÙˆØ±ÙŠ Ø§Ù„ÙŠÙˆÙ…', 'Ø´Ø±ÙƒØ© Ù†Ù‚Ù„ Ù…Ø­Ù„ÙŠØ©']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù Ù†Ù‚Ù„', 'ØªÙˆØ¸ÙŠÙ Ø³Ø§Ø¦Ù‚ÙŠÙ†', 'Ù†Ù‚Ù„ Ù…Ø¬Ø§Ù†ÙŠ', 'Ø§Ø«Ø§Ø« Ù„Ù„Ø¨ÙŠØ¹']
      }
    };

    let selectedPlatforms = ['Instagram'];
    let currentKeywords = [];
    let currentNegatives = [];
    let currentData = {};
    let currentClassified = [];
    let groupedView = false;

    // Initialize everything
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...');
      
      loadSettings();
      setupEventListeners();
      loadFromHash();
      
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
    });

    function setupEventListeners() {
      // Platform buttons
      const platformBtns = document.querySelectorAll('.platform-btn');
      platformBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          console.log('ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ù…Ù†ØµØ©:', btn.dataset.platform);
          togglePlatform(btn.dataset.platform, btn);
        });
      });

      // Form submission
      const form = document.getElementById('manualForm');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
          generateResults();
        });
      }

      // Control buttons
      const resetBtn = document.getElementById('resetSettings');
      if (resetBtn) resetBtn.addEventListener('click', resetSettings);

      const shareBtn = document.getElementById('shareState');
      if (shareBtn) shareBtn.addEventListener('click', shareState);

      const groupBtn = document.getElementById('groupByPlatform');
      if (groupBtn) groupBtn.addEventListener('click', toggleGrouping);

      // Export buttons
      const exportBtns = {
        'copyKeywords': copyKeywords,
        'copyNegatives': copyNegatives,
        'exportXLSX': exportXLSX,
        'exportGoogleCSV': exportGoogleCSV,
        'exportPDF': exportPDF,
        'exportProfile': exportProfile
      };

      Object.entries(exportBtns).forEach(([id, func]) => {
        const btn = document.getElementById(id);
        if (btn) btn.addEventListener('click', func);
      });

      // Auto-save on changes
      ['country', 'dialect', 'matchType', 'expansion'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('change', saveSettings);
      });

      const budgetEl = document.getElementById('budget');
      if (budgetEl) budgetEl.addEventListener('input', debounce(saveSettings, 500));
    }

    function togglePlatform(platform, btn) {
      if (btn.classList.contains('active')) {
        btn.classList.remove('active');
        selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
      } else {
        btn.classList.add('active');
        if (!selectedPlatforms.includes(platform)) {
          selectedPlatforms.push(platform);
        }
      }
      updateSelectedPlatformsDisplay();
      saveSettings();
    }

    function updateSelectedPlatformsDisplay() {
      const span = document.getElementById('selectedPlatforms');
      if (span) {
        span.textContent = selectedPlatforms.length > 0 ? 
          selectedPlatforms.join(' â€¢ ') : 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù†ØµØ©';
      }
    }

    function generateResults() {
      console.log('ğŸ¯ Ø¨Ø¯Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...');
      
      const field = document.getElementById('field').value.trim();
      const country = document.getElementById('country').value;
      const dialect = document.getElementById('dialect').value;
      const budget = parseInt(document.getElementById('budget').value);
      const matchType = document.getElementById('matchType').value;
      const expansion = document.getElementById('expansion').value;

      if (!field || !budget || selectedPlatforms.length === 0) {
        alert('âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªØ± Ù…Ù†ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
      }

      currentData = { field, country, dialect, budget, matchType, expansion, platforms: [...selectedPlatforms] };
      
      // Generate keywords
      currentKeywords = generateSmartKeywords(field, country, dialect, expansion, selectedPlatforms);
      currentNegatives = generateSmartNegatives(field);
      currentClassified = classifyKeywords(currentKeywords);
      
      console.log(`âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${currentKeywords.length} ÙƒÙ„Ù…Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ù†ØµØ§Øª:`, selectedPlatforms);

      // Display results
      displayStrategy(currentData);
      displayKeywords(currentKeywords, matchType);
      displayNegatives(currentNegatives);
      displayForecasts(currentData);

      document.getElementById('results').style.display = 'block';
      document.getElementById('results').scrollIntoView({behavior: 'smooth'});
      
      saveSettings();
    }

    function generateSmartKeywords(field, country, dialect, expansion, platforms) {
      const fieldLower = field.toLowerCase();
      let keywords = [];

      // Platform-specific keyword generation
      Object.entries(SMART_FIELDS).forEach(([key, data]) => {
        const isMatch = data.synonyms.some(syn => fieldLower.includes(syn.toLowerCase())) || 
                       fieldLower.includes(key.toLowerCase());
        
        if (isMatch && data.platforms) {
          platforms.forEach(platform => {
            if (data.platforms[platform]) {
              keywords.push(...data.platforms[platform]);
            }
          });
        }
      });

      // Fallback generic keywords if no specific match
      if (keywords.length === 0) {
        platforms.forEach(platform => {
          if (platform === 'Instagram') {
            keywords.push(
              `${field} ØªØµØ§Ù…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ©`,
              `Ù…Ø­ØªÙˆÙ‰ ${field} Ø¨ØµØ±ÙŠ`,
              `ØµÙˆØ± ${field} Ø¬Ø°Ø§Ø¨Ø©`,
              `${field} Stories ÙˆReels`,
              `Ø¹Ø±ÙˆØ¶ ${field} ØªÙØ§Ø¹Ù„ÙŠØ©`,
              `${field} Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆØ¬Ù…ÙŠÙ„`,
              `ØªØµØ§Ù…ÙŠÙ… ${field} Ø­Ø¯ÙŠØ«Ø©`
            );
          } else if (platform === 'Google Ads') {
            keywords.push(
              `Ø§ÙØ¶Ù„ ${field} Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ`,
              `Ø§Ø³Ø¹Ø§Ø± ${field}`,
              `Ø­Ø¬Ø² ${field}`,
              `Ø±Ù‚Ù… ${field}`,
              `${field} Ù…Ø¶Ù…ÙˆÙ†`,
              `${field} ÙÙˆØ±ÙŠ`
            );
          } else if (platform === 'Facebook') {
            keywords.push(
              `Ø®Ø¯Ù…Ø§Øª ${field} Ø´Ø§Ù…Ù„Ø©`,
              `${field} Ù…Ø¹ Ø§Ù„Ø¶Ù…Ø§Ù†`,
              `Ø¹Ø±ÙˆØ¶ ${field}`,
              `${field} Ø§Ø­ØªØ±Ø§ÙÙŠ`,
              `${field} Ù…ÙˆØ«ÙˆÙ‚`
            );
          } else if (platform === 'TikTok') {
            keywords.push(
              `${field} Ø³Ø±ÙŠØ¹`,
              `${field} Ø¹ØµØ±ÙŠ`,
              `${field} Ø´Ø¨Ø§Ø¨ÙŠ`,
              `${field} ØªØ±Ù†Ø¯ÙŠ`
            );
          }
        });
      }

      // Add geographic variations only for relevant platforms
      const cities = {
        'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': ['Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø¬Ø¯Ø©', 'Ø§Ù„Ø¯Ù…Ø§Ù…'],
        'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': ['Ø¯Ø¨ÙŠ', 'Ø£Ø¨ÙˆØ¸Ø¨ÙŠ', 'Ø§Ù„Ø´Ø§Ø±Ù‚Ø©'],
        'Ù…ØµØ±': ['Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©', 'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©', 'Ø§Ù„Ø¬ÙŠØ²Ø©'],
        'Ø§Ù„ÙƒÙˆÙŠØª': ['Ø§Ù„ÙƒÙˆÙŠØª', 'Ø­ÙˆÙ„ÙŠ', 'Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ']
      };

      if (cities[country] && (platforms.includes('Google Ads') || platforms.includes('Snapchat'))) {
        cities[country].slice(0, 2).forEach(city => {
          keywords.push(`${field} ÙÙŠ ${city}`);
          if (platforms.includes('Google Ads')) {
            keywords.push(`Ø§ÙØ¶Ù„ ${field} ${city}`);
          }
        });
      }

      // Apply expansion level
      const targetCount = expansion === 'conservative' ? 25 : expansion === 'moderate' ? 40 : 50;
      
      // Remove duplicates and sort by popularity
      const unique = [...new Set(keywords)];
      const sorted = sortByPopularity(unique);
      
      // Ensure minimum count with relevant boosters
      if (sorted.length < 20) {
        const boosters = platforms.includes('Instagram') ? 
          ['Ø§Ø­ØªØ±Ø§ÙÙŠ', 'Ø¬Ø°Ø§Ø¨', 'Ø­Ø¯ÙŠØ«', 'Ø¹ØµØ±ÙŠ', 'Ù…Ù…ÙŠØ²'] :
          ['Ù…Ø¶Ù…ÙˆÙ†', 'Ø³Ø±ÙŠØ¹', 'Ù…ÙˆØ«ÙˆÙ‚', 'Ù…Ø­Ù„ÙŠ', 'Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©'];
        
        boosters.forEach(booster => {
          if (sorted.length < targetCount) {
            sorted.push(`${field} ${booster}`);
          }
        });
      }
      
      return sorted.slice(0, targetCount);
    }

    function sortByPopularity(keywords) {
      return keywords.sort((a, b) => popularityScore(b) - popularityScore(a));
    }

    function popularityScore(kw) {
      let score = 0;
      // High intent indicators
      if (/Ø§Ø³Ø¹Ø§Ø±|ØªÙƒÙ„ÙØ©|Ø³Ø¹Ø±/.test(kw)) score += 9;
      if (/Ø§ÙØ¶Ù„|Ø£ÙØ¶Ù„|Ø§Ø­Ø³Ù†/.test(kw)) score += 8;
      if (/Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ|ÙÙŠ \S+/.test(kw)) score += 7;
      if (/Ø­Ø¬Ø²|Ø·Ù„Ø¨|Ø±Ù‚Ù…|Ø§ØªØµØ§Ù„/.test(kw)) score += 7;
      if (/24\s*Ø³Ø§Ø¹Ø©|Ø§Ù„ÙŠÙˆÙ…|ÙÙˆØ±ÙŠ/.test(kw)) score += 6;
      if (/Ø¹Ø±ÙˆØ¶|Ø®ØµÙˆÙ…Ø§Øª/.test(kw)) score += 5;
      if (/Ø§Ø­ØªØ±Ø§ÙÙŠ|Ù…Ø¶Ù…ÙˆÙ†|Ø¬ÙˆØ¯Ø©/.test(kw)) score += 4;
      
      // Optimal word count (2-4 words are most searched)
      const wordCount = kw.trim().split(/\s+/).length;
      if (wordCount >= 2 && wordCount <= 4) score += 2;
      else if (wordCount > 6) score -= 1;
      
      return score;
    }

    function classifyKeywords(keywords) {
      const PLATFORM_RULES = {
        'Google Ads': {
          patterns: [/Ø§Ø³Ø¹Ø§Ø±|ØªÙƒÙ„ÙØ©|Ø³Ø¹Ø±/, /Ø§ÙØ¶Ù„|Ø§Ø­Ø³Ù†/, /Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ|ÙÙŠ \S+/, /Ø­Ø¬Ø²|Ø±Ù‚Ù…|Ø§ØªØµØ§Ù„/, /ÙÙˆØ±ÙŠ|Ø¹Ø§Ø¬Ù„/],
          priority: 9
        },
        'Instagram': {
          patterns: [/ØªØµÙ…ÙŠÙ…|Ø¯ÙŠÙƒÙˆØ±|ØµÙˆØ±|ÙÙŠØ¯ÙŠÙˆ|Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯|Ø§Ø­ØªØ±Ø§ÙÙŠ|ÙÙ†ÙŠ|Ø¨ØµØ±ÙŠ|Ø¬Ù…Ø§Ù„ÙŠ|ØªØ±Ù†Ø¯|Stories|Reels/],
          priority: 7
        },
        'Facebook': {
          patterns: [/Ø¹Ø±ÙˆØ¶|Ø®ØµÙˆÙ…Ø§Øª|Ù…Ø¬Ø§Ù†ÙŠ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±|Ø®Ø¯Ù…Ø§Øª|Ù…Ø¶Ù…ÙˆÙ†|Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©/],
          priority: 6
        },
        'TikTok': {
          patterns: [/Ø³Ø±ÙŠØ¹|ÙÙˆØ±ÙŠ|Ø§Ù„ÙŠÙˆÙ…|Ø§Ù„Ø§Ù†|Ù‚ØµÙŠØ±|ØªØ±Ù†Ø¯|Ø´Ø¨Ø§Ø¨|Ø¬Ø¯ÙŠØ¯/],
          priority: 5
        },
        'YouTube': {
          patterns: [/Ø´Ø±Ø­|Ø·Ø±ÙŠÙ‚Ø©|ÙƒÙŠÙ|Ù…Ù‚Ø§Ø±Ù†Ø©|Ø¯Ù„ÙŠÙ„|ØªØ¹Ù„ÙŠÙ…/],
          priority: 4
        },
        'LinkedIn': {
          patterns: [/ÙˆÙƒØ§Ù„Ø©|Ø´Ø±ÙƒØ©|Ù…Ø¯ÙŠØ±|Ø®Ø¨ÙŠØ±|Ø§Ø³ØªØ´Ø§Ø±ÙŠ|B2B|Ù…Ù‡Ù†ÙŠ|Ø§Ø­ØªØ±Ø§ÙÙŠ/],
          priority: 3
        },
        'Snapchat': {
          patterns: [/Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ|24 Ø³Ø§Ø¹Ø©|Ø¹Ø§Ø¬Ù„|ÙÙˆØ±ÙŠ|Ù…Ø­Ù„ÙŠ|Ø³Ø±ÙŠØ¹/],
          priority: 2
        }
      };

      return keywords.map(kw => {
        const scores = {};
        Object.entries(PLATFORM_RULES).forEach(([platform, rule]) => {
          let score = 0;
          rule.patterns.forEach(pattern => {
            if (pattern.test(kw)) score += rule.priority;
          });
          if (score > 0) scores[platform] = score;
        });
        
        const sorted = Object.entries(scores).sort(([,a], [,b]) => b - a).slice(0, 2);
        const platforms = sorted.length > 0 ? sorted.map(([p]) => p) : ['Ø¹Ø§Ù…'];
        
        return { keyword: kw, platforms, score: sorted[0] ? sorted[0][1] : 0 };
      });
    }

    function generateSmartNegatives(field) {
      const fieldLower = field.toLowerCase();
      let negatives = ['ÙˆØ¸Ø§Ø¦Ù', 'Ù…Ø¬Ø§Ù†ÙŠ', 'ØªØ¹Ù„ÙŠÙ…', 'Ø¯ÙˆØ±Ø§Øª', 'ØµÙˆØ±', 'ÙÙŠØ¯ÙŠÙˆ'];

      Object.entries(SMART_FIELDS).forEach(([key, data]) => {
        const match = data.synonyms.some(syn => fieldLower.includes(syn.toLowerCase())) || 
                     fieldLower.includes(key.toLowerCase());
        if (match && data.negatives) {
          negatives.push(...data.negatives);
        }
      });

      return [...new Set(negatives)];
    }

    function displayStrategy(data) {
      const strategyDiv = document.getElementById('strategyContent');
      const countryData = BENCHMARKS[data.country] || BENCHMARKS['Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'];
      
      strategyDiv.innerHTML = `
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin:20px 0">
          <div style="background:#F0F9FF;padding:15px;border-radius:12px;border-left:4px solid var(--primary)">
            <strong>ğŸ¯ Ø§Ù„Ù…Ø¬Ø§Ù„</strong><br><span style="font-size:1.1rem">${data.field}</span>
          </div>
          <div style="background:#F0FDF4;padding:15px;border-radius:12px;border-left:4px solid var(--success)">
            <strong>ğŸŒ Ø§Ù„Ø¯ÙˆÙ„Ø©</strong><br><span style="font-size:1.1rem">${data.country} (${countryData.currency})</span>
          </div>
          <div style="background:#FEF3C7;padding:15px;border-radius:12px;border-left:4px solid var(--warning)">
            <strong>ğŸ’° Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</strong><br><span style="font-size:1.1rem">${data.budget.toLocaleString()} ${countryData.currency}</span>
          </div>
          <div style="background:#FDF2F8;padding:15px;border-radius:12px;border-left:4px solid #EC4899">
            <strong>ğŸ“± Ø§Ù„Ù…Ù†ØµØ§Øª</strong><br><span style="font-size:1.1rem">${data.platforms.join(' â€¢ ')}</span>
          </div>
        </div>
        <div style="background:var(--bg-light);padding:20px;border-radius:12px;margin-top:15px;border-left:4px solid var(--primary)">
          <strong>ğŸ§  Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©:</strong> ØªÙ… ØªØ­Ù„ÙŠÙ„ "${data.field}" ÙˆØªÙˆÙ„ÙŠØ¯ <strong>${currentKeywords.length}</strong> ÙƒÙ„Ù…Ø© Ù…Ø®ØµØµØ© Ø­ØµØ±ÙŠÙ‹Ø§ Ù„Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: <strong>${data.platforms.join('ØŒ ')}</strong> ÙÙŠ ${data.country}
        </div>
      `;
    }

    function displayKeywords(keywords, matchType) {
      const keywordsDiv = document.getElementById('keywordsContent');
      
      if (groupedView) {
        displayKeywordsGrouped();
        return;
      }
      
      keywordsDiv.innerHTML = '<div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center"></div>';
      const container = keywordsDiv.firstElementChild;

      currentClassified.forEach(({keyword, platforms}, i) => {
        const pill = document.createElement('span');
        const platformTags = platforms.slice(0, 2).join('/');
        pill.innerHTML = `${keyword} <small style="opacity:0.65;font-size:0.7rem">[${platformTags}]</small>`;
        pill.className = i < 15 ? 'pill pill-ai' : i < 30 ? 'pill pill-expert' : 'pill pill-premium';
        container.appendChild(pill);
      });

      const statsEl = document.getElementById('keywordStats');
      if (statsEl) {
        statsEl.innerHTML = `
          ğŸ”‘ <strong>${keywords.length}</strong> ÙƒÙ„Ù…Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© â€¢ 
          ğŸ¯ Ù…Ø·Ø§Ø¨Ù‚Ø©: <strong>${getMatchTypeLabel(matchType)}</strong> â€¢ 
          ğŸ“± Ù…Ø±ØªØ¨Ø© ÙˆÙ…ØµÙ†ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ â€¢ 
          âš¡ <strong>Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰</strong>
        `;
      }
    }

    function displayKeywordsGrouped() {
      const keywordsDiv = document.getElementById('keywordsContent');
      const grouped = {};
      
      currentClassified.forEach(({keyword, platforms}) => {
        platforms.forEach(platform => {
          if (!grouped[platform]) grouped[platform] = [];
          grouped[platform].push(keyword);
        });
      });

      let content = '';
      Object.entries(grouped).forEach(([platform, kws]) => {
        content += `
          <div style="background:var(--bg-light);padding:15px;border-radius:12px;margin:10px 0;border-left:4px solid var(--primary)">
            <h4 style="margin:0 0 10px 0;color:var(--primary);font-size:1.1rem">${platform} (${kws.length} ÙƒÙ„Ù…Ø§Øª)</h4>
            <div style="display:flex;flex-wrap:wrap;gap:6px">
        `;
        
        kws.slice(0, 25).forEach(kw => {
          content += `<span class="pill pill-ai">${kw}</span>`;
        });
        
        content += '</div></div>';
      });
      
      keywordsDiv.innerHTML = content;
    }

    function displayNegatives(negatives) {
      const negativesDiv = document.getElementById('negativesContent');
      negativesDiv.innerHTML = '<div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center"></div>';
      const container = negativesDiv.firstElementChild;

      negatives.forEach(negative => {
        const pill = document.createElement('span');
        pill.textContent = `-${negative}`;
        pill.className = 'pill pill-negative';
        container.appendChild(pill);
      });

      document.getElementById('negativeSection').style.display = 'block';
    }

    function displayForecasts(data) {
      const forecastsDiv = document.getElementById('forecastsContent');
      const countryData = BENCHMARKS[data.country] || BENCHMARKS['Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'];
      const budgetPerPlatform = data.budget / data.platforms.length;

      let totalImpressions = 0, totalClicks = 0, totalConversions = 0;
      let content = '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;text-align:center">';

      data.platforms.forEach(platform => {
        const cpm = countryData.cpm[platform] || 2;
        const impressions = Math.round((budgetPerPlatform / cpm) * 1000);
        const clicks = Math.round(impressions * 0.018);
        const conversions = Math.round(clicks * 0.03);

        totalImpressions += impressions;
        totalClicks += clicks;
        totalConversions += conversions;

        const keywordCount = currentClassified.filter(({platforms}) => platforms.includes(platform)).length;

        content += `
          <div style="background:#F9FAFB;padding:15px;border-radius:12px;border:1px solid var(--border)">
            <div style="font-weight:800;color:var(--primary);margin-bottom:8px;font-size:1.1rem">${platform}</div>
            <div style="font-size:0.85rem;color:var(--neutral);line-height:1.4">
              <strong>ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØµØµØ©: ${keywordCount}</strong><br>
              CPM: $${cpm.toFixed(2)}<br>
              Ù…ÙŠØ²Ø§Ù†ÙŠØ©: ${Math.round(budgetPerPlatform).toLocaleString()} ${countryData.currency}<br>
              Ø¸Ù‡ÙˆØ±: ${impressions.toLocaleString()}<br>
              Ù†Ù‚Ø±Ø§Øª: ${clicks.toLocaleString()}<br>
              ØªØ­ÙˆÙŠÙ„Ø§Øª: ${conversions.toLocaleString()}
            </div>
          </div>
        `;
      });

      content += `
        <div style="background:#EFF6FF;padding:20px;border-radius:12px;border:2px solid var(--primary);grid-column:1/-1">
          <div style="font-weight:800;color:var(--primary);font-size:1.2rem;margin-bottom:10px">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
          <div style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap">
            <div style="color:var(--neutral)"><strong>Ø¸Ù‡ÙˆØ±:</strong> ${totalImpressions.toLocaleString()}</div>
            <div style="color:var(--neutral)"><strong>Ù†Ù‚Ø±Ø§Øª:</strong> ${totalClicks.toLocaleString()}</div>
            <div style="color:var(--neutral)"><strong>ØªØ­ÙˆÙŠÙ„Ø§Øª:</strong> ${totalConversions.toLocaleString()}</div>
            <div style="color:var(--success)"><strong>ROAS Ù…ØªÙˆÙ‚Ø¹:</strong> 3.5x - 6.2x</div>
          </div>
        </div>
      </div>`;

      forecastsDiv.innerHTML = content;
    }

    // Control functions
    function resetSettings() {
      localStorage.removeItem('ads-tool-settings');
      localStorage.clear(); // Clear cache too
      location.reload();
    }

    function shareState() {
      const stateData = {
        field: document.getElementById('field').value,
        country: document.getElementById('country').value,
        dialect: document.getElementById('dialect').value,
        budget: document.getElementById('budget').value,
        matchType: document.getElementById('matchType').value,
        expansion: document.getElementById('expansion').value,
        platforms: selectedPlatforms
      };
      
      const hash = encodeURIComponent(JSON.stringify(stateData));
      const url = `${location.protocol}//${location.host}${location.pathname}#${hash}`;
      
      navigator.clipboard.writeText(url).then(() => {
        alert('âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„Ø© - ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
      }).catch(() => {
        prompt('Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·:', url);
      });
    }

    function toggleGrouping() {
      groupedView = !groupedView;
      const btn = document.getElementById('groupByPlatform');
      if (btn) {
        btn.innerHTML = groupedView ? 'ğŸ“‹ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø©' : 'ğŸ“± ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØµØ©';
      }
      displayKeywords(currentKeywords, currentData.matchType);
    }

    // Export functions
    function copyKeywords() {
      if (currentKeywords.length === 0) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù„Ù†Ø³Ø®Ù‡Ø§');
        return;
      }
      navigator.clipboard.writeText(currentKeywords.join('\n')).then(() => {
        alert(`âœ… ØªÙ… Ù†Ø³Ø® ${currentKeywords.length} ÙƒÙ„Ù…Ø©`);
      });
    }

    function copyNegatives() {
      if (currentNegatives.length === 0) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ø³Ù„Ø¨ÙŠØ©');
        return;
      }
      const list = currentNegatives.map(n => `-${n}`);
      navigator.clipboard.writeText(list.join('\n')).then(() => {
        alert(`âœ… ØªÙ… Ù†Ø³Ø® ${currentNegatives.length} ÙƒÙ„Ù…Ø© Ø³Ù„Ø¨ÙŠØ©`);
      });
    }

    function exportXLSX() {
      if (!window.XLSX) {
        alert('âŒ Ù…ÙƒØªØ¨Ø© XLSX ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© - Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± CSV');
        exportCSV();
        return;
      }

      try {
        const wb = XLSX.utils.book_new();
        const now = new Date();
        const countryData = BENCHMARKS[currentData.country] || BENCHMARKS['Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'];

        // Summary sheet
        const summaryData = [
          ['ğŸ¯ Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', ''], ['', ''],
          ['Ø§Ù„Ù…Ø¬Ø§Ù„', currentData.field],
          ['Ø§Ù„Ø¯ÙˆÙ„Ø©', currentData.country],
          ['Ø§Ù„Ø¹Ù…Ù„Ø©', countryData.currency],
          ['Ø§Ù„Ù„Ù‡Ø¬Ø©', currentData.dialect === 'classical' ? 'Ø§Ù„ÙØµØ­Ù‰' : 'Ù…Ø­Ù„ÙŠØ©'],
          ['Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', `${currentData.budget} ${countryData.currency}`],
          ['Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©', getMatchTypeLabel(currentData.matchType)],
          ['Ø§Ù„ØªÙˆØ³Ø¹', currentData.expansion],
          ['Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©', currentData.platforms.join(' â€¢ ')],
          ['Ø§Ù„ØªÙˆÙ„ÙŠØ¯', now.toLocaleString('ar-SA')],
          ['', ''],
          ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª', currentKeywords.length],
          ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ø¨ÙŠØ©', currentNegatives.length],
          ['Ø§Ù„Ù†ÙˆØ¹', 'ÙŠØ¯ÙˆÙŠ Ù…ØªÙ‚Ø¯Ù… + Ø°ÙƒØ§Ø¡ + ØªØµÙ†ÙŠÙ + ÙÙ„ØªØ±Ø© Ù…Ù†ØµØ§Øª']
        ];
        
        const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
        XLSX.utils.book_append_sheet(wb, wsSummary, 'Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù…Ù„Ø©');

        // Keywords with classification
        const keywordRows = [['Ø§Ù„ÙƒÙ„Ù…Ø©', 'Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©', 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©', 'Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©', 'CPC ØªÙ‚Ø¯ÙŠØ±ÙŠ', 'Ø³Ø¨Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ']];
        currentClassified.forEach(({keyword, platforms, score}, i) => {
          const priority = i < 15 ? 'Ø¹Ø§Ù„ÙŠØ©' : i < 30 ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©';
          const cpcEstimate = estimateCPC(keyword, currentData.country, score);
          const reason = score > 7 ? 'Ù†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©' : score > 4 ? 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø´ÙŠÙˆØ¹' : 'Ø¹Ø§Ù…';
          keywordRows.push([keyword, getMatchTypeLabel(currentData.matchType), priority, platforms.join('/'), cpcEstimate, reason]);
        });
        
        const wsKeywords = XLSX.utils.aoa_to_sheet(keywordRows);
        XLSX.utils.book_append_sheet(wb, wsKeywords, 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØµÙ†ÙØ©');

        // Strategy with platform distribution
        const strategyRows = [['Ø§Ù„Ù…Ù†ØµØ©', 'Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'Ø§Ù„Ù‡Ø¯Ù', 'Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', 'CPM Ù…ØªÙˆÙ‚Ø¹', 'ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØµØµØ©']];
        const budgetPer = currentData.budget / currentData.platforms.length;
        
        currentData.platforms.forEach(platform => {
          const cpm = countryData.cpm[platform] || 2;
          const adType = getAdType(platform);
          const goal = getGoal(platform);
          const kwCount = currentClassified.filter(({platforms}) => platforms.includes(platform)).length;
          strategyRows.push([platform, adType, goal, `${Math.round(budgetPer)} ${countryData.currency}`, `$${cpm.toFixed(2)}`, kwCount]);
        });
        
        const wsStrategy = XLSX.utils.aoa_to_sheet(strategyRows);
        XLSX.utils.book_append_sheet(wb, wsStrategy, 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…ÙØµÙ„Ø©');

        // Negatives
        const negRows = [['Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ù„Ø¨ÙŠØ©', 'Ø§Ù„Ø³Ø¨Ø¨', 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©']];
        currentNegatives.forEach(neg => negRows.push([neg, 'ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø±', 'Ø¹Ø§Ù„ÙŠØ©']));
        const wsNegatives = XLSX.utils.aoa_to_sheet(negRows);
        XLSX.utils.book_append_sheet(wb, wsNegatives, 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©');

        const fileName = `Advanced-${currentData.field.replace(/\s+/g,'-')}-${Date.now()}.xlsx`;
        XLSX.writeFile(wb, fileName);
        alert('âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ XLSX Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ CPC ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†ØµØ§Øª!');

      } catch (error) {
        console.error('Ø®Ø·Ø£ XLSX:', error);
        exportCSV();
      }
    }

    function exportGoogleCSV() {
      const csvRows = ['Campaign,Ad Group,Keyword,Criterion Type,First page bid'];
      const campaignName = `${currentData.field} - ${currentData.country}`;
      
      const googleKeywords = currentClassified.filter(({platforms}) => platforms.includes('Google Ads'));
      
      if (googleKeywords.length === 0) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù€ Google Ads ÙÙŠ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©');
        return;
      }

      googleKeywords.forEach(({keyword}) => {
        const bid = estimateCPC(keyword, currentData.country, 5).replace('$', '');
        csvRows.push(`${campaignName},${currentData.field},${keyword},Exact,${bid}`);
      });
      
      downloadCSV(csvRows.join('\n'), `GoogleAds-${currentData.field.replace(/\s+/g,'-')}.csv`);
      alert(`âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ ${googleKeywords.length} ÙƒÙ„Ù…Ø© Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Google Ads Editor!`);
    }

    function exportCSV() {
      const rows = ['Ø§Ù„ÙƒÙ„Ù…Ø©,Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©,Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©,Ø§Ù„Ù…Ù†ØµØ§Øª,CPC'];
      currentClassified.forEach(({keyword, platforms, score}, i) => {
        const priority = i < 15 ? 'Ø¹Ø§Ù„ÙŠØ©' : 'Ù…ØªÙˆØ³Ø·Ø©';
        const cpc = estimateCPC(keyword, currentData.country, score);
        rows.push(`${keyword},${getMatchTypeLabel(currentData.matchType)},${priority},${platforms.join('/')},${cpc}`);
      });
      downloadCSV('\ufeff' + rows.join('\n'), `Keywords-${Date.now()}.csv`);
      alert('âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù CSV!');
    }

    function exportPDF() {
      alert('ğŸ“„ PDF Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…ØªØ§Ø­ Ù‚Ø±ÙŠØ¨Ø§Ù‹ - Ø§Ø³ØªØ®Ø¯Ù… XLSX ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ');
    }

    function exportProfile() {
      const profile = {
        ...currentData,
        keywords: currentKeywords,
        negatives: currentNegatives,
        classified: currentClassified,
        generated_at: new Date().toISOString(),
        mode: 'advanced_manual'
      };
      
      const blob = new Blob([JSON.stringify(profile, null, 2)], {type: 'application/json'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `Profile-${currentData.field.replace(/\s+/g,'-')}.json`;
      link.click();
      URL.revokeObjectURL(link.href);
      alert('âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ JSON Ø´Ø§Ù…Ù„!');
    }

    function downloadCSV(content, filename) {
      const blob = new Blob([content], {type: 'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
      URL.revokeObjectURL(link.href);
    }

    // Utility functions
    function estimateCPC(keyword, country, score) {
      const countryData = BENCHMARKS[country] || BENCHMARKS['Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'];
      const baseCPM = countryData.cpm['Google Ads'] || 2;
      const intentMultiplier = score > 7 ? 1.8 : score > 5 ? 1.4 : score > 3 ? 1.2 : 1.0;
      return '$' + (baseCPM * intentMultiplier * 0.8).toFixed(2);
    }

    function getMatchTypeLabel(matchType) {
      const labels = {
        'mixed': 'Ù…Ø²ÙŠØ¬',
        'phrase': 'Ø¹Ø¨Ø§Ø±Ø©', 
        'broad': 'ÙˆØ§Ø³Ø¹Ø©',
        'exact': 'ØªØ§Ù…Ø©'
      };
      return labels[matchType] || matchType;
    }

    function getAdType(platform) {
      const types = {
        'Google Ads': 'Ø¨Ø­Ø« Ù…Ø­Ù„ÙŠ + Ø®Ø±Ø§Ø¦Ø·',
        'Facebook': 'Lead Generation + Carousel',
        'Instagram': 'Stories + Reels + Feed',
        'TikTok': 'Short Video Ads',
        'YouTube': 'In-Stream + Discovery',
        'LinkedIn': 'Sponsored Content',
        'Snapchat': 'Geo Filters + Stories'
      };
      return types[platform] || 'Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ù…';
    }

    function getGoal(platform) {
      const goals = {
        'Google Ads': 'ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©',
        'Facebook': 'ØªÙˆÙ„ÙŠØ¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„ÙŠÙ†',
        'Instagram': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ¹ÙŠ ÙˆØ§Ù„ØªÙØ§Ø¹Ù„',
        'TikTok': 'Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯',
        'YouTube': 'Ø´Ø±Ø­ ÙˆØªÙˆØ¹ÙŠØ©',
        'LinkedIn': 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ù…Ù‡Ù†ÙŠ B2B',
        'Snapchat': 'Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø¬ØºØ±Ø§ÙÙŠ Ø³Ø±ÙŠØ¹'
      };
      return goals[platform] || 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ¹ÙŠ';
    }

    // Settings management
    function loadSettings() {
      try {
        const saved = localStorage.getItem('ads-tool-settings');
        if (saved) {
          const settings = JSON.parse(saved);
          if (settings.country) document.getElementById('country').value = settings.country;
          if (settings.dialect) document.getElementById('dialect').value = settings.dialect;
          if (settings.matchType) document.getElementById('matchType').value = settings.matchType;
          if (settings.expansion) document.getElementById('expansion').value = settings.expansion;
          if (settings.budget) document.getElementById('budget').value = settings.budget;
          if (settings.platforms) {
            selectedPlatforms = settings.platforms;
            updatePlatformButtons();
          }
        }
      } catch(e) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', e);
      }
    }

    function saveSettings() {
      try {
        const settings = {
          country: document.getElementById('country').value,
          dialect: document.getElementById('dialect').value,
          matchType: document.getElementById('matchType').value,
          expansion: document.getElementById('expansion').value,
          budget: document.getElementById('budget').value,
          platforms: selectedPlatforms
        };
        localStorage.setItem('ads-tool-settings', JSON.stringify(settings));
      } catch(e) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', e);
      }
    }

    function updatePlatformButtons() {
      const btns = document.querySelectorAll('.platform-btn');
      btns.forEach(btn => {
        btn.classList.toggle('active', selectedPlatforms.includes(btn.dataset.platform));
      });
      updateSelectedPlatformsDisplay();
    }

    function loadFromHash() {
      if (location.hash) {
        try {
          const data = JSON.parse(decodeURIComponent(location.hash.slice(1)));
          if (data.field) document.getElementById('field').value = data.field;
          if (data.country) document.getElementById('country').value = data.country;
          if (data.dialect) document.getElementById('dialect').value = data.dialect;
          if (data.matchType) document.getElementById('matchType').value = data.matchType;
          if (data.expansion) document.getElementById('expansion').value = data.expansion;
          if (data.budget) document.getElementById('budget').value = data.budget;
          if (data.platforms) {
            selectedPlatforms = data.platforms;
            updatePlatformButtons();
          }
        } catch(e) {
          console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·:', e);
        }
      }
    }

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Initialize on load
    window.addEventListener('load', function() {
      console.log('ğŸ¯ Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø© ØªÙ…Ø§Ù…Ø§Ù‹');
      loadSettings();
    });
  </script>
</body>
</html>