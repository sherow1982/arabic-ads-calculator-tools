<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø¨Ø§Ù„Ø¨Ù„Ø¯ ÙˆØ§Ù„Ù…Ø¬Ø§Ù„</title>
  <link rel="icon" href="/favicon.svg">
  <link rel="stylesheet" href="/global-styles.css" />
  <style>
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;margin:12px 0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .grid{display:grid;gap:16px}
    @media(min-width:960px){.grid{grid-template-columns:1.2fr .8fr}}
    .muted{color:#666;font-size:.92rem}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi div{background:#f6f7f9;border:1px solid #e7e9ee;border-radius:10px;padding:10px 12px}
    .pill{display:inline-block;background:#eef6ff;color:#1453b3;border:1px solid #cfe3ff;padding:4px 10px;border-radius:999px;margin:2px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .danger{color:#b10}
    .success{color:#0a5}
    .warn{color:#b80}
    .spinner{display:none}
  </style>
</head>
<body>
  <div id="app" class="container">
    <h1>ğŸ¯ Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</h1>
    <p class="muted">Ø£Ø¯Ø®Ù„ <b>Ø§Ù„Ø¯ÙˆÙ„Ø©</b> Ùˆ<b>Ù…Ø¬Ø§Ù„ Ø¹Ù…Ù„Ùƒ</b> Ù„Ù†ÙˆÙ„Ù‘Ø¯: ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ø¹Ø±Ø¨ÙŠØ©ØŒ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†ØŒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©ØŒ ÙˆØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø¸Ù‡ÙˆØ±/Ø§Ù„Ù†Ù‚Ø±Ø§Øª/Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª/Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª.</p>

    <div class="card">
      <div class="grid">
        <div>
          <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
          <input id="country" list="countries" placeholder="Ù…Ø«Ø§Ù„: Ù…ØµØ±ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŒ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª" />
          <datalist id="countries"></datalist>
        </div>
        <div>
          <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„</label>
          <input id="sector" list="sectors" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©ØŒ Ù…Ø·Ø§Ø¹Ù…ØŒ Ø¹Ù‚Ø§Ø±Ø§Øª" />
          <datalist id="sectors"></datalist>
        </div>
      </div>
      <div class="grid">
        <div>
          <label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>
          <input id="currency" disabled />
        </div>
        <div>
          <label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
          <input id="monthlyBudget" type="number" min="100" step="50" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
        </div>
      </div>
      <button id="analyzeBtn">ØªØ­Ù„ÙŠÙ„ ÙˆØ¥ØµØ¯Ø§Ø± Ø§Ù„ØªÙˆØµÙŠØ§Øª</button> <span class="spinner" id="spinner">â³</span>
      <div class="muted">ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©/ØªÙ‚Ø¯ÙŠØ±ÙŠØ© ÙˆØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…ØªÙˆØ³Ø·Ø§Øª Ø³ÙˆÙ‚ÙŠØ© Ø¹Ø§Ù…Ø©. ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ØµØªÙƒ Ø§Ù„ÙØ¹Ù„ÙŠØ©.</div>
    </div>

    <div id="results" style="display:none">
      <div class="card">
        <h2>âœ… Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£Ù†Ø³Ø¨ ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„</h2>
        <div id="platforms" class="chips"></div>
        <p class="muted" id="platformNotes"></p>
      </div>

      <div class="card">
        <h2>ğŸ”‘ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h2>
        <div id="keywords" class="chips"></div>
      </div>

      <div class="card">
        <h2>ğŸ’° Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h2>
        <div id="budgetAdvice" class="kpi"></div>
        <p class="muted">ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ØªÙˆØ³Ø·Ø§Øª ÙƒÙ„ Ø¨Ù„Ø¯ ÙˆÙ…Ø¬Ø§Ù„. Ø§Ø¶Ø¨Ø·Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø­Ø³Ø¨ Ø£Ø¯Ø§Ø¡ Ø­Ù…Ù„Ø§ØªÙƒ.</p>
      </div>

      <div class="card">
        <h2>ğŸ“ˆ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª (Ø´Ù‡Ø±ÙŠÙ‹Ø§)</h2>
        <div class="kpi" id="forecasts"></div>
        <p class="muted">Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©: Ø§Ù„Ø¸Ù‡ÙˆØ± = Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©/CPM Ã— 1000ØŒ Ø§Ù„Ù†Ù‚Ø±Ø§Øª = Ø§Ù„Ø¸Ù‡ÙˆØ± Ã— CTRØŒ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª = Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ã— CVRØŒ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª = Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ã— Ù…Ø¹Ø¯Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡.</p>
      </div>

      <div class="card">
        <h2>ğŸ§ª Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h2>
        <ol id="playbook"></ol>
      </div>
    </div>
  </div>

  <script>
    // Load benchmarks JSON
    async function loadBenchmarks(){
      const res = await fetch('/data/ads-country-benchmarks.json');
      return res.json();
    }

    function formatNumber(n){
      return new Intl.NumberFormat('ar-EG').format(Math.round(n || 0));
    }

    function pick(arr, n=12){
      if(!arr||!arr.length) return [];
      const out = [];
      const used = new Set();
      for(let i=0;i<Math.min(n, arr.length);i++){
        let idx = Math.floor(Math.random()*arr.length);
        let guard=0;
        while(used.has(idx) && guard<10){ idx = Math.floor(Math.random()*arr.length); guard++; }
        used.add(idx); out.push(arr[idx]);
      }
      return out;
    }

    function computeForecasts(country, sector, monthlyBudget){
      // choose platform with lowest CPM among recommended to maximize impressions if budget limited
      const platforms = country.recommended_platforms;
      const cpmOptions = country.avg_cpm || {};
      const ctr = sector.avg_conversion_rate ? Math.max(0.008, sector.avg_conversion_rate/2) : 0.012; // proxy CTR
      const cvr = sector.avg_conversion_rate || 0.02; // baseline CVR by sector
      const purchaseRate = 0.7; // fraction of conversions that result in actual purchases (lead vs sale)

      // Use weighted CPM based on typical mix (first platform weight 0.5, others 0.5/(n-1))
      let weightedCPM = 0; let totalWeight=0;
      platforms.forEach((p, i)=>{
        const w = i===0?0.5:(0.5/(platforms.length-1));
        const cpm = cpmOptions[p] || Object.values(cpmOptions)[0] || 2.0;
        weightedCPM += w * cpm; totalWeight += w;
      });
      if(totalWeight>0) weightedCPM /= totalWeight; else weightedCPM = 2.0;

      const impressions = (monthlyBudget / weightedCPM) * 1000;
      const clicks = impressions * ctr;
      const conversions = clicks * cvr;
      const sales = conversions * purchaseRate;

      return {weightedCPM, ctr, cvr, impressions, clicks, conversions, sales};
    }

    (async function init(){
      const data = await loadBenchmarks();
      const countriesMap = data.countries || {};
      const sectorsMap = data.business_sectors || {};

      // populate datalists
      const cList = document.getElementById('countries');
      Object.keys(countriesMap).forEach(k=>{
        const o = document.createElement('option');
        o.value = countriesMap[k].name || k; cList.appendChild(o);
      });
      const sList = document.getElementById('sectors');
      Object.keys(sectorsMap).forEach(k=>{
        const o = document.createElement('option');
        o.value = sectorsMap[k].name || k; sList.appendChild(o);
      });

      const countryInput = document.getElementById('country');
      const sectorInput = document.getElementById('sector');
      const currencyInput = document.getElementById('currency');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const spinner = document.getElementById('spinner');

      analyzeBtn.addEventListener('click', ()=>{
        const cVal = countryInput.value.trim();
        const sVal = sectorInput.value.trim();
        const budgetVal = parseFloat(document.getElementById('monthlyBudget').value || '0');

        const country = Object.values(countriesMap).find(c=> c.name===cVal || cVal===c.key || cVal===c.code) || null;
        const sector = Object.values(sectorsMap).find(s=> s.name===sVal) || null;

        if(!country || !sector){
          alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© ÙˆÙ…Ø¬Ø§Ù„ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©');
          return;
        }

        currencyInput.value = country.currency || '';

        spinner.style.display='inline-block';
        setTimeout(()=>{
          renderResults(country, sector, budgetVal || suggestBudget(country));
          spinner.style.display='none';
        }, 150);
      });

      function suggestBudget(country){
        const r = country.budget_ranges || {small:{min:2000,max:8000}};
        return Math.round((r.small.min + r.small.max)/2);
      }

      function renderResults(country, sector, monthlyBudget){
        document.getElementById('results').style.display='block';

        // Platforms
        const platformsEl = document.getElementById('platforms');
        platformsEl.innerHTML='';
        (country.recommended_platforms||[]).forEach((p,i)=>{
          const span = document.createElement('span');
          span.className='pill';
          span.textContent = `${i+1} - ${p}`;
          platformsEl.appendChild(span);
        });
        document.getElementById('platformNotes').textContent = `Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆÙ‚ ÙÙŠ ${country.name}. Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…ÙØ¶Ù„Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.`;

        // Keywords
        const kwEl = document.getElementById('keywords');
        kwEl.innerHTML='';
        pick(sector.keywords, 20).forEach(k=>{
          const span=document.createElement('span'); span.className='pill'; span.textContent=k; kwEl.appendChild(span);
        });

        // Budget
        const bEl = document.getElementById('budgetAdvice');
        bEl.innerHTML='';
        const ranges = country.budget_ranges || {};
        [['ØµØºÙŠØ±',ranges.small],['Ù…ØªÙˆØ³Ø·',ranges.medium],['ÙƒØ¨ÙŠØ±',ranges.large]].forEach(([label,range])=>{
          if(!range) return;
          const div = document.createElement('div');
          div.innerHTML = `<b>${label}</b><br>${formatNumber(range.min)} - ${formatNumber(range.max)} ${country.currency}`;
          bEl.appendChild(div);
        });

        // Forecasts
        const f = computeForecasts(country, sector, monthlyBudget);
        const fEl = document.getElementById('forecasts');
        fEl.innerHTML='';
        const items=[
          ['Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', `${formatNumber(monthlyBudget)} ${country.currency}`],
          ['CPM Ù…Ø±Ø¬Ø­', `$${f.weightedCPM.toFixed(2)}`],
          ['CTR ØªÙ‚Ø¯ÙŠØ±ÙŠ', `${(f.ctr*100).toFixed(1)}%`],
          ['CVR ØªÙ‚Ø¯ÙŠØ±ÙŠ', `${(f.cvr*100).toFixed(1)}%`],
          ['Ø§Ù„Ø¸Ù‡ÙˆØ±', formatNumber(f.impressions)],
          ['Ø§Ù„Ù†Ù‚Ø±Ø§Øª', formatNumber(f.clicks)],
          ['Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª', formatNumber(f.conversions)],
          ['Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©', formatNumber(f.sales)]
        ];
        items.forEach(([k,v])=>{ const d=document.createElement('div'); d.innerHTML = `<b>${k}</b><br>${v}`; fEl.appendChild(d); });

        // Playbook
        const play = document.getElementById('playbook');
        play.innerHTML='';
        [
          'Ø§Ø¨Ø¯Ø£ Ø¨Ø­Ù…Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± 7-10 Ø£ÙŠØ§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ù…ÙŠØ²Ø§Ù†ÙŠØ© 60% ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØªÙŠÙ† 2 Ùˆ3.',
          'Ø§Ø¨Ù†Ù 3 Ø´Ø±Ø§Ø¦Ø­ Ø¬Ù…Ø§Ù‡ÙŠØ±ÙŠØ©: Ø§Ù‡ØªÙ…Ø§Ù…/Ù…Ø´Ø§Ø¨Ù‡/Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªÙ‡Ø¯Ø§ÙØŒ Ù…Ø¹ 2-3 Ø¥Ø¨Ø¯Ø§Ø¹Ø§Øª Ù„ÙƒÙ„ Ø´Ø±ÙŠØ­Ø©.',
          'Ø±Ø§Ù‚Ø¨ CPM/CTR/CVR ÙŠÙˆÙ…ÙŠÙ‹Ø§. Ø£ÙˆÙ‚Ù Ù…Ø§ Ù‡Ùˆ Ø£Ø³ÙˆØ£ 30% Ø£Ø¯Ø§Ø¡ ÙˆØ¯ÙˆÙ‘Ø± Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ù„Ù„Ø£ÙØ¶Ù„.',
          'Ø§Ø®ØªØ¨Ø± ØµÙØ­Ø§Øª Ø§Ù„Ù‡Ø¨ÙˆØ· ÙˆØ±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø±Ø¶. Ø§Ø³ØªÙ‡Ø¯Ù Ø²ÙŠØ§Ø¯Ø© Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ 20-30%.',
          'Ø¨Ø¹Ø¯ 2-3 Ø¯ÙˆØ±Ø§Øª Ø§Ø®ØªØ¨Ø§Ø±ØŒ Ø«Ø¨Ù‘Øª Ù…Ø²ÙŠØ¬ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙˆØ§Ø¨Ø¯Ø£ ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§.'
        ].forEach(step=>{ const li=document.createElement('li'); li.textContent=step; play.appendChild(li); });
      }
    })();
  </script>
</body>
</html>
