<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
  <link rel="icon" href="../favicon.svg">
  <link rel="stylesheet" href="../global-styles.css" />
  <style>
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;margin:12px 0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .grid{display:grid;gap:16px}
    @media(min-width:960px){.grid{grid-template-columns:repeat(3,1fr)}}
    .muted{color:#666;font-size:.92rem}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi div{background:#f6f7f9;border:1px solid #e7e9ee;border-radius:10px;padding:10px 12px}
    .pill{display:inline-block;background:#eef6ff;color:#1453b3;border:1px solid #cfe3ff;padding:4px 10px;border-radius:999px;margin:2px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .warn{color:#b80}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row .col{flex:1 1 260px}
    .small{font-size:.85rem}
    .error{background:#ffe8e6;color:#b10;border:1px solid #f3b1aa;padding:10px 12px;border-radius:10px;margin:10px 0;display:none}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{background:var(--gradient);color:#fff;border:none;border-radius:20px;padding:8px 14px;cursor:pointer}
    .platforms{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .platforms label{display:flex;align-items:center;gap:6px;background:#f6f7f9;border:1px solid #e7e9ee;border-radius:999px;padding:6px 10px;cursor:pointer}
    .intent-group{margin:8px 0;padding:8px;background:#f9f9f9;border-radius:8px}
    .intent-title{font-weight:bold;color:#555;margin-bottom:4px}
  </style>
</head>
<body>
  <div class="container" id="app">
    <h1>ğŸ¯ Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)</h1>
    <p class="muted">Ù…ÙˆÙ„Ù‘Ø¯ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø« Ø¹Ø±Ø¨ÙŠØ© Ù…ÙˆØ«ÙˆÙ‚ <b>ÙŠØ¹Ù…Ù„ ÙÙˆØ±Ù‹Ø§</b> - Ø§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„Ùƒ ÙˆØ§Ø®ØªØ± Ø¯ÙˆÙ„ØªÙƒ ÙˆØ³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ 30+ ÙƒÙ„Ù…Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø¬Ø§Ù„ Ù…Ø¹ Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø¨Ø­Ø«ØŒ ÙˆÙ…Ø²ÙŠØ¬ Ù‚Ù†ÙˆØ§Øª ÙˆØªÙˆØ²ÙŠØ¹ Ù…ÙŠØ²Ø§Ù†ÙŠØ© ÙˆØªÙˆÙ‚Ø¹Ø§Øª. Ù…Ø¹ <b>ØªØµØ¯ÙŠØ± XLSX</b> Ø¬Ø§Ù‡Ø².</p>

    <div id="err" class="error">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„. Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© (Ctrl+F5).</div>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
          <select id="country" disabled>
            <option value="">Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø©</option>
            <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
            <option value="Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
            <option value="Ø§Ù„ÙƒÙˆÙŠØª">Ø§Ù„ÙƒÙˆÙŠØª</option>
            <option value="Ù‚Ø·Ø±">Ù‚Ø·Ø±</option>
            <option value="Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†">Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
            <option value="Ø¹ÙÙ…Ø§Ù†">Ø¹ÙÙ…Ø§Ù†</option>
            <option value="Ù…ØµØ±">Ù…ØµØ±</option>
          </select>
        </div>
        <div class="col">
          <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ (Ø£ÙƒØªØ¨ Ø¨Ø­Ø±ÙŠØ©)</label>
          <input id="sectorFree" placeholder="Ù…Ø«Ø§Ù„: Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«ØŒ Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©ØŒ Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ" />
        </div>
        <div class="col">
          <label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</label>
          <input id="budget" type="number" min="500" step="100" value="5000" placeholder="Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©" />
        </div>
      </div>

      <div class="row">
        <div class="col" style="flex:1 1 100%">
          <label>Ø§Ù„Ù…Ù†ØµØ§Øª (ÙØ¹Ù‘Ù„/Ø£ÙˆÙ‚Ù)</label>
          <div class="platforms" id="platformToggles"></div>
        </div>
      </div>

      <button id="run" disabled>ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù„ + Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</button>
      <div class="actions">
        <button id="copyAll" class="btn" disabled>Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
        <button id="exportXlsx" class="btn" disabled>ØªÙ†Ø²ÙŠÙ„ XLSX</button>
        <button id="demo" class="btn">Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
      </div>
      <p class="small warn">Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØªÙÙˆÙ„Ù‘Ø¯ Ù…Ù† Ù‚ÙˆØ§Ù…ÙŠØ³ Ù…ÙˆØ«ÙˆÙ‚Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù…Ø¹ Ù†ÙˆØ§ÙŠØ§ Ø¨Ø­Ø« Ø¹Ø±Ø¨ÙŠØ© Ø´Ø§Ø¦Ø¹Ø©. ØªØ¹Ù…Ù„ ÙÙˆØ±Ù‹Ø§ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª.</p>
    </div>

    <div id="out" style="display:none">
      <div class="card">
        <h2>ğŸ”‘ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù…Ø¬Ø§Ù„Ùƒ</h2>
        <div id="keywords"></div>
        <p class="muted small" id="keywordStats"></p>
      </div>

      <div class="card">
        <h2>âœ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆÙ…Ø²ÙŠØ¬ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h2>
        <div id="mix" class="chips"></div>
        <p class="muted small" id="mixNote"></p>
      </div>

      <div class="card">
        <h2>ğŸ’° ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­</h2>
        <div id="allocation" class="kpi"></div>
      </div>

      <div class="card">
        <h2>ğŸ“ˆ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©</h2>
        <div id="forecasts" class="kpi"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/xlsx-exporter.js"></script>
  <script>
    const COUNTRY_DATA = {
      'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {currency:'SAR', platforms:['Google Ads','Facebook','Instagram','Snapchat','TikTok'], cpm:{Facebook:1.8,'Google Ads':2.2,Instagram:2.0,Snapchat:3.1,TikTok:2.5}},
      'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': {currency:'AED', platforms:['Google Ads','Facebook','Instagram','LinkedIn','YouTube'], cpm:{Facebook:2.1,'Google Ads':2.8,Instagram:2.3,LinkedIn:4.2,YouTube:1.9}},
      'Ø§Ù„ÙƒÙˆÙŠØª': {currency:'KWD', platforms:['Google Ads','Facebook','Instagram','Snapchat'], cpm:{Facebook:1.5,'Google Ads':1.9,Instagram:1.7,Snapchat:2.8}},
      'Ù‚Ø·Ø±': {currency:'QAR', platforms:['Google Ads','Facebook','Instagram','YouTube'], cpm:{Facebook:2.3,'Google Ads':3.1,Instagram:2.6,YouTube:2.0}},
      'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†': {currency:'BHD', platforms:['Google Ads','Facebook','Instagram'], cpm:{Facebook:1.4,'Google Ads':1.8,Instagram:1.6}},
      'Ø¹ÙÙ…Ø§Ù†': {currency:'OMR', platforms:['Google Ads','Facebook','Instagram'], cmp:{Facebook:1.6,'Google Ads':2.0,Instagram:1.8}},
      'Ù…ØµØ±': {currency:'EGP', platforms:['Facebook','Instagram','Google Ads','TikTok','YouTube'], cpm:{Facebook:0.4,'Google Ads':0.6,Instagram:0.5,TikTok:0.7,YouTube:0.3}}
    };

    const SECTOR_KEYWORDS = {
      'Ù†Ù‚Ù„': {
        base: ['Ù†Ù‚Ù„','ØªØ±Ø­ÙŠÙ„','Ø´Ø­Ù†','ØªØ­Ù…ÙŠÙ„','ØªÙ†Ø²ÙŠÙ„'],
        items: ['Ø£Ø«Ø§Ø«','Ø¹ÙØ´','Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§','Ø§Ø«Ø§Ø« Ù…Ù†Ø²Ù„ÙŠ','Ø§Ø«Ø§Ø« Ù…ÙƒØªØ¨ÙŠ','Ù…Ø¹Ø¯Ø§Øª','Ø¨Ø¶Ø§Ø¦Ø¹'],
        intents: ['Ø³Ø¹Ø±','Ø§Ø³Ø¹Ø§Ø±','ØªÙƒÙ„ÙØ©','Ù‚Ø±ÙŠØ¨','Ø¨Ø§Ù„Ù‚Ø±Ø¨','Ø­Ø¬Ø²','Ø·Ù„Ø¨','Ø±Ù‚Ù…','Ù‡Ø§ØªÙ','Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†','Ø§Ø±Ø®Øµ','Ø§ÙØ¶Ù„','Ø¹Ø±ÙˆØ¶','Ø®ØµÙ…','24 Ø³Ø§Ø¹Ø©']
      },
      'Ù†Ø¸Ø§ÙØ©': {
        base: ['ØªÙ†Ø¸ÙŠÙ','Ù†Ø¸Ø§ÙØ©','ØªØ¹Ù‚ÙŠÙ…','ØºØ³ÙŠÙ„','ØªÙ„Ù…ÙŠØ¹'],
        items: ['Ù…Ù†Ø§Ø²Ù„','Ø´Ù‚Ù‚','ÙÙ„Ù„','Ù…ÙƒØ§ØªØ¨','Ù…Ø­Ù„Ø§Øª','Ø³Ø¬Ø§Ø¯','ÙƒÙ†Ø¨','Ù…ÙˆÙƒÙŠØª','ÙˆØ§Ø¬Ù‡Ø§Øª','Ø®Ø²Ø§Ù†Ø§Øª','Ù…Ø³Ø§Ø¨Ø­'],
        intents: ['Ø³Ø¹Ø±','Ø§Ø³Ø¹Ø§Ø±','ØªÙƒÙ„ÙØ©','Ù‚Ø±ÙŠØ¨','Ø¨Ø§Ù„Ù‚Ø±Ø¨','Ø­Ø¬Ø²','Ø·Ù„Ø¨','Ø±Ù‚Ù…','Ù‡Ø§ØªÙ','Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†','Ø§Ø±Ø®Øµ','Ø§ÙØ¶Ù„','Ø¹Ø±ÙˆØ¶','Ø®ØµÙ…']
      },
      'ØµØ±Ù': {
        base: ['ØµØ±Ù ØµØ­ÙŠ','Ù…Ø¬Ø§Ø±ÙŠ','ØªØ³Ù„ÙŠÙƒ','Ø´ÙØ·','ÙƒØ´Ù ØªØ³Ø±Ø¨Ø§Øª','ØµÙŠØ§Ù†Ø© ØµØ±Ù'],
        items: ['Ø¨ÙŠØ§Ø±Ø§Øª','Ù…Ø¬Ø§Ø±ÙŠ','Ø­Ù…Ø§Ù…Ø§Øª','Ù…Ø·Ø§Ø¨Ø®','ØµØ±Ù','ØªØ³Ø±Ø¨Ø§Øª','Ø§Ù†Ø³Ø¯Ø§Ø¯Ø§Øª'],
        intents: ['Ø³Ø¹Ø±','Ø§Ø³Ø¹Ø§Ø±','ØªÙƒÙ„ÙØ©','Ù‚Ø±ÙŠØ¨','Ø¨Ø§Ù„Ù‚Ø±Ø¨','Ø­Ø¬Ø²','Ø·Ù„Ø¨','Ø±Ù‚Ù…','Ù‡Ø§ØªÙ','Ø·ÙˆØ§Ø±Ø¦','24 Ø³Ø§Ø¹Ø©','Ø§Ø±Ø®Øµ','Ø§ÙØ¶Ù„']
      }
    };

    function normalize(s){ return (s||'').toLowerCase().replace(/[\u064B-\u0652]/g,'').replace(/[Ø¢Ø£Ø¥Ø§]/g,'Ø§').replace(/[Ø©Ù‡]/g,'Ù‡').trim(); }
    
    function detectSector(text){
      const n = normalize(text);
      if(/Ù†Ù‚Ù„|ØªØ±Ø­ÙŠÙ„|Ø´Ø­Ù†|Ø¹ÙØ´|Ø§Ø«Ø§Ø«|Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§/.test(n)) return 'Ù†Ù‚Ù„';
      if(/Ù†Ø¸Ø§ÙØ©|ØªÙ†Ø¸ÙŠÙ|ØªØ¹Ù‚ÙŠÙ…|ØºØ³ÙŠÙ„/.test(n)) return 'Ù†Ø¸Ø§ÙØ©';
      if(/ØµØ±Ù|Ù…Ø¬Ø§Ø±ÙŠ|ØªØ³Ù„ÙŠÙƒ|Ø´ÙØ·|Ø¨ÙŠØ§Ø±Ø§Øª/.test(n)) return 'ØµØ±Ù';
      return null;
    }

    function generateSectorKeywords(text){
      const sector = detectSector(text);
      const out = [];
      
      if(sector && SECTOR_KEYWORDS[sector]){
        const {base, items, intents} = SECTOR_KEYWORDS[sector];
        const groups = {};
        
        // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø³Ø¹Ø±
        groups['Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©'] = [];
        base.forEach(b => {
          ['Ø³Ø¹Ø±','Ø§Ø³Ø¹Ø§Ø±','ØªÙƒÙ„ÙØ©','Ø§Ø±Ø®Øµ'].forEach(i => groups['Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©'].push(`${b} ${i}`));
        });
        
        // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹
        groups['Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨'] = [];
        base.forEach(b => {
          ['Ù‚Ø±ÙŠØ¨','Ø¨Ø§Ù„Ù‚Ø±Ø¨'].forEach(i => groups['Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨'].push(`${b} ${i}`));
        });
        
        // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨
        groups['Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨'] = [];
        base.forEach(b => {
          ['Ø­Ø¬Ø²','Ø·Ù„Ø¨','Ø±Ù‚Ù…','Ù‡Ø§ØªÙ'].forEach(i => groups['Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨'].push(`${b} ${i}`));
        });
        
        // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©
        groups['Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©'] = [];
        base.forEach(b => {
          items.slice(0,5).forEach(item => groups['Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©'].push(`${b} ${item}`));
        });
        
        // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©
        groups['Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©'] = [];
        base.forEach(b => {
          ['Ø§ÙØ¶Ù„','Ø¹Ø±ÙˆØ¶','Ø®ØµÙ…','Ø¬Ø¯ÙŠØ¯','Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†'].forEach(i => groups['Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©'].push(`${b} ${i}`));
        });
        
        return groups;
      }
      
      // Ù„Ù„Ù…Ø¬Ø§Ù„Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±Ù‘ÙØ©ØŒ ØªÙˆÙ„ÙŠØ¯ Ø¨Ø³ÙŠØ·
      const words = normalize(text).split(/\s+/).filter(w => w.length > 2);
      const mainWord = words[0] || text;
      const simple = {};
      simple[`ÙƒÙ„Ù…Ø§Øª ${mainWord}`] = [];
      ['Ø³Ø¹Ø±','Ø§Ø³Ø¹Ø§Ø±','Ù‚Ø±ÙŠØ¨','Ø­Ø¬Ø²','Ø·Ù„Ø¨','Ø±Ù‚Ù…','Ø§Ø±Ø®Øµ','Ø§ÙØ¶Ù„'].forEach(i => {
        simple[`ÙƒÙ„Ù…Ø§Øª ${mainWord}`].push(`${mainWord} ${i}`);
      });
      return simple;
    }

    const ALL_PLATFORMS=['Google Ads','Facebook','Instagram','TikTok','Snapchat','YouTube','LinkedIn'];
    
    function fmt(n){ return new Intl.NumberFormat('ar-EG').format(Math.round(n||0)); }

    (function init(){
      const runBtn=document.getElementById('run');
      const copyBtn=document.getElementById('copyAll');
      const xlsxBtn=document.getElementById('exportXlsx');
      const demoBtn=document.getElementById('demo');
      
      document.getElementById('country').disabled=false;
      runBtn.disabled=false;
      copyBtn.disabled=false;
      xlsxBtn.disabled=false;

      const toggles=document.getElementById('platformToggles');
      ALL_PLATFORMS.forEach(p=>{
        const id='pl_'+p.replace(/\s+/g,'_');
        const label=document.createElement('label');
        label.innerHTML=`<input type="checkbox" id="${id}" checked> ${p}`;
        toggles.appendChild(label);
      });

      demoBtn.addEventListener('click', ()=>{
        document.getElementById('country').value = 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
        document.getElementById('sectorFree').value = 'Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«';
        document.getElementById('budget').value = '5000';
      });

      runBtn.addEventListener('click', ()=>{
        const cVal=document.getElementById('country').value;
        const sectorFree=document.getElementById('sectorFree').value.trim();
        const budget=parseFloat(document.getElementById('budget').value || '5000');
        
        if(!cVal||!sectorFree){
          alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© ÙˆØ§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„');
          return;
        }
        
        const countryData = COUNTRY_DATA[cVal];
        if(countryData){
          document.getElementById('currency').value = countryData.currency;
        }

        // ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„
        const keywordGroups = generateSectorKeywords(sectorFree);
        const kwEl=document.getElementById('keywords');
        kwEl.innerHTML='';
        
        let allKeywords = [];
        Object.entries(keywordGroups).forEach(([groupName, keywords]) => {
          const groupDiv = document.createElement('div');
          groupDiv.className = 'intent-group';
          groupDiv.innerHTML = `<div class="intent-title">${groupName}</div>`;
          
          const chipsDiv = document.createElement('div');
          chipsDiv.className = 'chips';
          keywords.forEach(k => {
            const span = document.createElement('span');
            span.className = 'pill';
            span.textContent = k;
            chipsDiv.appendChild(span);
            allKeywords.push(k);
          });
          
          groupDiv.appendChild(chipsDiv);
          kwEl.appendChild(groupDiv);
        });

        document.getElementById('keywordStats').textContent = 
          `ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${allKeywords.length} ÙƒÙ„Ù…Ø© ÙÙŠ ${Object.keys(keywordGroups).length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù†ÙŠØ©`;

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
        copyBtn.onclick = ()=>{
          navigator.clipboard.writeText(allKeywords.join('\n')).then(()=> 
          alert(`ØªÙ… Ù†Ø³Ø® ${allKeywords.length} ÙƒÙ„Ù…Ø©`));
        };
        
        xlsxBtn.onclick = ()=>{
          const rows = [['Ø§Ù„ÙƒÙ„Ù…Ø©','Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù†ÙŠØ©','Ù…Ù„Ø§Ø­Ø¸Ø©']];
          Object.entries(keywordGroups).forEach(([group, keywords]) => {
            keywords.forEach(k => rows.push([k, group, '']));
          });
          
          if(window.__XLSX_EXPORT__) window.__XLSX_EXPORT__.downloadXlsx('arabic-keywords.xlsx', rows);
          else alert('Ù…ÙƒÙˆÙ† XLSX ØºÙŠØ± Ù…ÙØ­Ù…Ù‘Ù„');
        };

        // Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
        const activePlatforms = ALL_PLATFORMS.filter(p=> 
          document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked);
        
        const recommendedPlatforms = countryData?.platforms || activePlatforms;
        const finalPlatforms = activePlatforms.filter(p => recommendedPlatforms.includes(p));
        
        const mixEl=document.getElementById('mix');
        mixEl.innerHTML='';
        finalPlatforms.forEach((p,i)=>{
          const s=document.createElement('span');
          s.className='pill';
          s.textContent=`${i+1} - ${p}`;
          mixEl.appendChild(s);
        });
        
        document.getElementById('mixNote').textContent=
          `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${finalPlatforms.length} Ù…Ù†ØµØ§Øª Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ Ù„Ù„Ø¯ÙˆÙ„Ø© Ù…Ù† Ø£ØµÙ„ ${activePlatforms.length} Ù…ÙØ¹Ù‘Ù„Ø©`;

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
        const allocEl=document.getElementById('allocation');
        allocEl.innerHTML='';
        const budgetPerPlatform = finalPlatforms.length ? budget / finalPlatforms.length : budget;
        
        finalPlatforms.forEach(p=>{
          const d=document.createElement('div');
          d.innerHTML=`<b>${p}</b><br>${fmt(budgetPerPlatform)} ${countryData?.currency||''}`;
          allocEl.appendChild(d);
        });

        // Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª
        const fEl=document.getElementById('forecasts');
        fEl.innerHTML='';
        let totals={impressions:0,clicks:0,conversions:0,sales:0};
        
        finalPlatforms.forEach(p=>{
          const cpm = countryData?.cpm?.[p] || 2;
          const impressions = (budgetPerPlatform/cmp)*1000;
          const clicks = impressions*0.015;
          const conversions = clicks*0.025;
          const sales = conversions*0.75;
          
          totals.impressions+=impressions;
          totals.clicks+=clicks;
          totals.conversions+=conversions;
          totals.sales+=sales;
          
          const div=document.createElement('div');
          div.innerHTML=`<b>${p}</b><br>CPM $${cpm.toFixed(2)} | CTR 1.5% | CVR 2.5%<br>Ø§Ù„Ø¸Ù‡ÙˆØ± ${fmt(impressions)} | Ø§Ù„Ù†Ù‚Ø±Ø§Øª ${fmt(clicks)} | Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(conversions)} | Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ${fmt(sales)}`;
          fEl.appendChild(div);
        });
        
        const totalDiv=document.createElement('div');
        totalDiv.innerHTML=`<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${fmt(budget)} ${countryData?.currency||''})</b><br>Ø§Ù„Ø¸Ù‡ÙˆØ± ${fmt(totals.impressions)} | Ø§Ù„Ù†Ù‚Ø±Ø§Øª ${fmt(totals.clicks)} | Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(totals.conversions)} | Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ${fmt(totals.sales)}`;
        fEl.appendChild(totalDiv);

        document.getElementById('out').style.display='block';
      });
      
      document.getElementById('country').disabled=false;
      runBtn.disabled=false;
    })();
  </script>
</body>
</html>