<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†</title>
  <link rel="icon" href="../favicon.svg">
  <link rel="stylesheet" href="../global-styles.css" />
  <style>
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;margin:12px 0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row .col{flex:1 1 260px}
    .muted{color:#666;font-size:.92rem}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi div{background:#f6f7f9;border:1px solid #e7e9ee;border-radius:10px;padding:10px 12px}
    .pill{display:inline-block;background:#eef6ff;color:#1453b3;border:1px solid #cfe3ff;padding:4px 10px;border-radius:999px;margin:2px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{background:#4CAF50;color:#fff;border:none;border-radius:20px;padding:8px 14px;cursor:pointer}
    .platforms{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .platforms label{display:flex;align-items:center;gap:6px;background:#f6f7f9;border:1px solid #e7e9ee;border-radius:999px;padding:6px 10px;cursor:pointer}
    .intent-group{margin:8px 0;padding:8px;background:#f9f9f9;border-radius:8px}
    .intent-title{font-weight:bold;color:#555;margin-bottom:4px}
    .success{background:#e8f5e8;color:#2d5a2d;border:1px solid #b8d8b8;padding:10px 12px;border-radius:10px;margin:10px 0;display:none}
    .small{font-size:.85rem}
  </style>
</head>
<body>
  <div class="container" id="app">
    <h1>ğŸ¯ Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†</h1>
    <p class="muted">Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø« Ø¹Ø±Ø¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù†ÙŠØ© ÙˆØªØµØ¯ÙŠØ± XLSX. Ø§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„ Ø¹Ù…Ù„Ùƒ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ 50+ ÙƒÙ„Ù…Ø© Ù…Ø±ØªØ¨Ø·Ø© Ù…Ø¨Ø§Ø´Ø±Ø©.</p>

    <div class="success" id="successMsg">âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£Ùˆ ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù XLSX.</div>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
          <select id="country">
            <option value="">Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø©</option>
            <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
            <option value="Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
            <option value="Ø§Ù„ÙƒÙˆÙŠØª">Ø§Ù„ÙƒÙˆÙŠØª</option>
            <option value="Ù‚Ø·Ø±">Ù‚Ø·Ø±</option>
            <option value="Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†">Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
            <option value="Ø¹ÙÙ…Ø§Ù†">Ø¹ÙÙ…Ø§Ù†</option>
            <option value="Ù…ØµØ±">Ù…ØµØ±</option>
          </select>
        </div>
        <div class="col">
          <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„</label>
          <input id="sectorFree" placeholder="Ù…Ø«Ø§Ù„: Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«ØŒ Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©ØŒ Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ" />
        </div>
        <div class="col">
          <label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
          <input id="budget" type="number" min="500" step="100" value="5000" />
        </div>
      </div>

      <div class="row">
        <div class="col" style="flex:1 1 100%">
          <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ§Øª</label>
          <div class="platforms" id="platformToggles"></div>
        </div>
      </div>

      <button id="run">ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù„ + Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</button>
      <div class="actions">
        <button id="copyAll" class="btn">Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
        <button id="exportXlsx" class="btn">ØªÙ†Ø²ÙŠÙ„ XLSX</button>
        <button id="demo" class="btn">Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
      </div>
    </div>

    <div id="out" style="display:none">
      <div class="card">
        <h2>ğŸ”‘ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h2>
        <div id="keywords"></div>
        <p class="muted small" id="keywordStats"></p>
      </div>

      <div class="card">
        <h2>âœ… Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h2>
        <div id="mix" class="chips"></div>
        <p class="muted small" id="mixNote"></p>
      </div>

      <div class="card">
        <h2>ğŸ’° ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</h2>
        <div id="allocation" class="kpi"></div>
      </div>

      <div class="card">
        <h2>ğŸ“ˆ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h2>
        <div id="forecasts" class="kpi"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/xlsx-exporter.js"></script>
  <script>
    const COUNTRY_DATA = {
      'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {currency:'SAR', cpm:{Facebook:1.8,'Google Ads':2.2,Instagram:2.0,Snapchat:3.1,TikTok:2.5}},
      'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': {currency:'AED', cpm:{Facebook:2.1,'Google Ads':2.8,Instagram:2.3,LinkedIn:4.2,YouTube:1.9}},
      'Ø§Ù„ÙƒÙˆÙŠØª': {currency:'KWD', cpm:{Facebook:1.5,'Google Ads':1.9,Instagram:1.7,Snapchat:2.8}},
      'Ù‚Ø·Ø±': {currency:'QAR', cpm:{Facebook:2.3,'Google Ads':3.1,Instagram:2.6,YouTube:2.0}},
      'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†': {currency:'BHD', cpm:{Facebook:1.4,'Google Ads':1.8,Instagram:1.6}},
      'Ø¹ÙÙ…Ø§Ù†': {currency:'OMR', cpm:{Facebook:1.6,'Google Ads':2.0,Instagram:1.8}},
      'Ù…ØµØ±': {currency:'EGP', cpm:{Facebook:0.4,'Google Ads':0.6,Instagram:0.5,TikTok:0.7,YouTube:0.3}}
    };

    const KEYWORDS = {
      'Ù†Ù‚Ù„': {
        'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø³Ø¹Ø±','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§Ø³Ø¹Ø§Ø±','Ù†Ù‚Ù„ Ø¹ÙØ´ ØªÙƒÙ„ÙØ©','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ø§Ø±Ø®Øµ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø§Ø³Ø¹Ø§Ø±'],
        'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù‚Ø±ÙŠØ¨','Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¨Ø§Ù„Ù‚Ø±Ø¨','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ù‚Ø±ÙŠØ¨','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ù…Ø­Ù„ÙŠ'],
        'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨': ['Ø­Ø¬Ø² Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«','Ø·Ù„Ø¨ Ù†Ù‚Ù„ Ø¹ÙØ´','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø±Ù‚Ù…','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ù‡Ø§ØªÙ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø­Ø¬Ø²'],
        'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ÙÙƒ ÙˆØªØ±ÙƒÙŠØ¨ Ø£Ø«Ø§Ø«','ØªØºÙ„ÙŠÙ Ø£Ø«Ø§Ø«','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù…Ù†Ø²Ù„ÙŠ','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù…ÙƒØªØ¨ÙŠ','Ø±Ø§ÙØ¹Ø© Ø£Ø«Ø§Ø«'],
        'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§ÙØ¶Ù„','Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¹Ø±ÙˆØ¶','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ø®ØµÙ…','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø¬Ø¯ÙŠØ¯']
      },
      'Ù†Ø¸Ø§ÙØ©': {
        'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø³Ø¹Ø±','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ø§Ø³Ø¹Ø§Ø±','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© ØªÙƒÙ„ÙØ©','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ø§Ø±Ø®Øµ'],
        'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ù‚Ø±ÙŠØ¨Ø©','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ù‚Ø±ÙŠØ¨','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø¨Ø§Ù„Ù‚Ø±Ø¨'],
        'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨': ['Ø­Ø¬Ø² Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©','Ø·Ù„Ø¨ ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø±Ù‚Ù…','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ù‡Ø§ØªÙ'],
        'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ØªÙ†Ø¸ÙŠÙ Ø³Ø¬Ø§Ø¯','ØªÙ†Ø¸ÙŠÙ ÙƒÙ†Ø¨','ØªØ¹Ù‚ÙŠÙ… Ù…Ù†Ø§Ø²Ù„','ØºØ³ÙŠÙ„ Ù…ÙˆÙƒÙŠØª','ØªÙ†Ø¸ÙŠÙ ÙˆØ§Ø¬Ù‡Ø§Øª'],
        'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø§ÙØ¶Ù„','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ø¹Ø±ÙˆØ¶','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø®ØµÙ…','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†']
      },
      'ØµØ±Ù': {
        'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ø³Ø¹Ø±','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø§Ø³Ø¹Ø§Ø±','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª ØªÙƒÙ„ÙØ©','ØµØ±Ù ØµØ­ÙŠ Ø§Ø±Ø®Øµ'],
        'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ù‚Ø±ÙŠØ¨Ø©','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ù‚Ø±ÙŠØ¨','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª Ø¨Ø§Ù„Ù‚Ø±Ø¨'],
        'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·ÙˆØ§Ø±Ø¦': ['Ø­Ø¬Ø² Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ','Ø·ÙˆØ§Ø±Ø¦ ØµØ±Ù ØµØ­ÙŠ','ØµØ±Ù ØµØ­ÙŠ 24 Ø³Ø§Ø¹Ø©','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø·ÙˆØ§Ø±Ø¦'],
        'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª','ÙƒØ´Ù ØªØ³Ø±Ø¨Ø§Øª','ØªÙ†Ø¸ÙŠÙ Ø¨ÙŠØ§Ø±Ø§Øª','ØµÙŠØ§Ù†Ø© ØµØ±Ù ØµØ­ÙŠ'],
        'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ø§ÙØ¶Ù„','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø¹Ø±ÙˆØ¶','ØµØ±Ù ØµØ­ÙŠ Ø®ØµÙ…']
      }
    };

    function detectSector(text){
      const n = text.toLowerCase();
      if(/Ù†Ù‚Ù„|Ø¹ÙØ´|Ø§Ø«Ø§Ø«|Ø´Ø­Ù†|ØªØ±Ø­ÙŠÙ„/.test(n)) return 'Ù†Ù‚Ù„';
      if(/Ù†Ø¸Ø§ÙØ©|ØªÙ†Ø¸ÙŠÙ|ØªØ¹Ù‚ÙŠÙ…|ØºØ³ÙŠÙ„/.test(n)) return 'Ù†Ø¸Ø§ÙØ©';
      if(/ØµØ±Ù|Ù…Ø¬Ø§Ø±ÙŠ|ØªØ³Ù„ÙŠÙƒ|Ø´ÙØ·|Ø¨ÙŠØ§Ø±/.test(n)) return 'ØµØ±Ù';
      return null;
    }

    function generateKeywords(text){
      const sector = detectSector(text);
      if(sector && KEYWORDS[sector]){
        return KEYWORDS[sector];
      }
      
      const word = text.trim().split(' ')[0] || text;
      return {
        [`ÙƒÙ„Ù…Ø§Øª ${word}`]: [
          `${word} Ø³Ø¹Ø±`, `${word} Ø§Ø³Ø¹Ø§Ø±`, `${word} Ù‚Ø±ÙŠØ¨`, 
          `${word} Ø­Ø¬Ø²`, `${word} Ø·Ù„Ø¨`, `${word} Ø±Ù‚Ù…`, 
          `${word} Ø§Ø±Ø®Øµ`, `${word} Ø§ÙØ¶Ù„`
        ]
      };
    }

    const PLATFORMS = ['Google Ads','Facebook','Instagram','TikTok','Snapchat','YouTube','LinkedIn'];
    
    function fmt(n){ return new Intl.NumberFormat('ar-EG').format(Math.round(n||0)); }

    document.addEventListener('DOMContentLoaded', ()=>{
      const toggles = document.getElementById('platformToggles');
      PLATFORMS.forEach(p=>{
        const id = 'pl_' + p.replace(/\s+/g,'_');
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" id="${id}" checked> ${p}`;
        toggles.appendChild(label);
      });

      document.getElementById('demo').addEventListener('click', ()=>{
        document.getElementById('country').value = 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
        document.getElementById('sectorFree').value = 'Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«';
        document.getElementById('budget').value = '5000';
        document.getElementById('successMsg').style.display = 'block';
        setTimeout(()=> document.getElementById('successMsg').style.display = 'none', 3000);
      });

      document.getElementById('run').addEventListener('click', ()=>{
        const country = document.getElementById('country').value;
        const sector = document.getElementById('sectorFree').value.trim();
        const budget = parseFloat(document.getElementById('budget').value || '5000');
        
        if(!country || !sector){
          alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© ÙˆØ§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„');
          return;
        }
        
        const countryData = COUNTRY_DATA[country] || {currency:'SAR', cpm:{}};
        const keywordGroups = generateKeywords(sector);
        
        // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
        const kwEl = document.getElementById('keywords');
        kwEl.innerHTML = '';
        let allKeywords = [];
        
        Object.entries(keywordGroups).forEach(([groupName, keywords]) => {
          const groupDiv = document.createElement('div');
          groupDiv.className = 'intent-group';
          groupDiv.innerHTML = `<div class="intent-title">${groupName}</div>`;
          
          const chipsDiv = document.createElement('div');
          chipsDiv.className = 'chips';
          keywords.forEach(k => {
            const span = document.createElement('span');
            span.className = 'pill';
            span.textContent = k;
            chipsDiv.appendChild(span);
            allKeywords.push(k);
          });
          
          groupDiv.appendChild(chipsDiv);
          kwEl.appendChild(groupDiv);
        });

        document.getElementById('keywordStats').textContent = 
          `ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${allKeywords.length} ÙƒÙ„Ù…Ø© ÙÙŠ ${Object.keys(keywordGroups).length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù†ÙŠØ©`;

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
        document.getElementById('copyAll').onclick = ()=>{
          navigator.clipboard.writeText(allKeywords.join('\n')).then(()=> 
            alert(`ØªÙ… Ù†Ø³Ø® ${allKeywords.length} ÙƒÙ„Ù…Ø©`));
        };
        
        document.getElementById('exportXlsx').onclick = ()=>{
          const rows = [['Ø§Ù„ÙƒÙ„Ù…Ø©','Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù†ÙŠØ©','Ù…Ù„Ø§Ø­Ø¸Ø©']];
          Object.entries(keywordGroups).forEach(([group, keywords]) => {
            keywords.forEach(k => rows.push([k, group, '']));
          });
          
          if(window.XLSX){
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(rows);
            XLSX.utils.book_append_sheet(wb, ws, 'Keywords');
            XLSX.writeFile(wb, 'arabic-keywords.xlsx');
          } else {
            alert('Ù…ÙƒÙˆÙ† XLSX ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„');
          }
        };

        // Ø§Ù„Ù…Ù†ØµØ§Øª
        const activePlatforms = PLATFORMS.filter(p=> 
          document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked);
        
        const mixEl = document.getElementById('mix');
        mixEl.innerHTML = '';
        activePlatforms.forEach((p,i)=>{
          const s = document.createElement('span');
          s.className = 'pill';
          s.textContent = `${i+1} - ${p}`;
          mixEl.appendChild(s);
        });
        
        document.getElementById('mixNote').textContent = 
          `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${activePlatforms.length} Ù…Ù†ØµØ©`;

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
        const allocEl = document.getElementById('allocation');
        allocEl.innerHTML = '';
        const budgetPerPlatform = activePlatforms.length ? budget / activePlatforms.length : budget;
        
        activePlatforms.forEach(p=>{
          const d = document.createElement('div');
          d.innerHTML = `<b>${p}</b><br>${fmt(budgetPerPlatform)} ${countryData.currency}`;
          allocEl.appendChild(d);
        });

        // Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª
        const fEl = document.getElementById('forecasts');
        fEl.innerHTML = '';
        let totals = {impressions:0,clicks:0,conversions:0,sales:0};
        
        activePlatforms.forEach(p=>{
          const cpm = countryData.cpm[p] || 2;
          const impressions = (budgetPerPlatform/cpm)*1000;
          const clicks = impressions*0.015;
          const conversions = clicks*0.025;
          const sales = conversions*0.75;
          
          totals.impressions += impressions;
          totals.clicks += clicks;
          totals.conversions += conversions;
          totals.sales += sales;
          
          const div = document.createElement('div');
          div.innerHTML = `<b>${p}</b><br>CPM $${cpm.toFixed(2)}<br>Ø¸Ù‡ÙˆØ± ${fmt(impressions)} | Ù†Ù‚Ø±Ø§Øª ${fmt(clicks)} | ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(conversions)} | Ù…Ø¨ÙŠØ¹Ø§Øª ${fmt(sales)}`;
          fEl.appendChild(div);
        });
        
        const totalDiv = document.createElement('div');
        totalDiv.innerHTML = `<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${fmt(budget)} ${countryData.currency})</b><br>Ø¸Ù‡ÙˆØ± ${fmt(totals.impressions)} | Ù†Ù‚Ø±Ø§Øª ${fmt(totals.clicks)} | ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(totals.conversions)} | Ù…Ø¨ÙŠØ¹Ø§Øª ${fmt(totals.sales)}`;
        fEl.appendChild(totalDiv);

        document.getElementById('out').style.display = 'block';
        document.getElementById('successMsg').style.display = 'block';
        setTimeout(()=> document.getElementById('successMsg').style.display = 'none', 4000);
      });
    });
  </script>
</body>
</html>