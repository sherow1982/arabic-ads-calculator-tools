<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø³Ø®Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©</title>
  <link rel="icon" href="../favicon.svg">
  <link rel="stylesheet" href="../global-styles.css" />
  <style>
    .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;margin:12px 0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row .col{flex:1 1 260px}
    .muted{color:#666;font-size:.92rem}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi div{background:#f6f7f9;border:1px solid #e7e9ee;border-radius:10px;padding:10px 12px}
    .pill{display:inline-block;background:#eef6ff;color:#1453b3;border:1px solid #cfe3ff;padding:4px 10px;border-radius:999px;margin:2px}
    .pill-broad{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}
    .pill-phrase{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}
    .pill-exact{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{background:#4CAF50;color:#fff;border:none;border-radius:20px;padding:8px 14px;cursor:pointer}
    .btn-secondary{background:#6c757d}
    .platforms{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .platforms label{display:flex;align-items:center;gap:6px;background:#f6f7f9;border:1px solid #e7e9ee;border-radius:999px;padding:6px 10px;cursor:pointer}
    .intent-group{margin:8px 0;padding:12px;background:#f9f9f9;border-radius:8px;border-left:4px solid #007bff}
    .intent-title{font-weight:bold;color:#007bff;margin-bottom:6px;font-size:0.95rem}
    .success{background:#e8f5e8;color:#2d5a2d;border:1px solid #b8d8b8;padding:10px 12px;border-radius:10px;margin:10px 0;display:none}
    .small{font-size:.85rem}
    .advanced{background:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;padding:12px;margin:10px 0}
    .match-info{background:#e7f3ff;padding:8px;border-radius:6px;margin:5px 0;font-size:0.9rem}
  </style>
</head>
<body>
  <div class="container" id="app">
    <h1>ğŸ¯ Ù…ÙØ±Ø´ÙÙ‘Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø³Ø®Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
    <p class="muted">Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø« Ø¹Ø±Ø¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ <b>Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</b> ÙˆÙ…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù†ÙŠØ© ÙˆØªØµØ¯ÙŠØ± XLSX Ù…ØªÙ‚Ø¯Ù…. Ù…ØµÙ…Ù…Ø© Ø®ØµÙŠØµØ§Ù‹ Ù„Ù„Ù€ Media Buyers Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ†.</p>

    <div class="success" id="successMsg">âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£Ùˆ ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù XLSX Ù…ØªÙ‚Ø¯Ù….</div>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
          <select id="country">
            <option value="">Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø©</option>
            <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
            <option value="Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
            <option value="Ø§Ù„ÙƒÙˆÙŠØª">Ø§Ù„ÙƒÙˆÙŠØª</option>
            <option value="Ù‚Ø·Ø±">Ù‚Ø·Ø±</option>
            <option value="Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†">Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
            <option value="Ø¹ÙÙ…Ø§Ù†">Ø¹ÙÙ…Ø§Ù†</option>
            <option value="Ù…ØµØ±">Ù…ØµØ±</option>
          </select>
        </div>
        <div class="col">
          <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„</label>
          <input id="sectorFree" placeholder="Ù…Ø«Ø§Ù„: Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«ØŒ Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©ØŒ Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ" />
        </div>
        <div class="col">
          <label>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
          <input id="budget" type="number" min="500" step="100" value="5000" />
        </div>
      </div>

      <div class="advanced">
        <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
        <div class="row">
          <div class="col">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
            <select id="matchType">
              <option value="broad">Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ø³Ø¹Ø© (Broad Match)</option>
              <option value="phrase" selected>Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© (Phrase Match)</option>
              <option value="exact">Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø© (Exact Match)</option>
              <option value="mixed">Ù…Ø²ÙŠØ¬ (Ù…ÙˆØµÙ‰)</option>
            </select>
          </div>
          <div class="col">
            <label>ØªØ¶Ù…ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø³Ù„Ø¨ÙŠØ©</label>
            <input type="checkbox" id="includeNegatives" checked /> Ù†Ø¹Ù… (Ù…ÙˆØµÙ‰ Ø¨Ù‚ÙˆØ©)
          </div>
          <div class="col">
            <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØ³Ø¹</label>
            <select id="expansionLevel">
              <option value="conservative">Ù…Ø­Ø§ÙØ¸ (20-30 ÙƒÙ„Ù…Ø©)</option>
              <option value="moderate" selected>Ù…ØªÙˆØ³Ø· (40-60 ÙƒÙ„Ù…Ø©)</option>
              <option value="aggressive">ØªÙˆØ³Ø¹ÙŠ (80+ ÙƒÙ„Ù…Ø©)</option>
            </select>
          </div>
        </div>
        
        <div class="match-info">
          <strong>Ù…Ø¹Ù„ÙˆÙ…Ø©:</strong> Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ§Ø³Ø¹Ø© ØªØ¬Ù„Ø¨ Ø­Ø±ÙƒØ© Ø£ÙƒØ«Ø± Ù„ÙƒÙ† Ø£Ù‚Ù„ Ø¯Ù‚Ø©. Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ØªØ§Ù…Ø© Ø£ÙƒØ«Ø± Ø¯Ù‚Ø© Ù„ÙƒÙ† Ø­Ø±ÙƒØ© Ø£Ù‚Ù„. Ø§Ù„Ù…Ø²ÙŠØ¬ Ù‡Ùˆ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù„Ø¨Ø¯Ø¡.
        </div>
      </div>

      <div class="row">
        <div class="col" style="flex:1 1 100%">
          <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ§Øª</label>
          <div class="platforms" id="platformToggles"></div>
        </div>
      </div>

      <button id="run">ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© + Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</button>
      <div class="actions">
        <button id="copyAll" class="btn">Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
        <button id="copyNegatives" class="btn btn-secondary">Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©</button>
        <button id="exportXlsx" class="btn">ØªÙ†Ø²ÙŠÙ„ XLSX Ù…ØªÙ‚Ø¯Ù…</button>
        <button id="exportGoogleAds" class="btn btn-secondary">ØªØµØ¯ÙŠØ± Google Ads</button>
        <button id="demo" class="btn">Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
      </div>
    </div>

    <div id="out" style="display:none">
      <div class="card">
        <h2>ğŸ”‘ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</h2>
        <div id="keywords"></div>
        <p class="muted small" id="keywordStats"></p>
      </div>

      <div class="card" id="negativesCard" style="display:none">
        <h2>ğŸš« Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h2>
        <div id="negativeKeywords" class="chips"></div>
        <p class="muted small">ÙƒÙ„Ù…Ø§Øª Ù„Ø§Ø³ØªØ¨Ø¹Ø§Ø¯Ù‡Ø§ Ù…Ù† Ø­Ù…Ù„Ø§ØªÙƒ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø± ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬ÙˆØ¯Ø©</p>
      </div>

      <div class="card">
        <h2>âœ… Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h2>
        <div id="mix" class="chips"></div>
        <p class="muted small" id="mixNote"></p>
      </div>

      <div class="card">
        <h2>ğŸ’° ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</h2>
        <div id="allocation" class="kpi"></div>
      </div>

      <div class="card">
        <h2>ğŸ“ˆ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h2>
        <div id="forecasts" class="kpi"></div>
      </div>

      <div class="card">
        <h2>ğŸ“‹ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø±ÙŠØ¹</h2>
        <ol id="playbook"></ol>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    const COUNTRY_DATA = {
      'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {currency:'SAR', cpm:{Facebook:1.8,'Google Ads':2.2,Instagram:2.0,Snapchat:3.1,TikTok:2.5}},
      'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': {currency:'AED', cpm:{Facebook:2.1,'Google Ads':2.8,Instagram:2.3,LinkedIn:4.2,YouTube:1.9}},
      'Ø§Ù„ÙƒÙˆÙŠØª': {currency:'KWD', cpm:{Facebook:1.5,'Google Ads':1.9,Instagram:1.7,Snapchat:2.8}},
      'Ù‚Ø·Ø±': {currency:'QAR', cpm:{Facebook:2.3,'Google Ads':3.1,Instagram:2.6,YouTube:2.0}},
      'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†': {currency:'BHD', cpm:{Facebook:1.4,'Google Ads':1.8,Instagram:1.6}},
      'Ø¹ÙÙ…Ø§Ù†': {currency:'OMR', cpm:{Facebook:1.6,'Google Ads':2.0,Instagram:1.8}},
      'Ù…ØµØ±': {currency:'EGP', cpm:{Facebook:0.4,'Google Ads':0.6,Instagram:0.5,TikTok:0.7,YouTube:0.3}}
    };

    const SECTOR_DATA = {
      'Ù†Ù‚Ù„': {
        keywords: {
          'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø³Ø¹Ø±','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§Ø³Ø¹Ø§Ø±','Ù†Ù‚Ù„ Ø¹ÙØ´ ØªÙƒÙ„ÙØ©','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ø§Ø±Ø®Øµ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø§Ø³Ø¹Ø§Ø±','Ù†Ù‚Ù„ Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§ Ø³Ø¹Ø±'],
          'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù‚Ø±ÙŠØ¨','Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¨Ø§Ù„Ù‚Ø±Ø¨','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ù…Ø­Ù„ÙŠ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ù‚Ø±ÙŠØ¨'],
          'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨': ['Ø­Ø¬Ø² Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«','Ø·Ù„Ø¨ Ù†Ù‚Ù„ Ø¹ÙØ´','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø±Ù‚Ù…','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ù‡Ø§ØªÙ','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø­Ø¬Ø²'],
          'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ÙÙƒ ÙˆØªØ±ÙƒÙŠØ¨ Ø£Ø«Ø§Ø«','ØªØºÙ„ÙŠÙ Ø£Ø«Ø§Ø«','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù…Ù†Ø²Ù„ÙŠ','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ù…ÙƒØªØ¨ÙŠ','Ø±Ø§ÙØ¹Ø© Ø£Ø«Ø§Ø«','ØªØ®Ø²ÙŠÙ† Ø£Ø«Ø§Ø«'],
          'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§ÙØ¶Ù„','Ù†Ù‚Ù„ Ø¹ÙØ´ Ø¹Ø±ÙˆØ¶','Ø´Ø­Ù† Ø£Ø«Ø§Ø« Ø®ØµÙ…','Ù†Ù‚Ù„ Ø£Ø«Ø§Ø« Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†','ØªØ±Ø­ÙŠÙ„ Ø£Ø«Ø§Ø« Ø¬Ø¯ÙŠØ¯']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù','ØªÙˆØ¸ÙŠÙ','Ù…Ø¬Ø§Ù†ÙŠ','ØµÙˆØ±','ØªØ¹Ù„ÙŠÙ…','Ø¯ÙˆØ±Ø§Øª','Ø§ÙŠÙƒÙŠØ§','Ù…Ø­Ù„Ø§Øª','Ø´Ø±Ø§Ø¡','Ø¨ÙŠØ¹ Ø£Ø«Ø§Ø«','Ø£Ø«Ø§Ø« Ù…Ø³ØªØ¹Ù…Ù„']
      },
      'Ù†Ø¸Ø§ÙØ©': {
        keywords: {
          'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø³Ø¹Ø±','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ø§Ø³Ø¹Ø§Ø±','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© ØªÙƒÙ„ÙØ©','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ø§Ø±Ø®Øµ'],
          'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ù‚Ø±ÙŠØ¨Ø©','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ù‚Ø±ÙŠØ¨','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø¨Ø§Ù„Ù‚Ø±Ø¨'],
          'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·Ù„Ø¨': ['Ø­Ø¬Ø² Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ©','Ø·Ù„Ø¨ ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø±Ù‚Ù…','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ù‡Ø§ØªÙ'],
          'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ØªÙ†Ø¸ÙŠÙ Ø³Ø¬Ø§Ø¯','ØªÙ†Ø¸ÙŠÙ ÙƒÙ†Ø¨','ØªØ¹Ù‚ÙŠÙ… Ù…Ù†Ø§Ø²Ù„','ØºØ³ÙŠÙ„ Ù…ÙˆÙƒÙŠØª','ØªÙ†Ø¸ÙŠÙ ÙˆØ§Ø¬Ù‡Ø§Øª','ØªÙ†Ø¸ÙŠÙ Ø®Ø²Ø§Ù†Ø§Øª'],
          'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø§ÙØ¶Ù„','ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„ Ø¹Ø±ÙˆØ¶','Ø´Ø±ÙƒØ© Ù†Ø¸Ø§ÙØ© Ø®ØµÙ…','ØªÙ†Ø¸ÙŠÙ Ø´Ù‚Ù‚ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù','ØªÙˆØ¸ÙŠÙ','Ù…Ø¬Ø§Ù†ÙŠ','ØµÙˆØ±','ØªØ¹Ù„ÙŠÙ…','Ø¯ÙˆØ±Ø§Øª','Ø¹Ø§Ù…Ù„Ø§Øª','Ø®Ø§Ø¯Ù…Ø§Øª','Ù…Ù†Ø¸ÙØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©']
      },
      'ØµØ±Ù': {
        keywords: {
          'Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ø³Ø¹Ø±','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø§Ø³Ø¹Ø§Ø±','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª ØªÙƒÙ„ÙØ©','ØµØ±Ù ØµØ­ÙŠ Ø§Ø±Ø®Øµ'],
          'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù‚Ø±Ø¨': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ù‚Ø±ÙŠØ¨Ø©','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ù‚Ø±ÙŠØ¨','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª Ø¨Ø§Ù„Ù‚Ø±Ø¨'],
          'Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø·ÙˆØ§Ø±Ø¦': ['Ø­Ø¬Ø² Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ','Ø·ÙˆØ§Ø±Ø¦ ØµØ±Ù ØµØ­ÙŠ','ØµØ±Ù ØµØ­ÙŠ 24 Ø³Ø§Ø¹Ø©','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø·ÙˆØ§Ø±Ø¦'],
          'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©': ['ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ','Ø´ÙØ· Ø¨ÙŠØ§Ø±Ø§Øª','ÙƒØ´Ù ØªØ³Ø±Ø¨Ø§Øª','ØªÙ†Ø¸ÙŠÙ Ø¨ÙŠØ§Ø±Ø§Øª','ØµÙŠØ§Ù†Ø© ØµØ±Ù ØµØ­ÙŠ'],
          'Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': ['Ø´Ø±ÙƒØ© ØµØ±Ù ØµØ­ÙŠ Ø§ÙØ¶Ù„','ØªØ³Ù„ÙŠÙƒ Ù…Ø¬Ø§Ø±ÙŠ Ø¹Ø±ÙˆØ¶','ØµØ±Ù ØµØ­ÙŠ Ø®ØµÙ…']
        },
        negatives: ['ÙˆØ¸Ø§Ø¦Ù','ØªÙˆØ¸ÙŠÙ','Ù…Ø¬Ø§Ù†ÙŠ','ØµÙˆØ±','ØªØ¹Ù„ÙŠÙ…','Ø¯ÙˆØ±Ø§Øª','Ø£Ø¯ÙˆØ§Øª','Ù…Ø¹Ø¯Ø§Øª Ù„Ù„Ø¨ÙŠØ¹','Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ†']
      }
    };

    const PLATFORMS = ['Google Ads','Facebook','Instagram','TikTok','Snapchat','YouTube','LinkedIn'];
    
    function detectSector(text){
      const n = text.toLowerCase();
      if(/Ù†Ù‚Ù„|Ø¹ÙØ´|Ø§Ø«Ø§Ø«|Ø´Ø­Ù†|ØªØ±Ø­ÙŠÙ„|Ù…ÙˆØ¨ÙŠÙ„ÙŠØ§/.test(n)) return 'Ù†Ù‚Ù„';
      if(/Ù†Ø¸Ø§ÙØ©|ØªÙ†Ø¸ÙŠÙ|ØªØ¹Ù‚ÙŠÙ…|ØºØ³ÙŠÙ„/.test(n)) return 'Ù†Ø¸Ø§ÙØ©';
      if(/ØµØ±Ù|Ù…Ø¬Ø§Ø±ÙŠ|ØªØ³Ù„ÙŠÙƒ|Ø´ÙØ·|Ø¨ÙŠØ§Ø±/.test(n)) return 'ØµØ±Ù';
      return null;
    }

    function formatKeywordWithMatch(keyword, matchType){
      switch(matchType){
        case 'broad': return keyword;
        case 'phrase': return `"${keyword}"`;
        case 'exact': return `[${keyword}]`;
        default: return keyword;
      }
    }

    function generateAdvancedKeywords(text, matchType, expansionLevel){
      const sector = detectSector(text);
      let baseKeywords = {};
      
      if(sector && SECTOR_DATA[sector]){
        baseKeywords = {...SECTOR_DATA[sector].keywords};
      } else {
        const word = text.trim().split(' ')[0] || text;
        baseKeywords = {
          [`ÙƒÙ„Ù…Ø§Øª ${word}`]: [
            `${word} Ø³Ø¹Ø±`, `${word} Ø§Ø³Ø¹Ø§Ø±`, `${word} Ù‚Ø±ÙŠØ¨`, 
            `${word} Ø­Ø¬Ø²`, `${word} Ø·Ù„Ø¨`, `${word} Ø±Ù‚Ù…`, 
            `${word} Ø§Ø±Ø®Øµ`, `${word} Ø§ÙØ¶Ù„`
          ]
        };
      }

      // ØªÙˆØ³ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
      if(expansionLevel === 'aggressive'){
        Object.keys(baseKeywords).forEach(group => {
          const extras = [];
          baseKeywords[group].forEach(kw => {
            extras.push(`${kw} Ø§Ù„Ø±ÙŠØ§Ø¶`);
            extras.push(`${kw} Ø¬Ø¯Ø©`);
            extras.push(`${kw} Ø§Ù„Ø¯Ù…Ø§Ù…`);
          });
          baseKeywords[group] = [...baseKeywords[group], ...extras.slice(0,10)];
        });
      }

      return baseKeywords;
    }

    function fmt(n){ return new Intl.NumberFormat('ar-EG').format(Math.round(n||0)); }

    document.addEventListener('DOMContentLoaded', ()=>{
      const toggles = document.getElementById('platformToggles');
      PLATFORMS.forEach(p=>{
        const id = 'pl_' + p.replace(/\s+/g,'_');
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" id="${id}" checked> ${p}`;
        toggles.appendChild(label);
      });

      document.getElementById('demo').addEventListener('click', ()=>{
        document.getElementById('country').value = 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
        document.getElementById('sectorFree').value = 'Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«';
        document.getElementById('budget').value = '5000';
        document.getElementById('matchType').value = 'mixed';
        document.getElementById('expansionLevel').value = 'moderate';
        document.getElementById('successMsg').style.display = 'block';
        setTimeout(()=> document.getElementById('successMsg').style.display = 'none', 3000);
      });

      document.getElementById('run').addEventListener('click', ()=>{
        const country = document.getElementById('country').value;
        const sector = document.getElementById('sectorFree').value.trim();
        const budget = parseFloat(document.getElementById('budget').value || '5000');
        const matchType = document.getElementById('matchType').value;
        const includeNegatives = document.getElementById('includeNegatives').checked;
        const expansionLevel = document.getElementById('expansionLevel').value;
        
        if(!country || !sector){
          alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© ÙˆØ§ÙƒØªØ¨ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„');
          return;
        }
        
        const countryData = COUNTRY_DATA[country] || {currency:'SAR', cpm:{}};
        const keywordGroups = generateAdvancedKeywords(sector, matchType, expansionLevel);
        
        // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
        const kwEl = document.getElementById('keywords');
        kwEl.innerHTML = '';
        let allKeywords = [];
        
        Object.entries(keywordGroups).forEach(([groupName, keywords]) => {
          const groupDiv = document.createElement('div');
          groupDiv.className = 'intent-group';
          groupDiv.innerHTML = `<div class="intent-title">${groupName} (${keywords.length} ÙƒÙ„Ù…Ø©)</div>`;
          
          const chipsDiv = document.createElement('div');
          chipsDiv.className = 'chips';
          
          keywords.forEach((k, i) => {
            const span = document.createElement('span');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
            let displayKeyword, actualKeyword, className;
            if(matchType === 'mixed'){
              if(i % 3 === 0){ displayKeyword = k; actualKeyword = k; className = 'pill pill-broad'; }
              else if(i % 3 === 1){ displayKeyword = `"${k}"`; actualKeyword = `"${k}"`; className = 'pill pill-phrase'; }
              else { displayKeyword = `[${k}]`; actualKeyword = `[${k}]`; className = 'pill pill-exact'; }
            } else {
              actualKeyword = formatKeywordWithMatch(k, matchType);
              displayKeyword = actualKeyword;
              className = matchType === 'broad' ? 'pill pill-broad' : 
                         matchType === 'phrase' ? 'pill pill-phrase' : 'pill pill-exact';
            }
            
            span.className = className;
            span.textContent = displayKeyword;
            chipsDiv.appendChild(span);
            allKeywords.push(actualKeyword);
          });
          
          groupDiv.appendChild(chipsDiv);
          kwEl.appendChild(groupDiv);
        });

        // Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©
        let negativeKeywords = [];
        if(includeNegatives){
          const sectorKey = detectSector(sector);
          if(sectorKey && SECTOR_DATA[sectorKey] && SECTOR_DATA[sectorKey].negatives){
            negativeKeywords = SECTOR_DATA[sectorKey].negatives;
            const negCard = document.getElementById('negativesCard');
            const negEl = document.getElementById('negativeKeywords');
            negCard.style.display = 'block';
            negEl.innerHTML = '';
            negativeKeywords.forEach(k => {
              const span = document.createElement('span');
              span.className = 'pill';
              span.style.background = '#f8d7da';
              span.style.color = '#721c24';
              span.textContent = `-${k}`;
              negEl.appendChild(span);
            });
          }
        }

        document.getElementById('keywordStats').textContent = 
          `ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${allKeywords.length} ÙƒÙ„Ù…Ø© ÙÙŠ ${Object.keys(keywordGroups).length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù†ÙŠØ©${includeNegatives ? ` + ${negativeKeywords.length} ÙƒÙ„Ù…Ø© Ø³Ù„Ø¨ÙŠØ©` : ''}`;

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        document.getElementById('copyAll').onclick = ()=>{
          navigator.clipboard.writeText(allKeywords.join('\n')).then(()=> 
            alert(`ØªÙ… Ù†Ø³Ø® ${allKeywords.length} ÙƒÙ„Ù…Ø©`));
        };
        
        document.getElementById('copyNegatives').onclick = ()=>{
          if(negativeKeywords.length){
            navigator.clipboard.writeText(negativeKeywords.map(k => `-${k}`).join('\n')).then(()=> 
              alert(`ØªÙ… Ù†Ø³Ø® ${negativeKeywords.length} ÙƒÙ„Ù…Ø© Ø³Ù„Ø¨ÙŠØ©`));
          } else {
            alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ø³Ù„Ø¨ÙŠØ© Ù…ØªØ§Ø­Ø©');
          }
        };
        
        document.getElementById('exportXlsx').onclick = ()=>{
          if(!window.XLSX) { alert('Ù…ÙƒÙˆÙ† XLSX ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„'); return; }
          
          const wb = XLSX.utils.book_new();
          
          // ÙˆØ±Ù‚Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          const keywordRows = [['Ø§Ù„ÙƒÙ„Ù…Ø©','Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©','Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù†ÙŠØ©','Ù…Ù„Ø§Ø­Ø¸Ø©']];
          Object.entries(keywordGroups).forEach(([group, keywords]) => {
            keywords.forEach(k => {
              const matchTypeText = k.startsWith('[') ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ§Ù…Ø©' :
                                  k.startsWith('"') ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¹Ø¨Ø§Ø±Ø©' : 'Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ø³Ø¹Ø©';
              keywordRows.push([k, matchTypeText, group, '']);
            });
          });
          const wsKeywords = XLSX.utils.aoa_to_sheet(keywordRows);
          XLSX.utils.book_append_sheet(wb, wsKeywords, 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
          
          // ÙˆØ±Ù‚Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©
          if(negativeKeywords.length){
            const negRows = [['Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ù„Ø¨ÙŠØ©','Ø§Ù„Ø³Ø¨Ø¨']];
            negativeKeywords.forEach(k => negRows.push([`-${k}`, 'ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø±']));
            const wsNegatives = XLSX.utils.aoa_to_sheet(negRows);
            XLSX.utils.book_append_sheet(wb, wsNegatives, 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø¨ÙŠØ©');
          }
          
          // ÙˆØ±Ù‚Ø© Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©
          const planRows = [['Ø§Ù„Ù…Ù†ØµØ©','Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©','CPM Ø§Ù„Ù…ØªÙˆÙ‚Ø¹','Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹','Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©']];
          const activePlatforms = PLATFORMS.filter(p=> document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked);
          const budgetPerPlatform = activePlatforms.length ? budget / activePlatforms.length : budget;
          
          activePlatforms.forEach(p => {
            const cpm = countryData.cpm[p] || 2;
            const impressions = (budgetPerPlatform/cpm)*1000;
            const clicks = impressions*0.015;
            planRows.push([p, budgetPerPlatform, `$${cpm}`, Math.round(impressions), Math.round(clicks)]);
          });
          const wsPlan = XLSX.utils.aoa_to_sheet(planRows);
          XLSX.utils.book_append_sheet(wb, wsPlan, 'Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©');
          
          XLSX.writeFile(wb, 'arabic-ads-plan-advanced.xlsx');
        };
        
        document.getElementById('exportGoogleAds').onclick = ()=>{
          // ØªØµØ¯ÙŠØ± Ø¨ØµÙŠØºØ© Google Ads Editor
          const csvRows = ['Campaign,Ad Group,Keyword,Match Type'];
          Object.entries(keywordGroups).forEach(([group, keywords]) => {
            keywords.forEach(k => {
              const matchTypeText = k.startsWith('[') ? 'Exact' :
                                  k.startsWith('"') ? 'Phrase' : 'Broad';
              csvRows.push(`${sector} Campaign,${group},${k.replace(/[\[\]"]/g, '')},${matchTypeText}`);
            });
          });
          
          const csvContent = csvRows.join('\n');
          const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'google-ads-import.csv';
          link.click();
        };

        // Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        const activePlatforms = PLATFORMS.filter(p=> 
          document.getElementById('pl_'+p.replace(/\s+/g,'_')).checked);
        
        const mixEl = document.getElementById('mix');
        mixEl.innerHTML = '';
        activePlatforms.forEach((p,i)=>{
          const s = document.createElement('span');
          s.className = 'pill';
          s.textContent = `${i+1} - ${p}`;
          mixEl.appendChild(s);
        });
        
        document.getElementById('mixNote').textContent = 
          `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${activePlatforms.length} Ù…Ù†ØµØ© Ù„Ù„Ø­Ù…Ù„Ø©`;

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
        const allocEl = document.getElementById('allocation');
        allocEl.innerHTML = '';
        const budgetPerPlatform = activePlatforms.length ? budget / activePlatforms.length : budget;
        
        activePlatforms.forEach(p=>{
          const d = document.createElement('div');
          d.innerHTML = `<b>${p}</b><br>${fmt(budgetPerPlatform)} ${countryData.currency}`;
          allocEl.appendChild(d);
        });

        // Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª
        const fEl = document.getElementById('forecasts');
        fEl.innerHTML = '';
        let totals = {impressions:0,clicks:0,conversions:0,sales:0};
        
        activePlatforms.forEach(p=>{
          const cpm = countryData.cpm[p] || 2;
          const impressions = (budgetPerPlatform/cpm)*1000;
          const clicks = impressions*0.015;
          const conversions = clicks*0.025;
          const sales = conversions*0.75;
          
          totals.impressions += impressions;
          totals.clicks += clicks;
          totals.conversions += conversions;
          totals.sales += sales;
          
          const div = document.createElement('div');
          div.innerHTML = `<b>${p}</b><br>CPM $${cpm.toFixed(2)}<br>Ø¸Ù‡ÙˆØ± ${fmt(impressions)} | Ù†Ù‚Ø±Ø§Øª ${fmt(clicks)} | ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(conversions)} | Ù…Ø¨ÙŠØ¹Ø§Øª ${fmt(sales)}`;
          fEl.appendChild(div);
        });
        
        const totalDiv = document.createElement('div');
        totalDiv.innerHTML = `<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${fmt(budget)} ${countryData.currency})</b><br>Ø¸Ù‡ÙˆØ± ${fmt(totals.impressions)} | Ù†Ù‚Ø±Ø§Øª ${fmt(totals.clicks)} | ØªØ­ÙˆÙŠÙ„Ø§Øª ${fmt(totals.conversions)} | Ù…Ø¨ÙŠØ¹Ø§Øª ${fmt(totals.sales)}`;
        fEl.appendChild(totalDiv);

        // Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
        const playbook = document.getElementById('playbook');
        playbook.innerHTML = '';
        [
          `Ø¥Ù†Ø´Ø§Ø¡ ${Object.keys(keywordGroups).length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙŠØ©`,
          `Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©: ${matchType === 'mixed' ? '70% Ø¹Ø¨Ø§Ø±Ø© + 20% ÙˆØ§Ø³Ø¹Ø© + 10% ØªØ§Ù…Ø©' : matchType}`,
          `Ø¥Ø¶Ø§ÙØ© ${negativeKeywords.length} ÙƒÙ„Ù…Ø© Ø³Ù„Ø¨ÙŠØ© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø±`,
          `Ø¨Ø¯Ø¡ Ø¨Ù€${activePlatforms.length} Ù…Ù†ØµØ§Øª Ù…Ø¹ ØªØ±ÙƒÙŠØ² 60% Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£ÙØ¶Ù„`,
          `Ù…Ø±Ø§Ù‚Ø¨Ø© CTR ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙˆØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ù„Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£Ø¹Ù„Ù‰ ROAS`
        ].forEach(s=>{
          const li = document.createElement('li');
          li.textContent = s;
          playbook.appendChild(li);
        });

        document.getElementById('out').style.display = 'block';
        document.getElementById('successMsg').style.display = 'block';
        setTimeout(()=> document.getElementById('successMsg').style.display = 'none', 4000);
      });
    });
  </script>
</body>
</html>