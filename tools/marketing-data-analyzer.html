<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ - Ø§ÙƒØªØ´Ù Ø§Ù„Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª ÙˆØ­Ø³Ù‘Ù† Ø§Ù„Ù‚Ù…Ø¹ | Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</title>
  <meta name="description" content="Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù…Ù„Ø§ØªÙƒ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© ÙˆØ§ÙƒØªØ´Ù Ø§Ù„Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª ÙÙŠ Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø¹ ØªÙˆØµÙŠØ§Øª Ø¹Ù…Ù„ÙŠØ© Ù„Ù„ØªØ­Ø³ÙŠÙ†">
  <meta name="keywords" content="Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª, Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„, Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª, ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª, ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡">
  
  <!-- Global CSS -->
  <link rel="stylesheet" href="../global-styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    .analyzer-wrapper {
      background: var(--gradient);
      min-height: 100vh;
      padding: 20px;
    }
    
    .data-input-section {
      background: var(--light-bg);
      border-radius: 20px;
      padding: 30px;
      margin: 25px 0;
      border: 2px solid var(--border);
    }
    
    .input-method-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 20px;
    }
    
    .tab-btn {
      padding: 10px 20px;
      border: none;
      background: var(--border);
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .tab-btn.active {
      background: var(--primary);
      color: white;
    }
    
    .csv-upload-area {
      border: 3px dashed var(--border);
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      background: white;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .csv-upload-area:hover {
      border-color: var(--primary);
      background: rgba(102,126,234,0.05);
    }
    
    .csv-upload-area.dragover {
      border-color: var(--success);
      background: rgba(16,185,129,0.1);
    }
    
    .funnel-stages {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 25px 0;
    }
    
    .stage-input {
      background: white;
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    
    .stage-title {
      font-weight: 700;
      color: var(--text);
      margin-bottom: 10px;
    }
    
    .stage-number {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 8px;
    }
    
    .funnel-visualization {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 30px 0;
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .funnel-stage {
      width: 100%;
      max-width: 600px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      margin: 5px 0;
      border-radius: 10px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .funnel-stage:hover {
      transform: scale(1.02);
    }
    
    .stage-visitors { background: #3b82f6; }
    .stage-clicks { background: #8b5cf6; }
    .stage-leads { background: #f59e0b; }
    .stage-sales { background: #10b981; }
    
    .stage-percentage {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .bottlenecks-section {
      background: #fef2f2;
      border: 2px solid #fecaca;
      border-radius: 15px;
      padding: 25px;
      margin: 25px 0;
    }
    
    .bottleneck-item {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid #ef4444;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .bottleneck-title {
      font-weight: 700;
      color: #dc2626;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .bottleneck-impact {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 10px;
    }
    
    .bottleneck-solution {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      border-radius: 8px;
      padding: 12px;
      color: #166534;
      font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
      .funnel-stages {
        grid-template-columns: 1fr;
      }
      
      .input-method-tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="analyzer-wrapper">
    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
    <a href="../index.html" class="unified-back-btn">
      <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </a>
    
    <div class="unified-card">
      <!-- Header -->
      <div class="unified-header">
        <h1><i class="fas fa-database"></i> Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚</h1>
        <p>Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù…Ù„Ø§ØªÙƒ ÙˆØ§ÙƒØªØ´Ù Ø§Ù„Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª ÙÙŠ Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø¹ ØªÙˆØµÙŠØ§Øª Ø¹Ù…Ù„ÙŠØ©</p>
      </div>
      
      <!-- Ø·Ø±Ù‚ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
      <div class="data-input-section">
        <div class="input-method-tabs">
          <button class="tab-btn active" onclick="switchInputMethod('manual')">
            <i class="fas fa-edit"></i> Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ
          </button>
          <button class="tab-btn" onclick="switchInputMethod('csv')">
            <i class="fas fa-file-csv"></i> Ø±ÙØ¹ CSV
          </button>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
        <div id="manualInput">
          <h3><i class="fas fa-funnel-dollar"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</h3>
          <p style="margin-bottom: 20px; color: var(--muted);">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ÙÙŠ Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</p>
          
          <div class="funnel-stages">
            <div class="stage-input">
              <div class="stage-title">ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±</div>
              <input type="number" id="visitors" min="1" step="1" placeholder="10000" required>
              <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø²ÙˆØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„ØµÙØ­Ø©</small>
            </div>
            
            <div class="stage-input">
              <div class="stage-title">ğŸ‘† Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø±Ø§Øª</div>
              <input type="number" id="clicks" min="1" step="1" placeholder="500" required>
              <small>Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</small>
            </div>
            
            <div class="stage-input">
              <div class="stage-title">ğŸ“ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ†</div>
              <input type="number" id="leads" min="0" step="1" placeholder="50">
              <small>ØªØ³Ø¬ÙŠÙ„Ø§Øª/Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª</small>
            </div>
            
            <div class="stage-input">
              <div class="stage-title">ğŸ’° Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
              <input type="number" id="sales" min="0" step="1" placeholder="15" required>
              <small>Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</small>
            </div>
            
            <div class="stage-input">
              <div class="stage-title">ğŸ’µ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
              <input type="number" id="revenue" min="1" step="10" placeholder="15000" required>
              <small>Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</small>
            </div>
            
            <div class="stage-input">
              <div class="stage-title">ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ù†ÙØ§Ù‚</div>
              <input type="number" id="adSpend" min="1" step="10" placeholder="3500" required>
              <small>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</small>
            </div>
          </div>
        </div>
        
        <!-- Ø±ÙØ¹ CSV -->
        <div id="csvInput" style="display: none;">
          <div class="csv-upload-area" onclick="document.getElementById('csvFile').click()">
            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h3>Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù…Ù„ØªÙƒ</h3>
            <p style="color: var(--muted); margin: 10px 0;">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ø¯ÙŠØ¯</p>
            <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)">
            <small style="color: var(--muted);">Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: Visitors, Clicks, Leads, Sales, Revenue, Ad_Spend</small>
          </div>
        </div>
        
        <button type="button" class="unified-btn-primary" onclick="analyzeData()">
          <i class="fas fa-chart-line"></i>
          Ø­Ù„Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†
        </button>
      </div>
      
      <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <div id="results" class="unified-results">
        <!-- Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ -->
        <div class="unified-success-message">
          <i class="fas fa-check-circle"></i>
          ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø¥Ù„ÙŠÙƒ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
        </div>
        
        <!-- ØªÙ…Ø«ÙŠÙ„ Ø¨ØµØ±ÙŠ Ù„Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
        <div id="funnelVisualization" class="funnel-visualization">
          <h3 style="margin-bottom: 25px; color: var(--text);">
            <i class="fas fa-funnel-dollar"></i> Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
          </h3>
          <div id="funnelStages">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ù€ JavaScript -->
          </div>
        </div>
        
        <!-- Ø§Ù„Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ -->
        <div id="bottlenecksSection" class="bottlenecks-section">
          <h3 style="color: #dc2626; margin-bottom: 20px;">
            <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©
          </h3>
          <div id="bottlenecksList">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ù€ JavaScript -->
          </div>
        </div>
        
        <!-- ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† -->
        <div class="unified-recommendations">
          <h3><i class="fas fa-lightbulb"></i> Ø®Ø·Ø© Ø¹Ù…Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†</h3>
          <div id="improvementPlan">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ù€ JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ø£Ø²Ø±Ø§Ø± Ø¹Ø§Ø¦Ù…Ø© -->
  <a href="https://wa.me/201110760081" class="unified-whatsapp-float" target="_blank">
    <i class="fab fa-whatsapp"></i>
  </a>
  
  <!-- Global JavaScript -->
  <script src="../shared-scripts.js"></script>
  
  <script>
    let currentInputMethod = 'manual';
    let analysisData = null;
    
    function switchInputMethod(method) {
      currentInputMethod = method;
      
      // ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨Ø§Ø¨Ù€Ø²
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
      document.getElementById('manualInput').style.display = method === 'manual' ? 'block' : 'none';
      document.getElementById('csvInput').style.display = method === 'csv' ? 'block' : 'none';
    }
    
    function handleCSVUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const csv = e.target.result;
          const lines = csv.split('\n');
          const headers = lines[0].toLowerCase().split(',');
          const data = lines[1].split(',').map(val => parseFloat(val.trim()) || 0);
          
          // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
          const mapping = {
            'visitors': ['visitors', 'traffic', 'sessions'],
            'clicks': ['clicks', 'ad_clicks', 'link_clicks'],
            'leads': ['leads', 'signups', 'subscribers'],
            'sales': ['sales', 'conversions', 'purchases'],
            'revenue': ['revenue', 'sales_value', 'income'],
            'adSpend': ['ad_spend', 'cost', 'budget', 'spend']
          };
          
          Object.entries(mapping).forEach(([field, possibleNames]) => {
            const headerIndex = headers.findIndex(h => 
              possibleNames.some(name => h.includes(name))
            );
            if (headerIndex !== -1) {
              document.getElementById(field).value = data[headerIndex] || 0;
            }
          });
          
          alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„');
          
        } catch (error) {
          alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµÙŠØºØ© CSV');
        }
      };
      reader.readAsText(file);
    }
    
    function analyzeData() {
      // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const data = {
        visitors: parseInt(document.getElementById('visitors').value) || 0,
        clicks: parseInt(document.getElementById('clicks').value) || 0,
        leads: parseInt(document.getElementById('leads').value) || 0,
        sales: parseInt(document.getElementById('sales').value) || 0,
        revenue: parseFloat(document.getElementById('revenue').value) || 0,
        adSpend: parseFloat(document.getElementById('adSpend').value) || 0
      };
      
      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      if (data.visitors === 0 || data.clicks === 0 || data.sales === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© Ù„Ù„Ø²ÙˆØ§Ø±ØŒ Ø§Ù„Ù†Ù‚Ø±Ø§ØªØŒ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª');
        return;
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³
      const metrics = calculateFunnelMetrics(data);
      
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª
      const bottlenecks = identifyBottlenecks(metrics, data);
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†
      const improvementPlan = generateImprovementPlan(bottlenecks, metrics, data);
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      displayFunnelVisualization(data, metrics);
      displayBottlenecks(bottlenecks);
      displayImprovementPlan(improvementPlan);
      
      // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
      analysisData = { data, metrics, bottlenecks, improvementPlan };
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById('results').style.display = 'block';
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
      
      // ØªØªØ¨Ø¹
      if (typeof gtag !== 'undefined') {
        gtag('event', 'marketing_data_analysis', {
          event_category: 'Marketing Data Analyzer',
          value: Math.round(data.adSpend),
          visitors: data.visitors,
          conversion_rate: metrics.overallCVR
        });
      }
    }
    
    function calculateFunnelMetrics(data) {
      return {
        ctr: ((data.clicks / data.visitors) * 100).toFixed(2),
        leadRate: data.leads > 0 ? ((data.leads / data.clicks) * 100).toFixed(2) : '0.00',
        conversionRate: ((data.sales / data.clicks) * 100).toFixed(2),
        overallCVR: ((data.sales / data.visitors) * 100).toFixed(2),
        cpc: (data.adSpend / data.clicks).toFixed(2),
        cpa: (data.adSpend / data.sales).toFixed(2),
        roas: (data.revenue / data.adSpend).toFixed(2),
        aov: (data.revenue / data.sales).toFixed(2),
        leadToClosure: data.leads > 0 ? ((data.sales / data.leads) * 100).toFixed(2) : '0.00'
      };
    }
    
    function identifyBottlenecks(metrics, data) {
      const bottlenecks = [];
      
      // Ø§Ø®ØªÙ†Ø§Ù‚ CTR
      if (parseFloat(metrics.ctr) < 1.5) {
        bottlenecks.push({
          stage: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‚Ø± (CTR)',
          severity: 'high',
          current: metrics.ctr + '%',
          benchmark: '2.5%+',
          impact: 'ØªÙÙˆØªÙƒ Ù†Ù‚Ø±Ø§Øª ÙˆØ²ÙŠØ§Ø±Ø§Øª Ù…Ø­ØªÙ…Ù„Ø©',
          solution: 'Ø­Ø³Ù‘Ù† Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆÙˆØµÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ ÙˆØ§Ø³ØªØ®Ø¯Ù… ØµÙˆØ± Ø¬Ø°Ø§Ø¨Ø© Ø£ÙƒØ«Ø±'
        });
      }
      
      // Ø§Ø®ØªÙ†Ø§Ù‚ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„
      if (parseFloat(metrics.conversionRate) < 2.0) {
        bottlenecks.push({
          stage: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ (CVR)',
          severity: 'critical',
          current: metrics.conversionRate + '%',
          benchmark: '3.0%+',
          impact: 'ØªØ¶ÙŠÙŠØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© ØªÙƒÙ„ÙØ© CPA',
          solution: 'Ø­Ø³Ù‘Ù† ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·ØŒ Ø¨Ø³Ù‘Ø· Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ØŒ ÙˆØ£Ø¶Ù Ø¶Ù…Ø§Ù†Ø§Øª Ø§Ù„Ø«Ù‚Ø©'
        });
      }
      
      // Ø§Ø®ØªÙ†Ø§Ù‚ ROAS
      if (parseFloat(metrics.roas) < 3.0) {
        bottlenecks.push({
          stage: 'Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ù‚ (ROAS)',
          severity: 'medium',
          current: metrics.roas,
          benchmark: '4.0+',
          impact: 'Ø¹Ø§Ø¦Ø¯ Ø¶Ø¹ÙŠÙ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠ',
          solution: 'Ø§Ø±ÙØ¹ Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø±ÙˆØ¶ Bundle Ø£Ùˆ Upselling'
        });
      }
      
      // Ø§Ø®ØªÙ†Ø§Ù‚ Lead-to-Sale
      if (data.leads > 0 && parseFloat(metrics.leadToClosure) < 20) {
        bottlenecks.push({
          stage: 'ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ†',
          severity: 'medium',
          current: metrics.leadToClosure + '%',
          benchmark: '25%+',
          impact: 'ÙÙ‚Ø¯Ø§Ù† Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù‡ØªÙ…ÙŠÙ† ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©',
          solution: 'Ø·ÙˆÙ‘Ø± Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ø³ØªØ®Ø¯Ù… Email Marketing Ùˆremarketing'
        });
      }
      
      return bottlenecks;
    }
    
    function displayFunnelVisualization(data, metrics) {
      const stages = [
        { name: 'Ø²ÙˆØ§Ø±', value: data.visitors, percentage: '100%', class: 'stage-visitors' },
        { name: 'Ù†Ù‚Ø±Ø§Øª', value: data.clicks, percentage: metrics.ctr + '%', class: 'stage-clicks' },
        { name: 'Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„ÙŠÙ†', value: data.leads, percentage: metrics.leadRate + '%', class: 'stage-leads' },
        { name: 'Ù…Ø¨ÙŠØ¹Ø§Øª', value: data.sales, percentage: metrics.conversionRate + '%', class: 'stage-sales' }
      ];
      
      const container = document.getElementById('funnelStages');
      
      container.innerHTML = stages.map((stage, index) => {
        // Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø©
        const maxWidth = 100;
        const stageWidth = index === 0 ? maxWidth : (stage.value / data.visitors) * maxWidth;
        
        return `
          <div class="funnel-stage ${stage.class}" style="width: ${stageWidth}%; margin: 8px auto;">
            <div class="stage-percentage">${stage.percentage}</div>
            <div>${stage.name}: ${stage.value.toLocaleString()}</div>
          </div>
        `;
      }).join('');
    }
    
    function displayBottlenecks(bottlenecks) {
      const container = document.getElementById('bottlenecksList');
      
      if (bottlenecks.length === 0) {
        container.innerHTML = `
          <div class="bottleneck-item" style="border-left-color: #10b981; background: #f0fdf4;">
            <div class="bottleneck-title" style="color: #059669;">
              <i class="fas fa-check-circle"></i>
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªÙ†Ø§Ù‚Ø§Øª ÙˆØ§Ø¶Ø­Ø©!
            </div>
            <div style="color: #166534;">
              Ù‚Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© Ø¬ÙŠØ¯Ø©. Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¬Ù… ÙˆØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙˆØµÙˆÙ„.
            </div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = bottlenecks.map(bottleneck => `
        <div class="bottleneck-item">
          <div class="bottleneck-title">
            <i class="fas fa-exclamation-triangle"></i>
            ${bottleneck.stage}
          </div>
          <div class="bottleneck-impact">
            Ø§Ù„Ø­Ø§Ù„ÙŠ: ${bottleneck.current} | Ø§Ù„Ù…Ø¹ÙŠØ§Ø±: ${bottleneck.benchmark} | Ø§Ù„ØªØ£Ø«ÙŠØ±: ${bottleneck.impact}
          </div>
          <div class="bottleneck-solution">
            <strong>Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ${bottleneck.solution}
          </div>
        </div>
      `).join('');
    }
    
    function generateImprovementPlan(bottlenecks, metrics, data) {
      const improvements = [];
      
      // Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ£Ø«ÙŠØ±
      if (bottlenecks.some(b => b.stage.includes('CVR') || b.stage.includes('ØªØ­ÙˆÙŠÙ„'))) {
        improvements.push('ğŸ¨ **Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ù„ÙŠØ§**: ØªØ­Ø³ÙŠÙ† ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· Ù„Ø±ÙØ¹ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${metrics.conversionRate}% Ø¥Ù„Ù‰ 3%+ ÙŠØ¹Ù†ÙŠ Ø²ÙŠØ§Ø¯Ø© 50% ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª');
      }
      
      if (bottlenecks.some(b => b.stage.includes('CTR') || b.stage.includes('Ù†Ù‚Ø±'))) {
        improvements.push('ğŸ“ˆ **Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©**: Ø±ÙØ¹ CTR Ù„Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©');
      }
      
      if (parseFloat(metrics.roas) < 4.0) {
        improvements.push('ğŸ’° **Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±Ø¨Ø­ÙŠØ©**: Ø§Ø±ÙØ¹ ROAS Ù…Ù† ${metrics.roas} Ø¥Ù„Ù‰ 4.0+ Ø¨ØªØ­Ø³ÙŠÙ† AOV Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©');
      }
      
      // Ù†ØµØ§Ø¦Ø­ Ø¹Ø§Ù…Ø©
      improvements.push('ğŸ”„ **Ù…Ø±Ø§Ù‚Ø¨Ø¹ Ù…Ø³ØªÙ…Ø±Ø©**: Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù„Ø±ØµØ¯ Ø§Ù„ØªØ­Ø³Ù†');
      improvements.push('ğŸ“Š **A/B Testing**: Ø§Ø®ØªØ¨Ø± ØªØºÙŠÙŠØ±Ø§Øª ØµØºÙŠØ±Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØ£Ø«ÙŠØ±');
      
      return improvements;
    }
    
    function displayImprovementPlan(improvements) {
      const container = document.getElementById('improvementPlan');
      
      container.innerHTML = improvements.map(improvement => `
        <div class="unified-recommendation-item">${improvement}</div>
      `).join('');
    }
  </script>
</body>
</html>