<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>๐ ูุฎุชุตุฑ ุงูุฑูุงุจุท ุงูุนุงููู</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex gap-2 mb-3">
      <button class="btn btn-primary" id="processBtn">ูุนุงูุฌุฉ ุฐููุฉ</button>
      <button class="btn btn-outline-warning" id="cleanBtn">ุชูุธูู ุงูุฑูุงุจุท</button>
      <button class="btn btn-danger" id="backlinkBtn">ุจุงู ูููู (ุจุฏูู ุชุณุฌูู ุฏุฎูู)</button>
    </div>

    <textarea id="urlInput" class="form-control" rows="8" placeholder="https://example.com/path?name=ููุชุฌ-ุนุฑุจู"></textarea>
    <div id="results" class="mt-3"></div>
  </div>

  <script src="https://sherow1982.github.io/arabic-ads-calculator-tools/tools/modules/loader-backlink-nologin.js"></script>
  <script>
    function normalizeUrl(url){
      url=url.trim();
      if(!/^https?:\/\//.test(url)) url='https://'+url;
      try{ const u=new URL(url); return `${u.protocol}//${u.host}${u.pathname.replace(/\/\.\//g,'/').replace(/\/+/g,'/')}${u.search}${u.hash}` }catch{ return url }
    }
    function cleanUrls(){
      const ta=document.getElementById('urlInput');
      ta.value = ta.value.split('\n').map(s=>s.trim()).filter(Boolean).map(normalizeUrl).join('\n');
    }
    document.getElementById('cleanBtn').onclick=cleanUrls;

    document.getElementById('backlinkBtn').onclick=function(){
      const first = document.getElementById('urlInput').value.split('\n').map(s=>s.trim()).filter(Boolean)[0];
      if(!first){ alert('ุถุน ุฑุงุจุทุงู ุฃููุงู'); return; }
      if(!window.BacklinkNoLogin){ alert('ูู ูุชู ุชุญููู ูุญุฏุฉ ุงูุจุงู ูููู ุจุนุฏ. ุญุฏูุซ ุงูุตูุญุฉ ูุญุงูู.'); return; }
      const opened = window.BacklinkNoLogin.run(first);
      // ุจูุงุก ุชูุฑูุฑ ุจุณูุท
      const rows = opened.map((r,i)=>({
        '#': i+1,
        'ุงููููุน': r.site,
        'ุงูุฑุงุจุท ุงููุฑุณู': r.url,
        'ุชู ุงููุชุญ': r.ok ? 'ูุนู' : 'ููููุน ููุจุซูุงุช'
      }));
      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Backlinks');
      XLSX.writeFile(wb, 'backlink-report.xlsx');
    };

    document.getElementById('processBtn').onclick=function(){
      const lines = document.getElementById('urlInput').value.split('\n').map(s=>s.trim()).filter(Boolean);
      if(!lines.length){ alert('ุถุน ุฑูุงุจุท'); return; }
      const out = lines.map((url,i)=>{
        const n = normalizeUrl(url);
        const short = `https://sherow1982.github.io/arabic-ads-calculator-tools/s.html?to=${encodeURIComponent(n)}`;
        return `<tr><td>${i+1}</td><td dir="ltr">${n}</td><td dir="ltr">${short}</td></tr>`;
      }).join('');
      document.getElementById('results').innerHTML = `<table class="table"><thead><tr><th>#</th><th>ุงูุฃุตูู</th><th>ุงููุตูุฑ</th></tr></thead><tbody>${out}</tbody></table>`;
    };
  </script>
</body>
</html>
